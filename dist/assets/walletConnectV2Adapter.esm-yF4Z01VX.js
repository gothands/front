import{ab as On,ac as Nn,ad as Pn,ae as Tn,af as Rn,ag as Cn,ah as An,ai as $n,aj as Dn,ak as Ln,i as K,Y as Un,al as Qt,am as M,e as nt,an as Mn,ao as Os,ap as pi,aq as Ns,ar as Wi,as as Ps,at as qn,au as Ts,av as Ct,aw as Rs,ax as jn,ay as Gi,az as kn,aA as zn,aB as Ji,aC as Cs,aD as Kn,aE as dt,d as rt,aF as kt,aG as Fn,aH as Vn,aI as Xe,_ as vi,aJ as at,m as Hn,aK as ur,aL as gt,aM as ct,aN as Bn,aO as Ei,aP as dr}from"./index-L3ozMu8u.js";import{B as Wn}from"./baseEvmAdapter.esm-bhfdtaJk.js";function Yi(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function As(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Yi(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Ui(i,e){e||(e=i.reduce((s,o)=>s+o.length,0));const t=As(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return Yi(t)}const fr={...On,...Nn,...Pn,...Tn,...Rn,...Cn,...An,...$n,...Dn,...Ln};function $s(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const gr=$s("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),_i=$s("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=As(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Ds={utf8:gr,"utf-8":gr,hex:fr.base16,latin1:_i,ascii:_i,binary:_i,...fr};function He(i,e="utf8"){const t=Ds[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Yi(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}function ke(i,e="utf8"){const t=Ds[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}const Gn={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};let Jn=class{};class Yn extends Jn{constructor(){super()}}class Qn extends Yn{constructor(e){super()}}const Xn="^wss?:";function Zn(i){const e=i.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function eo(i,e){const t=Zn(i);return typeof t>"u"?!1:new RegExp(e).test(t)}function pr(i){return eo(i,Xn)}function to(i){return new RegExp("wss?://localhost(:d{2,5})?").test(i)}function Ls(i){return typeof i=="object"&&"id"in i&&"jsonrpc"in i&&i.jsonrpc==="2.0"}function Qi(i){return Ls(i)&&"method"in i}function yi(i){return Ls(i)&&(ut(i)||et(i))}function ut(i){return"result"in i}function et(i){return"error"in i}const io=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,ro=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,so=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function no(i,e){if(i==="__proto__"||i==="constructor"&&e&&typeof e=="object"&&"prototype"in e){oo(i);return}return e}function oo(i){console.warn(`[destr] Dropping "${i}" key to prevent prototype pollution.`)}function si(i,e={}){if(typeof i!="string")return i;const t=i.trim();if(i[0]==='"'&&i.at(-1)==='"'&&!i.includes("\\"))return t.slice(1,-1);if(t.length<=9){const r=t.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!so.test(i)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return i}try{if(io.test(i)||ro.test(i)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(i,no)}return JSON.parse(i)}catch(r){if(e.strict)throw r;return i}}function ao(i){return!i||typeof i.then!="function"?Promise.resolve(i):i}function he(i,...e){try{return ao(i(...e))}catch(t){return Promise.reject(t)}}function co(i){const e=typeof i;return i===null||e!=="object"&&e!=="function"}function ho(i){const e=Object.getPrototypeOf(i);return!e||e.isPrototypeOf(Object)}function ci(i){if(co(i))return String(i);if(ho(i)||Array.isArray(i))return JSON.stringify(i);if(typeof i.toJSON=="function")return ci(i.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Us(){if(typeof K.Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Mi="base64:";function lo(i){if(typeof i=="string")return i;Us();const e=K.Buffer.from(i).toString("base64");return Mi+e}function uo(i){return typeof i!="string"||!i.startsWith(Mi)?i:(Us(),K.Buffer.from(i.slice(Mi.length),"base64"))}function Fe(i){return i?i.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function fo(...i){return Fe(i.join(":"))}function ni(i){return i=Fe(i),i?i+":":""}const go="memory",po=()=>{const i=new Map;return{name:go,options:{},hasItem(e){return i.has(e)},getItem(e){return i.get(e)??null},getItemRaw(e){return i.get(e)??null},setItem(e,t){i.set(e,t)},setItemRaw(e,t){i.set(e,t)},removeItem(e){i.delete(e)},getKeys(){return Array.from(i.keys())},clear(){i.clear()},dispose(){i.clear()}}};function yo(i={}){const e={mounts:{"":i.driver||po()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const d of e.mountpoints)if(l.startsWith(d))return{base:d,relativeKey:l.slice(d.length),driver:e.mounts[d]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,d)=>e.mountpoints.filter(y=>y.startsWith(l)||d&&l.startsWith(y)).map(y=>({relativeBase:l.length>y.length?l.slice(y.length):void 0,mountpoint:y,driver:e.mounts[y]})),s=(l,d)=>{if(e.watching){d=Fe(d);for(const y of e.watchListeners)y(l,d)}},o=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await yr(e.mounts[l],s,l)}},a=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},c=(l,d,y)=>{const E=new Map,N=I=>{let T=E.get(I.base);return T||(T={driver:I.driver,base:I.base,items:[]},E.set(I.base,T)),T};for(const I of l){const T=typeof I=="string",C=Fe(T?I:I.key),q=T?void 0:I.value,h=T||!I.options?d:{...d,...I.options},f=t(C);N(f).items.push({key:C,value:q,relativeKey:f.relativeKey,options:h})}return Promise.all([...E.values()].map(I=>y(I))).then(I=>I.flat())},g={hasItem(l,d={}){l=Fe(l);const{relativeKey:y,driver:E}=t(l);return he(E.hasItem,y,d)},getItem(l,d={}){l=Fe(l);const{relativeKey:y,driver:E}=t(l);return he(E.getItem,y,d).then(N=>si(N))},getItems(l,d){return c(l,d,y=>y.driver.getItems?he(y.driver.getItems,y.items.map(E=>({key:E.relativeKey,options:E.options})),d).then(E=>E.map(N=>({key:fo(y.base,N.key),value:si(N.value)}))):Promise.all(y.items.map(E=>he(y.driver.getItem,E.relativeKey,E.options).then(N=>({key:E.key,value:si(N)})))))},getItemRaw(l,d={}){l=Fe(l);const{relativeKey:y,driver:E}=t(l);return E.getItemRaw?he(E.getItemRaw,y,d):he(E.getItem,y,d).then(N=>uo(N))},async setItem(l,d,y={}){if(d===void 0)return g.removeItem(l);l=Fe(l);const{relativeKey:E,driver:N}=t(l);N.setItem&&(await he(N.setItem,E,ci(d),y),N.watch||s("update",l))},async setItems(l,d){await c(l,d,async y=>{y.driver.setItems&&await he(y.driver.setItems,y.items.map(E=>({key:E.relativeKey,value:ci(E.value),options:E.options})),d),y.driver.setItem&&await Promise.all(y.items.map(E=>he(y.driver.setItem,E.relativeKey,ci(E.value),E.options)))})},async setItemRaw(l,d,y={}){if(d===void 0)return g.removeItem(l,y);l=Fe(l);const{relativeKey:E,driver:N}=t(l);if(N.setItemRaw)await he(N.setItemRaw,E,d,y);else if(N.setItem)await he(N.setItem,E,lo(d),y);else return;N.watch||s("update",l)},async removeItem(l,d={}){typeof d=="boolean"&&(d={removeMeta:d}),l=Fe(l);const{relativeKey:y,driver:E}=t(l);E.removeItem&&(await he(E.removeItem,y,d),(d.removeMeta||d.removeMata)&&await he(E.removeItem,y+"$",d),E.watch||s("remove",l))},async getMeta(l,d={}){typeof d=="boolean"&&(d={nativeOnly:d}),l=Fe(l);const{relativeKey:y,driver:E}=t(l),N=Object.create(null);if(E.getMeta&&Object.assign(N,await he(E.getMeta,y,d)),!d.nativeOnly){const I=await he(E.getItem,y+"$",d).then(T=>si(T));I&&typeof I=="object"&&(typeof I.atime=="string"&&(I.atime=new Date(I.atime)),typeof I.mtime=="string"&&(I.mtime=new Date(I.mtime)),Object.assign(N,I))}return N},setMeta(l,d,y={}){return this.setItem(l+"$",d,y)},removeMeta(l,d={}){return this.removeItem(l+"$",d)},async getKeys(l,d={}){l=ni(l);const y=r(l,!0);let E=[];const N=[];for(const I of y){const C=(await he(I.driver.getKeys,I.relativeBase,d)).map(q=>I.mountpoint+Fe(q)).filter(q=>!E.some(h=>q.startsWith(h)));N.push(...C),E=[I.mountpoint,...E.filter(q=>!q.startsWith(I.mountpoint))]}return l?N.filter(I=>I.startsWith(l)&&!I.endsWith("$")):N.filter(I=>!I.endsWith("$"))},async clear(l,d={}){l=ni(l),await Promise.all(r(l,!1).map(async y=>{if(y.driver.clear)return he(y.driver.clear,y.relativeBase,d);if(y.driver.removeItem){const E=await y.driver.getKeys(y.relativeBase||"",d);return Promise.all(E.map(N=>y.driver.removeItem(N,d)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>mr(l)))},async watch(l){return await o(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(d=>d!==l),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(l,d){if(l=ni(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((y,E)=>E.length-y.length)),e.mounts[l]=d,e.watching&&Promise.resolve(yr(d,s,l)).then(y=>{e.unwatch[l]=y}).catch(console.error),g},async unmount(l,d=!0){l=ni(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l](),delete e.unwatch[l]),d&&await mr(e.mounts[l]),e.mountpoints=e.mountpoints.filter(y=>y!==l),delete e.mounts[l])},getMount(l=""){l=Fe(l)+":";const d=t(l);return{driver:d.driver,base:d.base}},getMounts(l="",d={}){return l=Fe(l),r(l,d.parents).map(E=>({driver:E.driver,base:E.mountpoint}))}};return g}function yr(i,e,t){return i.watch?i.watch((r,s)=>e(r,t+s)):()=>{}}async function mr(i){typeof i.dispose=="function"&&await he(i.dispose)}function Et(i){return new Promise((e,t)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>t(i.error)})}function Ms(i,e){const t=indexedDB.open(i);t.onupgradeneeded=()=>t.result.createObjectStore(e);const r=Et(t);return(s,o)=>r.then(a=>o(a.transaction(e,s).objectStore(e)))}let Si;function Xt(){return Si||(Si=Ms("keyval-store","keyval")),Si}function wr(i,e=Xt()){return e("readonly",t=>Et(t.get(i)))}function mo(i,e,t=Xt()){return t("readwrite",r=>(r.put(e,i),Et(r.transaction)))}function wo(i,e=Xt()){return e("readwrite",t=>(t.delete(i),Et(t.transaction)))}function bo(i=Xt()){return i("readwrite",e=>(e.clear(),Et(e.transaction)))}function vo(i,e){return i.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Et(i.transaction)}function Eo(i=Xt()){return i("readonly",e=>{if(e.getAllKeys)return Et(e.getAllKeys());const t=[];return vo(e,r=>t.push(r.key)).then(()=>t)})}const _o=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),So=i=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=i.replace(e,'$1"$2n"$3');return JSON.parse(t,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function qs(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return So(i)}catch{return i}}function js(i){return typeof i=="string"?i:_o(i)||""}const Io="idb-keyval";var xo=(i={})=>{const e=i.base&&i.base.length>0?`${i.base}:`:"",t=s=>e+s;let r;return i.dbName&&i.storeName&&(r=Ms(i.dbName,i.storeName)),{name:Io,options:i,async hasItem(s){return!(typeof await wr(t(s),r)>"u")},async getItem(s){return await wr(t(s),r)??null},setItem(s,o){return mo(t(s),o,r)},removeItem(s){return wo(t(s),r)},getKeys(){return Eo(r)},clear(){return bo(r)}}};const Oo="WALLET_CONNECT_V2_INDEXED_DB",No="keyvaluestorage";let Po=class{constructor(){this.indexedDb=yo({driver:xo({dbName:Oo,storeName:No})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,js(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Ii=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof K.global<"u"?K.global:typeof self<"u"?self:{},hi={exports:{}};(function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,r){this[t]=String(r)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ii<"u"&&Ii.localStorage?hi.exports=Ii.localStorage:typeof window<"u"&&window.localStorage?hi.exports=window.localStorage:hi.exports=new e})();function To(i){var e;return[i[0],qs((e=i[1])!=null?e:"")]}class Ro{constructor(){this.localStorage=hi.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(To)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return qs(t)}async setItem(e,t){this.localStorage.setItem(e,js(t))}async removeItem(e){this.localStorage.removeItem(e)}}const Co="wc_storage_version",br=1,Ao=async(i,e,t)=>{const r=Co,s=await e.getItem(r);if(s&&s>=br){t(e);return}const o=await i.getKeys();if(!o.length){t(e);return}const a=[];for(;o.length;){const c=o.shift();if(!c)continue;const g=c.toLowerCase();if(g.includes("wc@")||g.includes("walletconnect")||g.includes("wc_")||g.includes("wallet_connect")){const l=await i.getItem(c);await e.setItem(c,l),a.push(c)}}await e.setItem(r,br),t(e),$o(i,a)},$o=async(i,e)=>{e.length&&e.forEach(async t=>{await i.removeItem(t)})};let Do=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new Ro;this.storage=e;try{const t=new Po;Ao(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var $t={},zt={},xi={},Kt={};class _t{}const Lo=Object.freeze(Object.defineProperty({__proto__:null,IEvents:_t},Symbol.toStringTag,{value:"Module"})),Uo=Un(Lo);var vr;function Mo(){if(vr)return Kt;vr=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.IHeartBeat=void 0;const i=Uo;class e extends i.IEvents{constructor(r){super()}}return Kt.IHeartBeat=e,Kt}var Er;function ks(){return Er||(Er=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),Qt.__exportStar(Mo(),i)}(xi)),xi}var Oi={},wt={},_r;function qo(){if(_r)return wt;_r=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.HEARTBEAT_EVENTS=wt.HEARTBEAT_INTERVAL=void 0;const i=M;return wt.HEARTBEAT_INTERVAL=i.FIVE_SECONDS,wt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},wt}var Sr;function zs(){return Sr||(Sr=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),Qt.__exportStar(qo(),i)}(Oi)),Oi}var Ir;function jo(){if(Ir)return zt;Ir=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.HeartBeat=void 0;const i=Qt,e=nt,t=M,r=ks(),s=zs();class o extends r.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return i.__awaiter(this,void 0,void 0,function*(){const g=new o(c);return yield g.init(),g})}init(){return i.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,g){this.events.on(c,g)}once(c,g){this.events.once(c,g)}off(c,g){this.events.off(c,g)}removeListener(c,g){this.events.removeListener(c,g)}initialize(){return i.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return zt.HeartBeat=o,zt}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=Qt;e.__exportStar(jo(),i),e.__exportStar(ks(),i),e.__exportStar(zs(),i)})($t);var F={},Ni,xr;function ko(){if(xr)return Ni;xr=1;function i(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Ni=e;function e(t,r,s){var o=s&&s.stringify||i,a=1;if(typeof t=="object"&&t!==null){var c=r.length+a;if(c===1)return t;var g=new Array(c);g[0]=o(t);for(var l=1;l<c;l++)g[l]=o(r[l]);return g.join(" ")}if(typeof t!="string")return t;var d=r.length;if(d===0)return t;for(var y="",E=1-a,N=-1,I=t&&t.length||0,T=0;T<I;){if(t.charCodeAt(T)===37&&T+1<I){switch(N=N>-1?N:0,t.charCodeAt(T+1)){case 100:case 102:if(E>=d||r[E]==null)break;N<T&&(y+=t.slice(N,T)),y+=Number(r[E]),N=T+2,T++;break;case 105:if(E>=d||r[E]==null)break;N<T&&(y+=t.slice(N,T)),y+=Math.floor(Number(r[E])),N=T+2,T++;break;case 79:case 111:case 106:if(E>=d||r[E]===void 0)break;N<T&&(y+=t.slice(N,T));var C=typeof r[E];if(C==="string"){y+="'"+r[E]+"'",N=T+2,T++;break}if(C==="function"){y+=r[E].name||"<anonymous>",N=T+2,T++;break}y+=o(r[E]),N=T+2,T++;break;case 115:if(E>=d)break;N<T&&(y+=t.slice(N,T)),y+=String(r[E]),N=T+2,T++;break;case 37:N<T&&(y+=t.slice(N,T)),y+="%",N=T+2,T++,E--;break}++E}++T}return N===-1?t:(N<I&&(y+=t.slice(N)),y)}return Ni}var Pi,Or;function zo(){if(Or)return Pi;Or=1;const i=ko();Pi=s;const e=m().console||{},t={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:T,wrapResponseSerializer:T,wrapErrorSerializer:T,req:I,res:I,err:E};function r(u,_){return Array.isArray(u)?u.filter(function(D){return D!=="!stdSerializers.err"}):u===!0?Object.keys(_):!1}function s(u){u=u||{},u.browser=u.browser||{};const _=u.browser.transmit;if(_&&typeof _.send!="function")throw Error("pino: transmit option must have a send function");const v=u.browser.write||e;u.browser.write&&(u.browser.asObject=!0);const D=u.serializers||{},j=r(u.browser.serialize,D);let V=u.browser.serialize;Array.isArray(u.browser.serialize)&&u.browser.serialize.indexOf("!stdSerializers.err")>-1&&(V=!1);const G=["error","fatal","warn","info","debug","trace"];typeof v=="function"&&(v.error=v.fatal=v.warn=v.info=v.debug=v.trace=v),u.enabled===!1&&(u.level="silent");const re=u.level||"info",S=Object.create(v);S.log||(S.log=C),Object.defineProperty(S,"levelVal",{get:Y}),Object.defineProperty(S,"level",{get:ee,set:U});const P={transmit:_,serialize:j,asObject:u.browser.asObject,levels:G,timestamp:N(u)};S.levels=s.levels,S.level=re,S.setMaxListeners=S.getMaxListeners=S.emit=S.addListener=S.on=S.prependListener=S.once=S.prependOnceListener=S.removeListener=S.removeAllListeners=S.listeners=S.listenerCount=S.eventNames=S.write=S.flush=C,S.serializers=D,S._serialize=j,S._stdErrSerialize=V,S.child=$,_&&(S._logEvent=y());function Y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function ee(){return this._level}function U(R){if(R!=="silent"&&!this.levels.values[R])throw Error("unknown level "+R);this._level=R,o(P,S,"error","log"),o(P,S,"fatal","error"),o(P,S,"warn","error"),o(P,S,"info","log"),o(P,S,"debug","log"),o(P,S,"trace","log")}function $(R,L){if(!R)throw new Error("missing bindings for child Pino");L=L||{},j&&R.serializers&&(L.serializers=R.serializers);const ae=L.serializers;if(j&&ae){var Z=Object.assign({},D,ae),Ot=u.browser.serialize===!0?Object.keys(Z):j;delete R.serializers,g([R],Ot,Z,this._stdErrSerialize)}function Nt(Ge){this._childLevel=(Ge._childLevel|0)+1,this.error=l(Ge,R,"error"),this.fatal=l(Ge,R,"fatal"),this.warn=l(Ge,R,"warn"),this.info=l(Ge,R,"info"),this.debug=l(Ge,R,"debug"),this.trace=l(Ge,R,"trace"),Z&&(this.serializers=Z,this._serialize=Ot),_&&(this._logEvent=y([].concat(Ge._logEvent.bindings,R)))}return Nt.prototype=this,new Nt(this)}return S}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:q,epochTime:h,unixTime:f,isoTime:p});function o(u,_,v,D){const j=Object.getPrototypeOf(_);_[v]=_.levelVal>_.levels.values[v]?C:j[v]?j[v]:e[v]||e[D]||C,a(u,_,v)}function a(u,_,v){!u.transmit&&_[v]===C||(_[v]=function(D){return function(){const V=u.timestamp(),G=new Array(arguments.length),re=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var S=0;S<G.length;S++)G[S]=arguments[S];if(u.serialize&&!u.asObject&&g(G,this._serialize,this.serializers,this._stdErrSerialize),u.asObject?D.call(re,c(this,v,G,V)):D.apply(re,G),u.transmit){const P=u.transmit.level||_.level,Y=s.levels.values[P],ee=s.levels.values[v];if(ee<Y)return;d(this,{ts:V,methodLevel:v,methodValue:ee,transmitLevel:P,transmitValue:s.levels.values[u.transmit.level||_.level],send:u.transmit.send,val:_.levelVal},G)}}}(_[v]))}function c(u,_,v,D){u._serialize&&g(v,u._serialize,u.serializers,u._stdErrSerialize);const j=v.slice();let V=j[0];const G={};D&&(G.time=D),G.level=s.levels.values[_];let re=(u._childLevel|0)+1;if(re<1&&(re=1),V!==null&&typeof V=="object"){for(;re--&&typeof j[0]=="object";)Object.assign(G,j.shift());V=j.length?i(j.shift(),j):void 0}else typeof V=="string"&&(V=i(j.shift(),j));return V!==void 0&&(G.msg=V),G}function g(u,_,v,D){for(const j in u)if(D&&u[j]instanceof Error)u[j]=s.stdSerializers.err(u[j]);else if(typeof u[j]=="object"&&!Array.isArray(u[j]))for(const V in u[j])_&&_.indexOf(V)>-1&&V in v&&(u[j][V]=v[V](u[j][V]))}function l(u,_,v){return function(){const D=new Array(1+arguments.length);D[0]=_;for(var j=1;j<D.length;j++)D[j]=arguments[j-1];return u[v].apply(this,D)}}function d(u,_,v){const D=_.send,j=_.ts,V=_.methodLevel,G=_.methodValue,re=_.val,S=u._logEvent.bindings;g(v,u._serialize||Object.keys(u.serializers),u.serializers,u._stdErrSerialize===void 0?!0:u._stdErrSerialize),u._logEvent.ts=j,u._logEvent.messages=v.filter(function(P){return S.indexOf(P)===-1}),u._logEvent.level.label=V,u._logEvent.level.value=G,D(V,u._logEvent,re),u._logEvent=y(S)}function y(u){return{ts:0,messages:[],bindings:u||[],level:{label:"",value:0}}}function E(u){const _={type:u.constructor.name,msg:u.message,stack:u.stack};for(const v in u)_[v]===void 0&&(_[v]=u[v]);return _}function N(u){return typeof u.timestamp=="function"?u.timestamp:u.timestamp===!1?q:h}function I(){return{}}function T(u){return u}function C(){}function q(){return!1}function h(){return Date.now()}function f(){return Math.round(Date.now()/1e3)}function p(){return new Date(Date.now()).toISOString()}function m(){function u(_){return typeof _<"u"&&_}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return u(self)||u(window)||u(this)||{}}}return Pi}var bt={},Nr;function Ks(){return Nr||(Nr=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.PINO_CUSTOM_CONTEXT_KEY=bt.PINO_LOGGER_DEFAULTS=void 0,bt.PINO_LOGGER_DEFAULTS={level:"info"},bt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),bt}var Me={},Pr;function Ko(){if(Pr)return Me;Pr=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.generateChildLogger=Me.formatChildLoggerContext=Me.getLoggerContext=Me.setBrowserLoggerContext=Me.getBrowserLoggerContext=Me.getDefaultLoggerOptions=void 0;const i=Ks();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||i.PINO_LOGGER_DEFAULTS.level})}Me.getDefaultLoggerOptions=e;function t(c,g=i.PINO_CUSTOM_CONTEXT_KEY){return c[g]||""}Me.getBrowserLoggerContext=t;function r(c,g,l=i.PINO_CUSTOM_CONTEXT_KEY){return c[l]=g,c}Me.setBrowserLoggerContext=r;function s(c,g=i.PINO_CUSTOM_CONTEXT_KEY){let l="";return typeof c.bindings>"u"?l=t(c,g):l=c.bindings().context||"",l}Me.getLoggerContext=s;function o(c,g,l=i.PINO_CUSTOM_CONTEXT_KEY){const d=s(c,l);return d.trim()?`${d}/${g}`:g}Me.formatChildLoggerContext=o;function a(c,g,l=i.PINO_CUSTOM_CONTEXT_KEY){const d=o(c,g,l),y=c.child({context:d});return r(y,d,l)}return Me.generateChildLogger=a,Me}(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.pino=void 0;const e=Qt,t=e.__importDefault(zo());Object.defineProperty(i,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Ks(),i),e.__exportStar(Ko(),i)})(F);class Fo extends _t{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Vo=class extends _t{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},Ho=class{constructor(e,t){this.logger=e,this.core=t}};class Bo extends _t{constructor(e,t){super(),this.relayer=e,this.logger=t}}let Wo=class extends _t{constructor(e){super()}},Go=class{constructor(e,t,r,s){this.core=e,this.logger=t,this.name=r}};class Jo extends _t{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Yo extends _t{constructor(e,t){super(),this.core=e,this.logger=t}}class Qo{constructor(e,t){this.projectId=e,this.logger=t}}let Xo=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Zo=class{constructor(e){this.client=e}};const ea=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),ta=i=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=i.replace(e,'$1"$2n"$3');return JSON.parse(t,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ia(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return ta(i)}catch{return i}}function ra(i){return typeof i=="string"?i:ea(i)||""}var Xi={},Fs={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Mn,t=Os;i.DIGEST_LENGTH=64,i.BLOCK_SIZE=128;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},c.prototype.update=function(g,l){if(l===void 0&&(l=g.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var d=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<i.BLOCK_SIZE&&l>0;)this._buffer[this._bufferLength++]=g[d++],l--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(d=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,g,d,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=g[d++],l--;return this},c.prototype.finish=function(g){if(!this._finished){var l=this._bytesHashed,d=this._bufferLength,y=l/536870912|0,E=l<<3,N=l%128<112?128:256;this._buffer[d]=128;for(var I=d+1;I<N-8;I++)this._buffer[I]=0;e.writeUint32BE(y,this._buffer,N-8),e.writeUint32BE(E,this._buffer,N-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var I=0;I<this.digestLength/8;I++)e.writeUint32BE(this._stateHi[I],g,I*8),e.writeUint32BE(this._stateLo[I],g,I*8+4);return this},c.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(g){return this._stateHi.set(g.stateHi),this._stateLo.set(g.stateLo),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(g){t.wipe(g.stateHi),t.wipe(g.stateLo),g.buffer&&t.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},c}();i.SHA512=r;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,g,l,d,y,E,N){for(var I=l[0],T=l[1],C=l[2],q=l[3],h=l[4],f=l[5],p=l[6],m=l[7],u=d[0],_=d[1],v=d[2],D=d[3],j=d[4],V=d[5],G=d[6],re=d[7],S,P,Y,ee,U,$,R,L;N>=128;){for(var ae=0;ae<16;ae++){var Z=8*ae+E;c[ae]=e.readUint32BE(y,Z),g[ae]=e.readUint32BE(y,Z+4)}for(var ae=0;ae<80;ae++){var Ot=I,Nt=T,Ge=C,x=q,O=h,b=f,n=p,w=m,k=u,z=_,J=v,Q=D,H=j,X=V,De=G,de=re;if(S=m,P=re,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=(h>>>14|j<<18)^(h>>>18|j<<14)^(j>>>9|h<<23),P=(j>>>14|h<<18)^(j>>>18|h<<14)^(h>>>9|j<<23),U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,S=h&f^~h&p,P=j&V^~j&G,U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,S=s[ae*2],P=s[ae*2+1],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,S=c[ae%16],P=g[ae%16],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,Y=R&65535|L<<16,ee=U&65535|$<<16,S=Y,P=ee,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=(I>>>28|u<<4)^(u>>>2|I<<30)^(u>>>7|I<<25),P=(u>>>28|I<<4)^(I>>>2|u<<30)^(I>>>7|u<<25),U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,S=I&T^I&C^T&C,P=u&_^u&v^_&v,U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,w=R&65535|L<<16,de=U&65535|$<<16,S=x,P=Q,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=Y,P=ee,U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,x=R&65535|L<<16,Q=U&65535|$<<16,T=Ot,C=Nt,q=Ge,h=x,f=O,p=b,m=n,I=w,_=k,v=z,D=J,j=Q,V=H,G=X,re=De,u=de,ae%16===15)for(var Z=0;Z<16;Z++)S=c[Z],P=g[Z],U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=c[(Z+9)%16],P=g[(Z+9)%16],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,Y=c[(Z+1)%16],ee=g[(Z+1)%16],S=(Y>>>1|ee<<31)^(Y>>>8|ee<<24)^Y>>>7,P=(ee>>>1|Y<<31)^(ee>>>8|Y<<24)^(ee>>>7|Y<<25),U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,Y=c[(Z+14)%16],ee=g[(Z+14)%16],S=(Y>>>19|ee<<13)^(ee>>>29|Y<<3)^Y>>>6,P=(ee>>>19|Y<<13)^(Y>>>29|ee<<3)^(ee>>>6|Y<<26),U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,c[Z]=R&65535|L<<16,g[Z]=U&65535|$<<16}S=I,P=u,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[0],P=d[0],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[0]=I=R&65535|L<<16,d[0]=u=U&65535|$<<16,S=T,P=_,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[1],P=d[1],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[1]=T=R&65535|L<<16,d[1]=_=U&65535|$<<16,S=C,P=v,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[2],P=d[2],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[2]=C=R&65535|L<<16,d[2]=v=U&65535|$<<16,S=q,P=D,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[3],P=d[3],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[3]=q=R&65535|L<<16,d[3]=D=U&65535|$<<16,S=h,P=j,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[4],P=d[4],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[4]=h=R&65535|L<<16,d[4]=j=U&65535|$<<16,S=f,P=V,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[5],P=d[5],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[5]=f=R&65535|L<<16,d[5]=V=U&65535|$<<16,S=p,P=G,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[6],P=d[6],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[6]=p=R&65535|L<<16,d[6]=G=U&65535|$<<16,S=m,P=re,U=P&65535,$=P>>>16,R=S&65535,L=S>>>16,S=l[7],P=d[7],U+=P&65535,$+=P>>>16,R+=S&65535,L+=S>>>16,$+=U>>>16,R+=$>>>16,L+=R>>>16,l[7]=m=R&65535|L<<16,d[7]=re=U&65535|$<<16,E+=128,N-=128}return E}function a(c){var g=new r;g.update(c);var l=g.digest();return g.clean(),l}i.hash=a})(Fs);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertSecretKeyToX25519=i.convertPublicKeyToX25519=i.verify=i.sign=i.extractPublicKeyFromSecretKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.SEED_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=i.SIGNATURE_LENGTH=void 0;const e=pi,t=Fs,r=Os;i.SIGNATURE_LENGTH=64,i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=64,i.SEED_LENGTH=32;function s(x){const O=new Float64Array(16);if(x)for(let b=0;b<x.length;b++)O[b]=x[b];return O}const o=new Uint8Array(32);o[0]=9;const a=s(),c=s([1]),g=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),y=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),E=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(x,O){for(let b=0;b<16;b++)x[b]=O[b]|0}function I(x){let O=1;for(let b=0;b<16;b++){let n=x[b]+O+65535;O=Math.floor(n/65536),x[b]=n-O*65536}x[0]+=O-1+37*(O-1)}function T(x,O,b){const n=~(b-1);for(let w=0;w<16;w++){const k=n&(x[w]^O[w]);x[w]^=k,O[w]^=k}}function C(x,O){const b=s(),n=s();for(let w=0;w<16;w++)n[w]=O[w];I(n),I(n),I(n);for(let w=0;w<2;w++){b[0]=n[0]-65517;for(let z=1;z<15;z++)b[z]=n[z]-65535-(b[z-1]>>16&1),b[z-1]&=65535;b[15]=n[15]-32767-(b[14]>>16&1);const k=b[15]>>16&1;b[14]&=65535,T(n,b,1-k)}for(let w=0;w<16;w++)x[2*w]=n[w]&255,x[2*w+1]=n[w]>>8}function q(x,O){let b=0;for(let n=0;n<32;n++)b|=x[n]^O[n];return(1&b-1>>>8)-1}function h(x,O){const b=new Uint8Array(32),n=new Uint8Array(32);return C(b,x),C(n,O),q(b,n)}function f(x){const O=new Uint8Array(32);return C(O,x),O[0]&1}function p(x,O){for(let b=0;b<16;b++)x[b]=O[2*b]+(O[2*b+1]<<8);x[15]&=32767}function m(x,O,b){for(let n=0;n<16;n++)x[n]=O[n]+b[n]}function u(x,O,b){for(let n=0;n<16;n++)x[n]=O[n]-b[n]}function _(x,O,b){let n,w,k=0,z=0,J=0,Q=0,H=0,X=0,De=0,de=0,Le=0,pe=0,fe=0,ce=0,oe=0,se=0,te=0,ie=0,ye=0,Ue=0,ze=0,Be=0,Je=0,Qe=0,it=0,ot=0,ft=0,mt=0,Pt=0,jt=0,ri=0,bi=0,lr=0,me=b[0],we=b[1],be=b[2],ve=b[3],Ee=b[4],_e=b[5],Se=b[6],Ie=b[7],xe=b[8],Oe=b[9],Ne=b[10],Pe=b[11],Te=b[12],Re=b[13],Ce=b[14],Ae=b[15];n=O[0],k+=n*me,z+=n*we,J+=n*be,Q+=n*ve,H+=n*Ee,X+=n*_e,De+=n*Se,de+=n*Ie,Le+=n*xe,pe+=n*Oe,fe+=n*Ne,ce+=n*Pe,oe+=n*Te,se+=n*Re,te+=n*Ce,ie+=n*Ae,n=O[1],z+=n*me,J+=n*we,Q+=n*be,H+=n*ve,X+=n*Ee,De+=n*_e,de+=n*Se,Le+=n*Ie,pe+=n*xe,fe+=n*Oe,ce+=n*Ne,oe+=n*Pe,se+=n*Te,te+=n*Re,ie+=n*Ce,ye+=n*Ae,n=O[2],J+=n*me,Q+=n*we,H+=n*be,X+=n*ve,De+=n*Ee,de+=n*_e,Le+=n*Se,pe+=n*Ie,fe+=n*xe,ce+=n*Oe,oe+=n*Ne,se+=n*Pe,te+=n*Te,ie+=n*Re,ye+=n*Ce,Ue+=n*Ae,n=O[3],Q+=n*me,H+=n*we,X+=n*be,De+=n*ve,de+=n*Ee,Le+=n*_e,pe+=n*Se,fe+=n*Ie,ce+=n*xe,oe+=n*Oe,se+=n*Ne,te+=n*Pe,ie+=n*Te,ye+=n*Re,Ue+=n*Ce,ze+=n*Ae,n=O[4],H+=n*me,X+=n*we,De+=n*be,de+=n*ve,Le+=n*Ee,pe+=n*_e,fe+=n*Se,ce+=n*Ie,oe+=n*xe,se+=n*Oe,te+=n*Ne,ie+=n*Pe,ye+=n*Te,Ue+=n*Re,ze+=n*Ce,Be+=n*Ae,n=O[5],X+=n*me,De+=n*we,de+=n*be,Le+=n*ve,pe+=n*Ee,fe+=n*_e,ce+=n*Se,oe+=n*Ie,se+=n*xe,te+=n*Oe,ie+=n*Ne,ye+=n*Pe,Ue+=n*Te,ze+=n*Re,Be+=n*Ce,Je+=n*Ae,n=O[6],De+=n*me,de+=n*we,Le+=n*be,pe+=n*ve,fe+=n*Ee,ce+=n*_e,oe+=n*Se,se+=n*Ie,te+=n*xe,ie+=n*Oe,ye+=n*Ne,Ue+=n*Pe,ze+=n*Te,Be+=n*Re,Je+=n*Ce,Qe+=n*Ae,n=O[7],de+=n*me,Le+=n*we,pe+=n*be,fe+=n*ve,ce+=n*Ee,oe+=n*_e,se+=n*Se,te+=n*Ie,ie+=n*xe,ye+=n*Oe,Ue+=n*Ne,ze+=n*Pe,Be+=n*Te,Je+=n*Re,Qe+=n*Ce,it+=n*Ae,n=O[8],Le+=n*me,pe+=n*we,fe+=n*be,ce+=n*ve,oe+=n*Ee,se+=n*_e,te+=n*Se,ie+=n*Ie,ye+=n*xe,Ue+=n*Oe,ze+=n*Ne,Be+=n*Pe,Je+=n*Te,Qe+=n*Re,it+=n*Ce,ot+=n*Ae,n=O[9],pe+=n*me,fe+=n*we,ce+=n*be,oe+=n*ve,se+=n*Ee,te+=n*_e,ie+=n*Se,ye+=n*Ie,Ue+=n*xe,ze+=n*Oe,Be+=n*Ne,Je+=n*Pe,Qe+=n*Te,it+=n*Re,ot+=n*Ce,ft+=n*Ae,n=O[10],fe+=n*me,ce+=n*we,oe+=n*be,se+=n*ve,te+=n*Ee,ie+=n*_e,ye+=n*Se,Ue+=n*Ie,ze+=n*xe,Be+=n*Oe,Je+=n*Ne,Qe+=n*Pe,it+=n*Te,ot+=n*Re,ft+=n*Ce,mt+=n*Ae,n=O[11],ce+=n*me,oe+=n*we,se+=n*be,te+=n*ve,ie+=n*Ee,ye+=n*_e,Ue+=n*Se,ze+=n*Ie,Be+=n*xe,Je+=n*Oe,Qe+=n*Ne,it+=n*Pe,ot+=n*Te,ft+=n*Re,mt+=n*Ce,Pt+=n*Ae,n=O[12],oe+=n*me,se+=n*we,te+=n*be,ie+=n*ve,ye+=n*Ee,Ue+=n*_e,ze+=n*Se,Be+=n*Ie,Je+=n*xe,Qe+=n*Oe,it+=n*Ne,ot+=n*Pe,ft+=n*Te,mt+=n*Re,Pt+=n*Ce,jt+=n*Ae,n=O[13],se+=n*me,te+=n*we,ie+=n*be,ye+=n*ve,Ue+=n*Ee,ze+=n*_e,Be+=n*Se,Je+=n*Ie,Qe+=n*xe,it+=n*Oe,ot+=n*Ne,ft+=n*Pe,mt+=n*Te,Pt+=n*Re,jt+=n*Ce,ri+=n*Ae,n=O[14],te+=n*me,ie+=n*we,ye+=n*be,Ue+=n*ve,ze+=n*Ee,Be+=n*_e,Je+=n*Se,Qe+=n*Ie,it+=n*xe,ot+=n*Oe,ft+=n*Ne,mt+=n*Pe,Pt+=n*Te,jt+=n*Re,ri+=n*Ce,bi+=n*Ae,n=O[15],ie+=n*me,ye+=n*we,Ue+=n*be,ze+=n*ve,Be+=n*Ee,Je+=n*_e,Qe+=n*Se,it+=n*Ie,ot+=n*xe,ft+=n*Oe,mt+=n*Ne,Pt+=n*Pe,jt+=n*Te,ri+=n*Re,bi+=n*Ce,lr+=n*Ae,k+=38*ye,z+=38*Ue,J+=38*ze,Q+=38*Be,H+=38*Je,X+=38*Qe,De+=38*it,de+=38*ot,Le+=38*ft,pe+=38*mt,fe+=38*Pt,ce+=38*jt,oe+=38*ri,se+=38*bi,te+=38*lr,w=1,n=k+w+65535,w=Math.floor(n/65536),k=n-w*65536,n=z+w+65535,w=Math.floor(n/65536),z=n-w*65536,n=J+w+65535,w=Math.floor(n/65536),J=n-w*65536,n=Q+w+65535,w=Math.floor(n/65536),Q=n-w*65536,n=H+w+65535,w=Math.floor(n/65536),H=n-w*65536,n=X+w+65535,w=Math.floor(n/65536),X=n-w*65536,n=De+w+65535,w=Math.floor(n/65536),De=n-w*65536,n=de+w+65535,w=Math.floor(n/65536),de=n-w*65536,n=Le+w+65535,w=Math.floor(n/65536),Le=n-w*65536,n=pe+w+65535,w=Math.floor(n/65536),pe=n-w*65536,n=fe+w+65535,w=Math.floor(n/65536),fe=n-w*65536,n=ce+w+65535,w=Math.floor(n/65536),ce=n-w*65536,n=oe+w+65535,w=Math.floor(n/65536),oe=n-w*65536,n=se+w+65535,w=Math.floor(n/65536),se=n-w*65536,n=te+w+65535,w=Math.floor(n/65536),te=n-w*65536,n=ie+w+65535,w=Math.floor(n/65536),ie=n-w*65536,k+=w-1+37*(w-1),w=1,n=k+w+65535,w=Math.floor(n/65536),k=n-w*65536,n=z+w+65535,w=Math.floor(n/65536),z=n-w*65536,n=J+w+65535,w=Math.floor(n/65536),J=n-w*65536,n=Q+w+65535,w=Math.floor(n/65536),Q=n-w*65536,n=H+w+65535,w=Math.floor(n/65536),H=n-w*65536,n=X+w+65535,w=Math.floor(n/65536),X=n-w*65536,n=De+w+65535,w=Math.floor(n/65536),De=n-w*65536,n=de+w+65535,w=Math.floor(n/65536),de=n-w*65536,n=Le+w+65535,w=Math.floor(n/65536),Le=n-w*65536,n=pe+w+65535,w=Math.floor(n/65536),pe=n-w*65536,n=fe+w+65535,w=Math.floor(n/65536),fe=n-w*65536,n=ce+w+65535,w=Math.floor(n/65536),ce=n-w*65536,n=oe+w+65535,w=Math.floor(n/65536),oe=n-w*65536,n=se+w+65535,w=Math.floor(n/65536),se=n-w*65536,n=te+w+65535,w=Math.floor(n/65536),te=n-w*65536,n=ie+w+65535,w=Math.floor(n/65536),ie=n-w*65536,k+=w-1+37*(w-1),x[0]=k,x[1]=z,x[2]=J,x[3]=Q,x[4]=H,x[5]=X,x[6]=De,x[7]=de,x[8]=Le,x[9]=pe,x[10]=fe,x[11]=ce,x[12]=oe,x[13]=se,x[14]=te,x[15]=ie}function v(x,O){_(x,O,O)}function D(x,O){const b=s();let n;for(n=0;n<16;n++)b[n]=O[n];for(n=253;n>=0;n--)v(b,b),n!==2&&n!==4&&_(b,b,O);for(n=0;n<16;n++)x[n]=b[n]}function j(x,O){const b=s();let n;for(n=0;n<16;n++)b[n]=O[n];for(n=250;n>=0;n--)v(b,b),n!==1&&_(b,b,O);for(n=0;n<16;n++)x[n]=b[n]}function V(x,O){const b=s(),n=s(),w=s(),k=s(),z=s(),J=s(),Q=s(),H=s(),X=s();u(b,x[1],x[0]),u(X,O[1],O[0]),_(b,b,X),m(n,x[0],x[1]),m(X,O[0],O[1]),_(n,n,X),_(w,x[3],O[3]),_(w,w,l),_(k,x[2],O[2]),m(k,k,k),u(z,n,b),u(J,k,w),m(Q,k,w),m(H,n,b),_(x[0],z,J),_(x[1],H,Q),_(x[2],Q,J),_(x[3],z,H)}function G(x,O,b){for(let n=0;n<4;n++)T(x[n],O[n],b)}function re(x,O){const b=s(),n=s(),w=s();D(w,O[2]),_(b,O[0],w),_(n,O[1],w),C(x,n),x[31]^=f(b)<<7}function S(x,O,b){N(x[0],a),N(x[1],c),N(x[2],c),N(x[3],a);for(let n=255;n>=0;--n){const w=b[n/8|0]>>(n&7)&1;G(x,O,w),V(O,x),V(x,x),G(x,O,w)}}function P(x,O){const b=[s(),s(),s(),s()];N(b[0],d),N(b[1],y),N(b[2],c),_(b[3],d,y),S(x,b,O)}function Y(x){if(x.length!==i.SEED_LENGTH)throw new Error(`ed25519: seed must be ${i.SEED_LENGTH} bytes`);const O=(0,t.hash)(x);O[0]&=248,O[31]&=127,O[31]|=64;const b=new Uint8Array(32),n=[s(),s(),s(),s()];P(n,O),re(b,n);const w=new Uint8Array(64);return w.set(x),w.set(b,32),{publicKey:b,secretKey:w}}i.generateKeyPairFromSeed=Y;function ee(x){const O=(0,e.randomBytes)(32,x),b=Y(O);return(0,r.wipe)(O),b}i.generateKeyPair=ee;function U(x){if(x.length!==i.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${i.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(x.subarray(32))}i.extractPublicKeyFromSecretKey=U;const $=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function R(x,O){let b,n,w,k;for(n=63;n>=32;--n){for(b=0,w=n-32,k=n-12;w<k;++w)O[w]+=b-16*O[n]*$[w-(n-32)],b=Math.floor((O[w]+128)/256),O[w]-=b*256;O[w]+=b,O[n]=0}for(b=0,w=0;w<32;w++)O[w]+=b-(O[31]>>4)*$[w],b=O[w]>>8,O[w]&=255;for(w=0;w<32;w++)O[w]-=b*$[w];for(n=0;n<32;n++)O[n+1]+=O[n]>>8,x[n]=O[n]&255}function L(x){const O=new Float64Array(64);for(let b=0;b<64;b++)O[b]=x[b];for(let b=0;b<64;b++)x[b]=0;R(x,O)}function ae(x,O){const b=new Float64Array(64),n=[s(),s(),s(),s()],w=(0,t.hash)(x.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const k=new Uint8Array(64);k.set(w.subarray(32),32);const z=new t.SHA512;z.update(k.subarray(32)),z.update(O);const J=z.digest();z.clean(),L(J),P(n,J),re(k,n),z.reset(),z.update(k.subarray(0,32)),z.update(x.subarray(32)),z.update(O);const Q=z.digest();L(Q);for(let H=0;H<32;H++)b[H]=J[H];for(let H=0;H<32;H++)for(let X=0;X<32;X++)b[H+X]+=Q[H]*w[X];return R(k.subarray(32),b),k}i.sign=ae;function Z(x,O){const b=s(),n=s(),w=s(),k=s(),z=s(),J=s(),Q=s();return N(x[2],c),p(x[1],O),v(w,x[1]),_(k,w,g),u(w,w,x[2]),m(k,x[2],k),v(z,k),v(J,z),_(Q,J,z),_(b,Q,w),_(b,b,k),j(b,b),_(b,b,w),_(b,b,k),_(b,b,k),_(x[0],b,k),v(n,x[0]),_(n,n,k),h(n,w)&&_(x[0],x[0],E),v(n,x[0]),_(n,n,k),h(n,w)?-1:(f(x[0])===O[31]>>7&&u(x[0],a,x[0]),_(x[3],x[0],x[1]),0)}function Ot(x,O,b){const n=new Uint8Array(32),w=[s(),s(),s(),s()],k=[s(),s(),s(),s()];if(b.length!==i.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${i.SIGNATURE_LENGTH} bytes`);if(Z(k,x))return!1;const z=new t.SHA512;z.update(b.subarray(0,32)),z.update(x),z.update(O);const J=z.digest();return L(J),S(w,k,J),P(k,b.subarray(32)),V(w,k),re(n,w),!q(b,n)}i.verify=Ot;function Nt(x){let O=[s(),s(),s(),s()];if(Z(O,x))throw new Error("Ed25519: invalid public key");let b=s(),n=s(),w=O[1];m(b,c,w),u(n,c,w),D(n,n),_(b,b,n);let k=new Uint8Array(32);return C(k,b),k}i.convertPublicKeyToX25519=Nt;function Ge(x){const O=(0,t.hash)(x.subarray(0,32));O[0]&=248,O[31]&=127,O[31]|=64;const b=new Uint8Array(O.subarray(0,32));return(0,r.wipe)(O),b}i.convertSecretKeyToX25519=Ge})(Xi);const sa="EdDSA",na="JWT",Vs=".",Hs="base64url",oa="utf8",aa="utf8",ca=":",ha="did",la="key",Tr="base58btc",ua="z",da="K36",fa=32,ga=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t);function pa(i){return typeof i=="string"?i:ga(i)||""}function di(i){return ke(He(pa(i),oa),Hs)}function Bs(i){const e=He(da,Tr),t=ua+ke(Ui([e,i]),Tr);return[ha,la,t].join(ca)}function ya(i){return ke(i,Hs)}function ma(i){return He([di(i.header),di(i.payload)].join(Vs),aa)}function wa(i){return[di(i.header),di(i.payload),ya(i.signature)].join(Vs)}function Rr(i=pi.randomBytes(fa)){return Xi.generateKeyPairFromSeed(i)}async function ba(i,e,t,r,s=M.fromMiliseconds(Date.now())){const o={alg:sa,typ:na},a=Bs(r.publicKey),c=s+t,g={iss:a,sub:i,aud:e,iat:s,exp:c},l=ma({header:o,payload:g}),d=Xi.sign(r.secretKey,l);return wa({header:o,payload:g,signature:d})}var Cr=function(i,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||Array.prototype.slice.call(e))},va=function(){function i(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"}return i}(),Ea=function(){function i(e){this.version=e,this.type="node",this.name="node",this.os=K.process.platform}return i}(),_a=function(){function i(e,t,r,s){this.name=e,this.version=t,this.os=r,this.bot=s,this.type="bot-device"}return i}(),Sa=function(){function i(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return i}(),Ia=function(){function i(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return i}(),xa=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Oa=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ar=3,Na=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",xa]],$r=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Pa(i){return i?Dr(i):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Ia:typeof navigator<"u"?Dr(navigator.userAgent):Ca()}function Ta(i){return i!==""&&Na.reduce(function(e,t){var r=t[0],s=t[1];if(e)return e;var o=s.exec(i);return!!o&&[r,o]},!1)}function Dr(i){var e=Ta(i);if(!e)return null;var t=e[0],r=e[1];if(t==="searchbot")return new Sa;var s=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);s?s.length<Ar&&(s=Cr(Cr([],s,!0),Aa(Ar-s.length),!0)):s=[];var o=s.join("."),a=Ra(i),c=Oa.exec(i);return c&&c[1]?new _a(t,o,a,c[1]):new va(t,o,a)}function Ra(i){for(var e=0,t=$r.length;e<t;e++){var r=$r[e],s=r[0],o=r[1],a=o.exec(i);if(a)return s}return null}function Ca(){var i=typeof K.process<"u"&&K.process.version;return i?new Ea(K.process.version.slice(1)):null}function Aa(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}var B={};Object.defineProperty(B,"__esModule",{value:!0});B.getLocalStorage=B.getLocalStorageOrThrow=B.getCrypto=B.getCryptoOrThrow=Gs=B.getLocation=B.getLocationOrThrow=Zi=B.getNavigator=B.getNavigatorOrThrow=Ws=B.getDocument=B.getDocumentOrThrow=B.getFromWindowOrThrow=B.getFromWindow=void 0;function St(i){let e;return typeof window<"u"&&typeof window[i]<"u"&&(e=window[i]),e}B.getFromWindow=St;function Dt(i){const e=St(i);if(!e)throw new Error(`${i} is not defined in Window`);return e}B.getFromWindowOrThrow=Dt;function $a(){return Dt("document")}B.getDocumentOrThrow=$a;function Da(){return St("document")}var Ws=B.getDocument=Da;function La(){return Dt("navigator")}B.getNavigatorOrThrow=La;function Ua(){return St("navigator")}var Zi=B.getNavigator=Ua;function Ma(){return Dt("location")}B.getLocationOrThrow=Ma;function qa(){return St("location")}var Gs=B.getLocation=qa;function ja(){return Dt("crypto")}B.getCryptoOrThrow=ja;function ka(){return St("crypto")}B.getCrypto=ka;function za(){return Dt("localStorage")}B.getLocalStorageOrThrow=za;function Ka(){return St("localStorage")}B.getLocalStorage=Ka;var er={};Object.defineProperty(er,"__esModule",{value:!0});var Js=er.getWindowMetadata=void 0;const Lr=B;function Fa(){let i,e;try{i=Lr.getDocumentOrThrow(),e=Lr.getLocationOrThrow()}catch{return null}function t(){const y=i.getElementsByTagName("link"),E=[];for(let N=0;N<y.length;N++){const I=y[N],T=I.getAttribute("rel");if(T&&T.toLowerCase().indexOf("icon")>-1){const C=I.getAttribute("href");if(C)if(C.toLowerCase().indexOf("https:")===-1&&C.toLowerCase().indexOf("http:")===-1&&C.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(C.indexOf("/")===0)q+=C;else{const h=e.pathname.split("/");h.pop();const f=h.join("/");q+=f+"/"+C}E.push(q)}else if(C.indexOf("//")===0){const q=e.protocol+C;E.push(q)}else E.push(C)}}return E}function r(...y){const E=i.getElementsByTagName("meta");for(let N=0;N<E.length;N++){const I=E[N],T=["itemprop","property","name"].map(C=>I.getAttribute(C)).filter(C=>C?y.includes(C):!1);if(T.length&&T){const C=I.getAttribute("content");if(C)return C}}return""}function s(){let y=r("name","og:site_name","og:title","twitter:title");return y||(y=i.title),y}function o(){return r("description","og:description","twitter:description","keywords")}const a=s(),c=o(),g=e.origin,l=t();return{description:c,url:g,icons:l,name:a}}Js=er.getWindowMetadata=Fa;var Jt={},Ys="%[a-f0-9]{2}",Ur=new RegExp("("+Ys+")|([^%]+?)","gi"),Mr=new RegExp("("+Ys+")+","gi");function qi(i,e){try{return[decodeURIComponent(i.join(""))]}catch{}if(i.length===1)return i;e=e||1;var t=i.slice(0,e),r=i.slice(e);return Array.prototype.concat.call([],qi(t),qi(r))}function Va(i){try{return decodeURIComponent(i)}catch{for(var e=i.match(Ur)||[],t=1;t<e.length;t++)i=qi(e,t).join(""),e=i.match(Ur)||[];return i}}function Ha(i){for(var e={"%FE%FF":"��","%FF%FE":"��"},t=Mr.exec(i);t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{var r=Va(t[0]);r!==t[0]&&(e[t[0]]=r)}t=Mr.exec(i)}e["%C2"]="�";for(var s=Object.keys(e),o=0;o<s.length;o++){var a=s[o];i=i.replace(new RegExp(a,"g"),e[a])}return i}var Ba=function(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return i=i.replace(/\+/g," "),decodeURIComponent(i)}catch{return Ha(i)}},Wa=(i,e)=>{if(!(typeof i=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[i];const t=i.indexOf(e);return t===-1?[i]:[i.slice(0,t),i.slice(t+e.length)]},Ga=function(i,e){for(var t={},r=Object.keys(i),s=Array.isArray(e),o=0;o<r.length;o++){var a=r[o],c=i[a];(s?e.indexOf(a)!==-1:e(a,c,i))&&(t[a]=c)}return t};(function(i){const e=Ns,t=Ba,r=Wa,s=Ga,o=h=>h==null,a=Symbol("encodeFragmentIdentifier");function c(h){switch(h.arrayFormat){case"index":return f=>(p,m)=>{const u=p.length;return m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),"[",u,"]"].join("")]:[...p,[d(f,h),"[",d(u,h),"]=",d(m,h)].join("")]};case"bracket":return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),"[]"].join("")]:[...p,[d(f,h),"[]=",d(m,h)].join("")];case"colon-list-separator":return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),":list="].join("")]:[...p,[d(f,h),":list=",d(m,h)].join("")];case"comma":case"separator":case"bracket-separator":{const f=h.arrayFormat==="bracket-separator"?"[]=":"=";return p=>(m,u)=>u===void 0||h.skipNull&&u===null||h.skipEmptyString&&u===""?m:(u=u===null?"":u,m.length===0?[[d(p,h),f,d(u,h)].join("")]:[[m,d(u,h)].join(h.arrayFormatSeparator)])}default:return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,d(f,h)]:[...p,[d(f,h),"=",d(m,h)].join("")]}}function g(h){let f;switch(h.arrayFormat){case"index":return(p,m,u)=>{if(f=/\[(\d*)\]$/.exec(p),p=p.replace(/\[\d*\]$/,""),!f){u[p]=m;return}u[p]===void 0&&(u[p]={}),u[p][f[1]]=m};case"bracket":return(p,m,u)=>{if(f=/(\[\])$/.exec(p),p=p.replace(/\[\]$/,""),!f){u[p]=m;return}if(u[p]===void 0){u[p]=[m];return}u[p]=[].concat(u[p],m)};case"colon-list-separator":return(p,m,u)=>{if(f=/(:list)$/.exec(p),p=p.replace(/:list$/,""),!f){u[p]=m;return}if(u[p]===void 0){u[p]=[m];return}u[p]=[].concat(u[p],m)};case"comma":case"separator":return(p,m,u)=>{const _=typeof m=="string"&&m.includes(h.arrayFormatSeparator),v=typeof m=="string"&&!_&&y(m,h).includes(h.arrayFormatSeparator);m=v?y(m,h):m;const D=_||v?m.split(h.arrayFormatSeparator).map(j=>y(j,h)):m===null?m:y(m,h);u[p]=D};case"bracket-separator":return(p,m,u)=>{const _=/(\[\])$/.test(p);if(p=p.replace(/\[\]$/,""),!_){u[p]=m&&y(m,h);return}const v=m===null?[]:m.split(h.arrayFormatSeparator).map(D=>y(D,h));if(u[p]===void 0){u[p]=v;return}u[p]=[].concat(u[p],v)};default:return(p,m,u)=>{if(u[p]===void 0){u[p]=m;return}u[p]=[].concat(u[p],m)}}}function l(h){if(typeof h!="string"||h.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function d(h,f){return f.encode?f.strict?e(h):encodeURIComponent(h):h}function y(h,f){return f.decode?t(h):h}function E(h){return Array.isArray(h)?h.sort():typeof h=="object"?E(Object.keys(h)).sort((f,p)=>Number(f)-Number(p)).map(f=>h[f]):h}function N(h){const f=h.indexOf("#");return f!==-1&&(h=h.slice(0,f)),h}function I(h){let f="";const p=h.indexOf("#");return p!==-1&&(f=h.slice(p)),f}function T(h){h=N(h);const f=h.indexOf("?");return f===-1?"":h.slice(f+1)}function C(h,f){return f.parseNumbers&&!Number.isNaN(Number(h))&&typeof h=="string"&&h.trim()!==""?h=Number(h):f.parseBooleans&&h!==null&&(h.toLowerCase()==="true"||h.toLowerCase()==="false")&&(h=h.toLowerCase()==="true"),h}function q(h,f){f=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},f),l(f.arrayFormatSeparator);const p=g(f),m=Object.create(null);if(typeof h!="string"||(h=h.trim().replace(/^[?#&]/,""),!h))return m;for(const u of h.split("&")){if(u==="")continue;let[_,v]=r(f.decode?u.replace(/\+/g," "):u,"=");v=v===void 0?null:["comma","separator","bracket-separator"].includes(f.arrayFormat)?v:y(v,f),p(y(_,f),v,m)}for(const u of Object.keys(m)){const _=m[u];if(typeof _=="object"&&_!==null)for(const v of Object.keys(_))_[v]=C(_[v],f);else m[u]=C(_,f)}return f.sort===!1?m:(f.sort===!0?Object.keys(m).sort():Object.keys(m).sort(f.sort)).reduce((u,_)=>{const v=m[_];return v&&typeof v=="object"&&!Array.isArray(v)?u[_]=E(v):u[_]=v,u},Object.create(null))}i.extract=T,i.parse=q,i.stringify=(h,f)=>{if(!h)return"";f=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},f),l(f.arrayFormatSeparator);const p=v=>f.skipNull&&o(h[v])||f.skipEmptyString&&h[v]==="",m=c(f),u={};for(const v of Object.keys(h))p(v)||(u[v]=h[v]);const _=Object.keys(u);return f.sort!==!1&&_.sort(f.sort),_.map(v=>{const D=h[v];return D===void 0?"":D===null?d(v,f):Array.isArray(D)?D.length===0&&f.arrayFormat==="bracket-separator"?d(v,f)+"[]":D.reduce(m(v),[]).join("&"):d(v,f)+"="+d(D,f)}).filter(v=>v.length>0).join("&")},i.parseUrl=(h,f)=>{f=Object.assign({decode:!0},f);const[p,m]=r(h,"#");return Object.assign({url:p.split("?")[0]||"",query:q(T(h),f)},f&&f.parseFragmentIdentifier&&m?{fragmentIdentifier:y(m,f)}:{})},i.stringifyUrl=(h,f)=>{f=Object.assign({encode:!0,strict:!0,[a]:!0},f);const p=N(h.url).split("?")[0]||"",m=i.extract(h.url),u=i.parse(m,{sort:!1}),_=Object.assign(u,h.query);let v=i.stringify(_,f);v&&(v=`?${v}`);let D=I(h.url);return h.fragmentIdentifier&&(D=`#${f[a]?d(h.fragmentIdentifier,f):h.fragmentIdentifier}`),`${p}${v}${D}`},i.pick=(h,f,p)=>{p=Object.assign({parseFragmentIdentifier:!0,[a]:!1},p);const{url:m,query:u,fragmentIdentifier:_}=i.parseUrl(h,p);return i.stringifyUrl({url:m,query:s(u,f),fragmentIdentifier:_},p)},i.exclude=(h,f,p)=>{const m=Array.isArray(f)?u=>!f.includes(u):(u,_)=>!f(u,_);return i.pick(h,m,p)}})(Jt);function Qs(i,e){return i.includes(":")?[i]:e.chains||[]}const Xs="base10",je="base16",ji="base64pad",tr="utf8",Zs=0,It=1,Ja=0,qr=1,ki=12,ir=32;function Ya(){const i=Ps.generateKeyPair();return{privateKey:ke(i.secretKey,je),publicKey:ke(i.publicKey,je)}}function zi(){const i=pi.randomBytes(ir);return ke(i,je)}function Qa(i,e){const t=Ps.sharedKey(He(i,je),He(e,je),!0),r=new qn(Wi.SHA256,t).expand(ir);return ke(r,je)}function Xa(i){const e=Wi.hash(He(i,je));return ke(e,je)}function At(i){const e=Wi.hash(He(i,tr));return ke(e,je)}function Za(i){return He(`${i}`,Xs)}function Zt(i){return Number(ke(i,Xs))}function ec(i){const e=Za(typeof i.type<"u"?i.type:Zs);if(Zt(e)===It&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?He(i.senderPublicKey,je):void 0,r=typeof i.iv<"u"?He(i.iv,je):pi.randomBytes(ki),s=new Ts.ChaCha20Poly1305(He(i.symKey,je)).seal(r,He(i.message,tr));return ic({type:e,sealed:s,iv:r,senderPublicKey:t})}function tc(i){const e=new Ts.ChaCha20Poly1305(He(i.symKey,je)),{sealed:t,iv:r}=fi(i.encoded),s=e.open(r,t);if(s===null)throw new Error("Failed to decrypt");return ke(s,tr)}function ic(i){if(Zt(i.type)===It){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ke(Ui([i.type,i.senderPublicKey,i.iv,i.sealed]),ji)}return ke(Ui([i.type,i.iv,i.sealed]),ji)}function fi(i){const e=He(i,ji),t=e.slice(Ja,qr),r=qr;if(Zt(t)===It){const c=r+ir,g=c+ki,l=e.slice(r,c),d=e.slice(c,g),y=e.slice(g);return{type:t,sealed:y,iv:d,senderPublicKey:l}}const s=r+ki,o=e.slice(r,s),a=e.slice(s);return{type:t,sealed:a,iv:o}}function rc(i,e){const t=fi(i);return en({type:Zt(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ke(t.senderPublicKey,je):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function en(i){const e=(i==null?void 0:i.type)||Zs;if(e===It){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function jr(i){return i.type===It&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}var sc=Object.defineProperty,kr=Object.getOwnPropertySymbols,nc=Object.prototype.hasOwnProperty,oc=Object.prototype.propertyIsEnumerable,zr=(i,e,t)=>e in i?sc(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Kr=(i,e)=>{for(var t in e||(e={}))nc.call(e,t)&&zr(i,t,e[t]);if(kr)for(var t of kr(e))oc.call(e,t)&&zr(i,t,e[t]);return i};const ac="ReactNative",We={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},cc="js";function rr(){return typeof K.process<"u"&&typeof K.process.versions<"u"&&typeof K.process.versions.node<"u"}function Lt(){return!Ws()&&!!Zi()&&navigator.product===ac}function Ut(){return!rr()&&!!Zi()}function ei(){return Lt()?We.reactNative:rr()?We.node:Ut()?We.browser:We.unknown}function hc(){var i;try{return Lt()&&typeof K.global<"u"&&typeof(K.global==null?void 0:K.global.Application)<"u"?(i=K.global.Application)==null?void 0:i.applicationId:void 0}catch{return}}function lc(i,e){let t=Jt.parse(i);return t=Kr(Kr({},t),e),i=Jt.stringify(t),i}function uc(){return Js()||{name:"",description:"",url:"",icons:[""]}}function dc(){if(ei()===We.reactNative&&typeof K.global<"u"&&typeof(K.global==null?void 0:K.global.Platform)<"u"){const{OS:t,Version:r}=K.global.Platform;return[t,r].join("-")}const i=Pa();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function fc(){var i;const e=ei();return e===We.browser?[e,((i=Gs())==null?void 0:i.host)||"unknown"].join(":"):e}function gc(i,e,t){const r=dc(),s=fc();return[[i,e].join("-"),[cc,t].join("-"),r,s].join("/")}function pc({protocol:i,version:e,relayUrl:t,sdkVersion:r,auth:s,projectId:o,useOnCloseEvent:a,bundleId:c}){const g=t.split("?"),l=gc(i,e,r),d={auth:s,ua:l,projectId:o,useOnCloseEvent:a||void 0,origin:c||void 0},y=lc(g[1]||"",d);return g[0]+"?"+y}function vt(i,e){return i.filter(t=>e.includes(t)).length===i.length}function tn(i){return Object.fromEntries(i.entries())}function rn(i){return new Map(Object.entries(i))}function Tt(i=M.FIVE_MINUTES,e){const t=M.toMiliseconds(i||M.FIVE_MINUTES);let r,s,o;return{resolve:a=>{o&&r&&(clearTimeout(o),r(a))},reject:a=>{o&&s&&(clearTimeout(o),s(a))},done:()=>new Promise((a,c)=>{o=setTimeout(()=>{c(new Error(e))},t),r=a,s=c})}}function Yt(i,e,t){return new Promise(async(r,s)=>{const o=setTimeout(()=>s(new Error(t)),e);try{const a=await i;r(a)}catch(a){s(a)}clearTimeout(o)})}function sn(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function yc(i){return sn("topic",i)}function mc(i){return sn("id",i)}function nn(i){const[e,t]=i.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function tt(i,e){return M.fromMiliseconds((e||Date.now())+M.toMiliseconds(i))}function pt(i){return Date.now()>=M.toMiliseconds(i)}function ne(i,e){return`${i}${e?`:${e}`:""}`}async function wc({id:i,topic:e,wcDeepLink:t}){try{if(!t)return;const r=typeof t=="string"?JSON.parse(t):t;let s=r==null?void 0:r.href;if(typeof s!="string")return;s.endsWith("/")&&(s=s.slice(0,-1));const o=`${s}/wc?requestId=${i}&sessionTopic=${e}`,a=ei();a===We.browser?o.startsWith("https://")?window.open(o,"_blank","noreferrer noopener"):window.open(o,"_self","noreferrer noopener"):a===We.reactNative&&typeof(K.global==null?void 0:K.global.Linking)<"u"&&await K.global.Linking.openURL(o)}catch(r){console.error(r)}}async function bc(i,e){try{return await i.getItem(e)||(Ut()?localStorage.getItem(e):void 0)}catch(t){console.error(t)}}const vc="irn";function Ki(i){return(i==null?void 0:i.relay)||{protocol:vc}}function li(i){const e=Gn[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}var Ec=Object.defineProperty,Fr=Object.getOwnPropertySymbols,_c=Object.prototype.hasOwnProperty,Sc=Object.prototype.propertyIsEnumerable,Vr=(i,e,t)=>e in i?Ec(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ic=(i,e)=>{for(var t in e||(e={}))_c.call(e,t)&&Vr(i,t,e[t]);if(Fr)for(var t of Fr(e))Sc.call(e,t)&&Vr(i,t,e[t]);return i};function xc(i,e="-"){const t={},r="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(r)){const o=s.replace(r,""),a=i[s];t[o]=a}}),t}function Hr(i){i=i.includes("wc://")?i.replace("wc://",""):i,i=i.includes("wc:")?i.replace("wc:",""):i;const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,r=i.substring(0,e),s=i.substring(e+1,t).split("@"),o=typeof t<"u"?i.substring(t):"",a=Jt.parse(o);return{protocol:r,topic:Oc(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:xc(a)}}function Oc(i){return i.startsWith("//")?i.substring(2):i}function Nc(i,e="-"){const t="relay",r={};return Object.keys(i).forEach(s=>{const o=t+e+s;i[s]&&(r[o]=i[s])}),r}function Pc(i){return`${i.protocol}:${i.topic}@${i.version}?`+Jt.stringify(Ic({symKey:i.symKey},Nc(i.relay)))}function Mt(i){const e=[];return i.forEach(t=>{const[r,s]=t.split(":");e.push(`${r}:${s}`)}),e}function Tc(i){const e=[];return Object.values(i).forEach(t=>{e.push(...Mt(t.accounts))}),e}function Rc(i,e){const t=[];return Object.values(i).forEach(r=>{Mt(r.accounts).includes(e)&&t.push(...r.methods)}),t}function Cc(i,e){const t=[];return Object.values(i).forEach(r=>{Mt(r.accounts).includes(e)&&t.push(...r.events)}),t}function Ac(i,e){const t=ui(i,e);if(t)throw new Error(t.message);const r={};for(const[s,o]of Object.entries(i))r[s]={methods:o.methods,events:o.events,chains:o.accounts.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)};return r}const $c={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Dc={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function A(i,e){const{message:t,code:r}=Dc[i];return{message:e?`${t} ${e}`:t,code:r}}function le(i,e){const{message:t,code:r}=$c[i];return{message:e?`${t} ${e}`:t,code:r}}function ti(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function Gt(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function qe(i){return typeof i>"u"}function ue(i,e){return e&&qe(i)?!0:typeof i=="string"&&!!i.trim().length}function sr(i,e){return e&&qe(i)?!0:typeof i=="number"&&!isNaN(i)}function Lc(i,e){const{requiredNamespaces:t}=e,r=Object.keys(i.namespaces),s=Object.keys(t);let o=!0;return vt(s,r)?(r.forEach(a=>{const{accounts:c,methods:g,events:l}=i.namespaces[a],d=Mt(c),y=t[a];(!vt(Qs(a,y),d)||!vt(y.methods,g)||!vt(y.events,l))&&(o=!1)}),o):!1}function gi(i){return ue(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function Uc(i){if(ue(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&gi(t)}}return!1}function Mc(i){if(ue(i,!1))try{return typeof new URL(i)<"u"}catch{return!1}return!1}function qc(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function jc(i){return i==null?void 0:i.topic}function kc(i,e){let t=null;return ue(i==null?void 0:i.publicKey,!1)||(t=A("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Br(i){let e=!0;return ti(i)?i.length&&(e=i.every(t=>ue(t,!1))):e=!1,e}function zc(i,e,t){let r=null;return ti(e)&&e.length?e.forEach(s=>{r||gi(s)||(r=le("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):gi(i)||(r=le("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Kc(i,e,t){let r=null;return Object.entries(i).forEach(([s,o])=>{if(r)return;const a=zc(s,Qs(s,o),`${e} ${t}`);a&&(r=a)}),r}function Fc(i,e){let t=null;return ti(i)?i.forEach(r=>{t||Uc(r)||(t=le("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=le("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Vc(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Fc(r==null?void 0:r.accounts,`${e} namespace`);s&&(t=s)}),t}function Hc(i,e){let t=null;return Br(i==null?void 0:i.methods)?Br(i==null?void 0:i.events)||(t=le("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=le("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function on(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Hc(r,`${e}, namespace`);s&&(t=s)}),t}function Bc(i,e,t){let r=null;if(i&&Gt(i)){const s=on(i,e);s&&(r=s);const o=Kc(i,e,t);o&&(r=o)}else r=A("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}function ui(i,e){let t=null;if(i&&Gt(i)){const r=on(i,e);r&&(t=r);const s=Vc(i,e);s&&(t=s)}else t=A("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function an(i){return ue(i.protocol,!0)}function Wc(i,e){let t=!1;return e&&!i?t=!0:i&&ti(i)&&i.length&&i.forEach(r=>{t=an(r)}),t}function Gc(i){return typeof i=="number"}function Ve(i){return typeof i<"u"&&typeof i!==null}function Jc(i){return!(!i||typeof i!="object"||!i.code||!sr(i.code,!1)||!i.message||!ue(i.message,!1))}function Yc(i){return!(qe(i)||!ue(i.method,!1))}function Qc(i){return!(qe(i)||qe(i.result)&&qe(i.error)||!sr(i.id,!1)||!ue(i.jsonrpc,!1))}function Xc(i){return!(qe(i)||!ue(i.name,!1))}function Wr(i,e){return!(!gi(e)||!Tc(i).includes(e))}function Zc(i,e,t){return ue(t,!1)?Rc(i,e).includes(t):!1}function eh(i,e,t){return ue(t,!1)?Cc(i,e).includes(t):!1}function Gr(i,e,t){let r=null;const s=th(i),o=ih(e),a=Object.keys(s),c=Object.keys(o),g=Jr(Object.keys(i)),l=Jr(Object.keys(e)),d=g.filter(y=>!l.includes(y));return d.length&&(r=A("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),vt(a,c)||(r=A("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(y=>{if(!y.includes(":")||r)return;const E=Mt(e[y].accounts);E.includes(y)||(r=A("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${y}
        Required: ${y}
        Approved: ${E.toString()}`))}),a.forEach(y=>{r||(vt(s[y].methods,o[y].methods)?vt(s[y].events,o[y].events)||(r=A("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${y}`)):r=A("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${y}`))}),r}function th(i){const e={};return Object.keys(i).forEach(t=>{var r;t.includes(":")?e[t]=i[t]:(r=i[t].chains)==null||r.forEach(s=>{e[s]={methods:i[t].methods,events:i[t].events}})}),e}function Jr(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function ih(i){const e={};return Object.keys(i).forEach(t=>{if(t.includes(":"))e[t]=i[t];else{const r=Mt(i[t].accounts);r==null||r.forEach(s=>{e[s]={accounts:i[t].accounts.filter(o=>o.includes(`${s}:`)),methods:i[t].methods,events:i[t].events}})}}),e}function rh(i,e){return sr(i,!1)&&i<=e.max&&i>=e.min}function Yr(){const i=ei();return new Promise(e=>{switch(i){case We.browser:e(sh());break;case We.reactNative:e(nh());break;case We.node:e(oh());break;default:e(!0)}})}function sh(){return Ut()&&(navigator==null?void 0:navigator.onLine)}async function nh(){if(Lt()&&typeof K.global<"u"&&K.global!=null&&K.global.NetInfo){const i=await(K.global==null?void 0:K.global.NetInfo.fetch());return i==null?void 0:i.isConnected}return!0}function oh(){return!0}function ah(i){switch(ei()){case We.browser:ch(i);break;case We.reactNative:hh(i);break}}function ch(i){!Lt()&&Ut()&&(window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1)))}function hh(i){var e;Lt()&&typeof K.global<"u"&&K.global!=null&&K.global.NetInfo&&((e=K.global)==null||e.NetInfo.addEventListener(t=>i(t==null?void 0:t.isConnected)))}const Ti={};let oi=class{static get(e){return Ti[e]}static set(e,t){Ti[e]=t}static delete(e){delete Ti[e]}};class lh extends Qn{constructor(e){super(e),this.events=new nt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Ct(e.method,e.params||[],e.id||Rs().toString()),t)}async requestStrict(e,t){return new Promise(async(r,s)=>{if(!this.connection.connected)try{await this.open()}catch(o){s(o)}this.events.on(`${e.id}`,o=>{et(o)?s(o.error):r(o.result)});try{await this.connection.send(e,t)}catch(o){s(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),yi(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const uh=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),dh=i=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=i.replace(e,'$1"$2n"$3');return JSON.parse(t,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function fh(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return dh(i)}catch{return i}}function gh(i){return typeof i=="string"?i:uh(i)||""}const ph=()=>typeof WebSocket<"u"?WebSocket:typeof K.global<"u"&&typeof K.global.WebSocket<"u"?K.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),yh=()=>typeof WebSocket<"u"||typeof K.global<"u"&&typeof K.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Qr=i=>i.split("?")[0],Xr=10,mh=ph();class wh{constructor(e){if(this.url=e,this.events=new nt.EventEmitter,this.registering=!1,!pr(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(gh(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!pr(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=new URLSearchParams(e).get("origin"),o=jn.isReactNative()?{headers:{origin:s}}:{rejectUnauthorized:!to(e)},a=new mh(e,[],o);yh()?a.onerror=c=>{const g=c;r(this.emitError(g.error))}:a.on("error",c=>{r(this.emitError(c))}),a.onopen=()=>{this.onOpen(a),t(a)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?fh(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),o=Gi(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return kn(e,Qr(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Xr&&this.events.setMaxListeners(Xr)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Qr(this.url)}`));return this.events.emit("register_error",t),t}}var bh={};function vh(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),a=o.charCodeAt(0);if(t[a]!==255)throw new TypeError(o+" is ambiguous");t[a]=s}var c=i.length,g=i.charAt(0),l=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function y(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var T=0,C=0,q=0,h=I.length;q!==h&&I[q]===0;)q++,T++;for(var f=(h-q)*d+1>>>0,p=new Uint8Array(f);q!==h;){for(var m=I[q],u=0,_=f-1;(m!==0||u<C)&&_!==-1;_--,u++)m+=256*p[_]>>>0,p[_]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");C=u,q++}for(var v=f-C;v!==f&&p[v]===0;)v++;for(var D=g.repeat(T);v<f;++v)D+=i.charAt(p[v]);return D}function E(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var T=0;if(I[T]!==" "){for(var C=0,q=0;I[T]===g;)C++,T++;for(var h=(I.length-T)*l+1>>>0,f=new Uint8Array(h);I[T];){var p=t[I.charCodeAt(T)];if(p===255)return;for(var m=0,u=h-1;(p!==0||m<q)&&u!==-1;u--,m++)p+=c*f[u]>>>0,f[u]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");q=m,T++}if(I[T]!==" "){for(var _=h-q;_!==h&&f[_]===0;)_++;for(var v=new Uint8Array(C+(h-_)),D=C;_!==h;)v[D++]=f[_++];return v}}}function N(I){var T=E(I);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:y,decodeUnsafe:E,decode:N}}var Eh=vh,_h=Eh;const cn=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Sh=i=>new TextEncoder().encode(i),Ih=i=>new TextDecoder().decode(i);class xh{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Oh{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hn(this,e)}}class Nh{constructor(e){this.decoders=e}or(e){return hn(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hn=(i,e)=>new Nh({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class Ph{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new xh(e,t,r),this.decoder=new Oh(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const mi=({name:i,prefix:e,encode:t,decode:r})=>new Ph(i,e,t,r),ii=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=_h(t,e);return mi({prefix:i,name:e,encode:r,decode:o=>cn(s(o))})},Th=(i,e,t,r)=>{const s={};for(let d=0;d<e.length;++d)s[e[d]]=d;let o=i.length;for(;i[o-1]==="=";)--o;const a=new Uint8Array(o*t/8|0);let c=0,g=0,l=0;for(let d=0;d<o;++d){const y=s[i[d]];if(y===void 0)throw new SyntaxError(`Non-${r} character`);g=g<<t|y,c+=t,c>=8&&(c-=8,a[l++]=255&g>>c)}if(c>=t||255&g<<8-c)throw new SyntaxError("Unexpected end of data");return a},Rh=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",a=0,c=0;for(let g=0;g<i.length;++g)for(c=c<<8|i[g],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),r)for(;o.length*t&7;)o+="=";return o},ge=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>mi({prefix:e,name:i,encode(s){return Rh(s,r,t)},decode(s){return Th(s,r,t,i)}}),Ch=mi({prefix:"\0",name:"identity",encode:i=>Ih(i),decode:i=>Sh(i)});var Ah=Object.freeze({__proto__:null,identity:Ch});const $h=ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Dh=Object.freeze({__proto__:null,base2:$h});const Lh=ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Uh=Object.freeze({__proto__:null,base8:Lh});const Mh=ii({prefix:"9",name:"base10",alphabet:"0123456789"});var qh=Object.freeze({__proto__:null,base10:Mh});const jh=ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kh=ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var zh=Object.freeze({__proto__:null,base16:jh,base16upper:kh});const Kh=ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Fh=ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vh=ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Hh=ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Bh=ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Wh=ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gh=ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Jh=ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yh=ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qh=Object.freeze({__proto__:null,base32:Kh,base32upper:Fh,base32pad:Vh,base32padupper:Hh,base32hex:Bh,base32hexupper:Wh,base32hexpad:Gh,base32hexpadupper:Jh,base32z:Yh});const Xh=ii({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Zh=ii({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var el=Object.freeze({__proto__:null,base36:Xh,base36upper:Zh});const tl=ii({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),il=ii({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rl=Object.freeze({__proto__:null,base58btc:tl,base58flickr:il});const sl=ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nl=ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ol=ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),al=ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var cl=Object.freeze({__proto__:null,base64:sl,base64pad:nl,base64url:ol,base64urlpad:al});const ln=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),hl=ln.reduce((i,e,t)=>(i[t]=e,i),[]),ll=ln.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function ul(i){return i.reduce((e,t)=>(e+=hl[t],e),"")}function dl(i){const e=[];for(const t of i){const r=ll[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const fl=mi({prefix:"🚀",name:"base256emoji",encode:ul,decode:dl});var gl=Object.freeze({__proto__:null,base256emoji:fl}),pl=un,Zr=128,yl=127,ml=~yl,wl=Math.pow(2,31);function un(i,e,t){e=e||[],t=t||0;for(var r=t;i>=wl;)e[t++]=i&255|Zr,i/=128;for(;i&ml;)e[t++]=i&255|Zr,i>>>=7;return e[t]=i|0,un.bytes=t-r+1,e}var bl=Fi,vl=128,es=127;function Fi(i,r){var t=0,r=r||0,s=0,o=r,a,c=i.length;do{if(o>=c)throw Fi.bytes=0,new RangeError("Could not decode varint");a=i[o++],t+=s<28?(a&es)<<s:(a&es)*Math.pow(2,s),s+=7}while(a>=vl);return Fi.bytes=o-r,t}var El=Math.pow(2,7),_l=Math.pow(2,14),Sl=Math.pow(2,21),Il=Math.pow(2,28),xl=Math.pow(2,35),Ol=Math.pow(2,42),Nl=Math.pow(2,49),Pl=Math.pow(2,56),Tl=Math.pow(2,63),Rl=function(i){return i<El?1:i<_l?2:i<Sl?3:i<Il?4:i<xl?5:i<Ol?6:i<Nl?7:i<Pl?8:i<Tl?9:10},Cl={encode:pl,decode:bl,encodingLength:Rl},dn=Cl;const ts=(i,e,t=0)=>(dn.encode(i,e,t),e),is=i=>dn.encodingLength(i),Vi=(i,e)=>{const t=e.byteLength,r=is(i),s=r+is(t),o=new Uint8Array(s+t);return ts(i,o,0),ts(t,o,r),o.set(e,s),new Al(i,t,e,o)};class Al{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const fn=({name:i,code:e,encode:t})=>new $l(i,e,t);class $l{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Vi(this.code,t):t.then(r=>Vi(this.code,r))}else throw Error("Unknown type, must be binary type")}}const gn=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Dl=fn({name:"sha2-256",code:18,encode:gn("SHA-256")}),Ll=fn({name:"sha2-512",code:19,encode:gn("SHA-512")});var Ul=Object.freeze({__proto__:null,sha256:Dl,sha512:Ll});const pn=0,Ml="identity",yn=cn,ql=i=>Vi(pn,yn(i)),jl={code:pn,name:Ml,encode:yn,digest:ql};var kl=Object.freeze({__proto__:null,identity:jl});new TextEncoder,new TextDecoder;const rs={...Ah,...Dh,...Uh,...qh,...zh,...Qh,...el,...rl,...cl,...gl};({...Ul,...kl});function mn(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function zl(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?mn(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function wn(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const ss=wn("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),Ri=wn("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=zl(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Kl={utf8:ss,"utf-8":ss,hex:rs.base16,latin1:Ri,ascii:Ri,binary:Ri,...rs};function Fl(i,e="utf8"){const t=Kl[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?mn(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}const bn="wc",Vl=2,nr="core",yt=`${bn}@2:${nr}:`,Hl={name:nr,logger:"error"},Bl={database:":memory:"},Wl="crypto",ns="client_ed25519_seed",Gl=M.ONE_DAY,Jl="keychain",Yl="0.3",Ql="messages",Xl="0.3",Zl=M.SIX_HOURS,eu="publisher",vn="irn",tu="error",En="wss://relay.walletconnect.com",os="wss://relay.walletconnect.org",iu="relayer",$e={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ru="_subscription",ht={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},su=M.ONE_SECOND,nu="2.10.6",ou=1e4,au="0.3",cu="WALLETCONNECT_CLIENT_ID",Ze={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hu="subscription",lu="0.3",uu=M.FIVE_SECONDS*1e3,du="pairing",fu="0.3",Ft={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Wt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},st={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},gu="history",pu="0.3",yu="expirer",Ye={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},mu="0.3",Ci="verify-api",Rt="https://verify.walletconnect.com",Hi="https://verify.walletconnect.org",wu=[Rt,Hi];class bu{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Jl,this.version=Yl,this.initialized=!1,this.storagePrefix=yt,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()},this.get=r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:o}=A("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=F.generateChildLogger(t,this.name)}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,tn(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?rn(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class vu{constructor(e,t,r){this.core=e,this.logger=t,this.name=Wl,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=Rr(s);return Bs(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Ya();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),a=Rr(o),c=zi();return await ba(c,s,Gl,a)},this.generateSharedKey=(s,o,a)=>{this.isInitialized();const c=this.getPrivateKey(s),g=Qa(c,o);return this.setSymKey(g,a)},this.setSymKey=async(s,o)=>{this.isInitialized();const a=o||Xa(s);return await this.keychain.set(a,s),a},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,a)=>{this.isInitialized();const c=en(a),g=ra(o);if(jr(c)){const E=c.senderPublicKey,N=c.receiverPublicKey;s=await this.generateSharedKey(E,N)}const l=this.getSymKey(s),{type:d,senderPublicKey:y}=c;return ec({type:d,symKey:l,message:g,senderPublicKey:y})},this.decode=async(s,o,a)=>{this.isInitialized();const c=rc(o,a);if(jr(c)){const g=c.receiverPublicKey,l=c.senderPublicKey;s=await this.generateSharedKey(g,l)}try{const g=this.getSymKey(s),l=tc({symKey:g,encoded:o});return ia(l)}catch(g){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(g)}},this.getPayloadType=s=>{const o=fi(s);return Zt(o.type)},this.getPayloadSenderPublicKey=s=>{const o=fi(s);return o.senderPublicKey?ke(o.senderPublicKey,je):void 0},this.core=e,this.logger=F.generateChildLogger(t,this.name),this.keychain=r||new bu(this.core,this.logger)}get context(){return F.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ns)}catch{e=zi(),await this.keychain.set(ns,e)}return Fl(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Eu extends Ho{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Ql,this.version=Xl,this.initialized=!1,this.storagePrefix=yt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,s)=>{this.isInitialized();const o=At(s);let a=this.messages.get(r);return typeof a>"u"&&(a={}),typeof a[o]<"u"||(a[o]=s,this.messages.set(r,a),await this.persist()),o},this.get=r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s},this.has=(r,s)=>{this.isInitialized();const o=this.get(r),a=At(s);return typeof o[a]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=F.generateChildLogger(e,this.name),this.core=t}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,tn(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?rn(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class _u extends Bo{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new nt.EventEmitter,this.name=eu,this.queue=new Map,this.publishTimeout=M.toMiliseconds(M.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(r,s,o)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}});try{const c=(o==null?void 0:o.ttl)||Zl,g=Ki(o),l=(o==null?void 0:o.prompt)||!1,d=(o==null?void 0:o.tag)||0,y=(o==null?void 0:o.id)||Rs().toString(),E={topic:r,message:s,opts:{ttl:c,relay:g,prompt:l,tag:d,id:y}},N=setTimeout(()=>this.queue.set(y,E),this.publishTimeout);try{await await Yt(this.rpcPublish(r,s,c,g,l,d,y),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(y),this.relayer.events.emit($e.publish,E)}catch(I){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=o==null?void 0:o.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(y),I;return}finally{clearTimeout(N)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.relayer=e,this.logger=F.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return F.getLoggerContext(this.logger)}rpcPublish(e,t,r,s,o,a,c){var g,l,d,y;const E={method:li(s.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:o,tag:a},id:c};return qe((g=E.params)==null?void 0:g.prompt)&&((l=E.params)==null||delete l.prompt),qe((d=E.params)==null?void 0:d.tag)&&((y=E.params)==null||delete y.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.request(E)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:r,opts:s}=e;await this.publish(t,r,s)})}registerEventListeners(){this.relayer.core.heartbeat.on($t.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit($e.connection_stalled);return}this.checkQueue()}),this.relayer.on($e.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Su{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Iu=Object.defineProperty,xu=Object.defineProperties,Ou=Object.getOwnPropertyDescriptors,as=Object.getOwnPropertySymbols,Nu=Object.prototype.hasOwnProperty,Pu=Object.prototype.propertyIsEnumerable,cs=(i,e,t)=>e in i?Iu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Vt=(i,e)=>{for(var t in e||(e={}))Nu.call(e,t)&&cs(i,t,e[t]);if(as)for(var t of as(e))Pu.call(e,t)&&cs(i,t,e[t]);return i},Ai=(i,e)=>xu(i,Ou(e));class Tu extends Jo{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Su,this.events=new nt.EventEmitter,this.name=hu,this.version=lu,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=yt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=Ki(s),a={topic:r,relay:o};this.pending.set(r,a);const c=await this.rpcSubscribe(r,o);return this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)},this.isSubscribed=async r=>this.topics.includes(r)?!0:await new Promise((s,o)=>{const a=new M.Watch;a.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),s(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=uu&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),o(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=F.generateChildLogger(t,this.name),this.clientId=""}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=Ki(r);await this.rpcUnsubscribe(e,t,s);const o=le("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const r={method:li(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Yt(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit($e.connection_stalled)}return At(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:li(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await Yt(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit($e.connection_stalled)}}rpcUnsubscribe(e,t,r){const s={method:li(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Ai(Vt({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Vt({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Vt({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ze.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=A("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Ze.deleted,Ai(Vt({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ze.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const r=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(Ze.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);ti(t)&&this.onBatchSubscribe(t.map((r,s)=>Ai(Vt({},e[s]),{id:r})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on($t.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on($e.connect,async()=>{await this.onConnect()}),this.relayer.on($e.disconnect,()=>{this.onDisconnect()}),this.events.on(Ze.created,async e=>{const t=Ze.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Ze.deleted,async e=>{const t=Ze.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var Ru=Object.defineProperty,hs=Object.getOwnPropertySymbols,Cu=Object.prototype.hasOwnProperty,Au=Object.prototype.propertyIsEnumerable,ls=(i,e,t)=>e in i?Ru(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$u=(i,e)=>{for(var t in e||(e={}))Cu.call(e,t)&&ls(i,t,e[t]);if(hs)for(var t of hs(e))Au.call(e,t)&&ls(i,t,e[t]);return i};class Du extends Wo{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new nt.EventEmitter,this.name=iu,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(r){throw this.logger.debug("Failed to Publish Request"),this.logger.error(r),r}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit($e.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit($e.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ht.payload,this.onPayloadHandler),this.provider.on(ht.connect,this.onConnectHandler),this.provider.on(ht.disconnect,this.onDisconnectHandler),this.provider.on(ht.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?F.generateChildLogger(e.logger,this.name):F.pino(F.getDefaultLoggerOptions({level:e.logger||tu})),this.messages=new Eu(this.logger,e.core),this.subscriber=new Tu(this,this.logger),this.publisher=new _u(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||En,this.projectId=e.projectId,this.bundleId=hc(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${os}...`),await this.restartTransport(os)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},ou)}get context(){return F.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var r;this.isInitialized();let s=((r=this.subscriber.topicMap.get(e))==null?void 0:r[0])||"";if(s)return s;let o;const a=c=>{c.topic===e&&(this.subscriber.off(Ze.created,a),o())};return await Promise.all([new Promise(c=>{o=c,this.subscriber.on(Ze.created,a)}),new Promise(async c=>{s=await this.subscriber.subscribe(e,t),c()})]),s}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Yt(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Ze.resubscribed,()=>{t()})}),new Promise(async(t,r)=>{try{await Yt(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){r(s);return}t()})])}catch(t){this.logger.error(t);const r=t;if(!this.isConnectionStalled(r.message))throw t;this.provider.events.emit(ht.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Yr())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new lh(new wh(pc({sdkVersion:nu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;if(!r||r.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,r);return s&&this.logger.debug(`Ignoring duplicate message: ${r}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Qi(e)){if(!e.method.endsWith(ru))return;const t=e.params,{topic:r,message:s,publishedAt:o}=t.data,a={topic:r,message:s,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($u({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else yi(e)&&this.events.emit($e.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit($e.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Ji(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ht.payload,this.onPayloadHandler),this.provider.off(ht.connect,this.onConnectHandler),this.provider.off(ht.disconnect,this.onDisconnectHandler),this.provider.off(ht.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on($e.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let e=await Yr();ah(async t=>{this.initialized&&e!==t&&(e=t,t?await this.restartTransport().catch(r=>this.logger.error(r)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(r=>this.logger.error(r))))})}onProviderDisconnect(){this.events.emit($e.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},M.toMiliseconds(su)))}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Lu=Object.defineProperty,us=Object.getOwnPropertySymbols,Uu=Object.prototype.hasOwnProperty,Mu=Object.prototype.propertyIsEnumerable,ds=(i,e,t)=>e in i?Lu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,fs=(i,e)=>{for(var t in e||(e={}))Uu.call(e,t)&&ds(i,t,e[t]);if(us)for(var t of us(e))Mu.call(e,t)&&ds(i,t,e[t]);return i};class wi extends Go{constructor(e,t,r,s=yt,o=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version=au,this.cached=[],this.initialized=!1,this.storagePrefix=yt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!qe(a)?this.map.set(this.getKey(a),a):qc(a)?this.map.set(a.id,a):jc(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,c)=>{this.isInitialized(),this.map.has(a)?await this.update(a,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:c}),this.map.set(a,c),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(g=>zn(c[g],a[g]))):this.values),this.update=async(a,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:c});const g=fs(fs({},this.getData(a)),c);this.map.set(a,g),await this.persist()},this.delete=async(a,c)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:c}),this.map.delete(a),await this.persist())},this.logger=F.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:r}=A("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class qu{constructor(e,t){this.core=e,this.logger=t,this.name=du,this.version=fu,this.events=new Cs,this.initialized=!1,this.storagePrefix=yt,this.ignoredPayloadTypes=[It],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async()=>{this.isInitialized();const r=zi(),s=await this.core.crypto.setSymKey(r),o=tt(M.FIVE_MINUTES),a={protocol:vn},c={topic:s,expiry:o,relay:a,active:!1},g=Pc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:r,relay:a});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:g}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:s,symKey:o,relay:a}=Hr(r.uri);let c;if(this.pairings.keys.includes(s)&&(c=this.pairings.get(s),c.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);const g=tt(M.FIVE_MINUTES),l={topic:s,relay:a,expiry:g,active:!1};return await this.pairings.set(s,l),this.core.expirer.set(s,g),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Wt.create,l),this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:a})),l},this.activate=async({topic:r})=>{this.isInitialized();const s=tt(M.THIRTY_DAYS);await this.pairings.update(r,{active:!0,expiry:s}),this.core.expirer.set(r,s)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:a,resolve:c,reject:g}=Tt();this.events.once(ne("pairing_ping",o),({error:l})=>{l?g(l):c()}),await a()}},this.updateExpiry=async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})},this.updateMetadata=async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",le("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(r,s,o)=>{const a=Ct(s,o),c=await this.core.crypto.encode(r,a),g=Ft[s].req;return this.core.history.set(r,a),this.core.relayer.publish(r,c,g),a.id},this.sendResult=async(r,s,o)=>{const a=Ji(r,o),c=await this.core.crypto.encode(s,a),g=await this.core.history.get(s,r),l=Ft[g.request.method].res;await this.core.relayer.publish(s,c,l),await this.core.history.resolve(a)},this.sendError=async(r,s,o)=>{const a=Gi(r,o),c=await this.core.crypto.encode(s,a),g=await this.core.history.get(s,r),l=Ft[g.request.method]?Ft[g.request.method].res:Ft.unregistered_method.res;await this.core.relayer.publish(s,c,l),await this.core.history.resolve(a)},this.deletePairing=async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,le("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(s=>pt(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r;switch(o.method){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,a=(await this.core.history.get(s,o.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.events.emit(Wt.ping,{id:o,topic:r})}catch(a){await this.sendError(o,r,a),this.logger.error(a)}},this.onPairingPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{ut(s)?this.events.emit(ne("pairing_ping",o),{}):et(s)&&this.events.emit(ne("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Wt.delete,{id:o,topic:r})}catch(a){await this.sendError(o,r,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(r,s)=>{const{id:o,method:a}=s;try{if(this.registeredMethods.includes(a))return;const c=le("WC_METHOD_UNSUPPORTED",a);await this.sendError(o,r,c),this.logger.error(c)}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(le("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{var s;if(!Ve(r)){const{message:a}=A("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(a)}if(!Mc(r.uri)){const{message:a}=A("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(a)}const o=Hr(r.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=A("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=A("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(a)}},this.isValidPing=async r=>{if(!Ve(r)){const{message:o}=A("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidDisconnect=async r=>{if(!Ve(r)){const{message:o}=A("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async r=>{if(!ue(r,!1)){const{message:s}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(pt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=A("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}},this.core=e,this.logger=F.generateChildLogger(t,this.name),this.pairings=new wi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return F.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on($e.message,async e=>{const{topic:t,message:r}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const s=await this.core.crypto.decode(t,r);try{Qi(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):yi(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.core.history.delete(t,s.id))}catch(o){this.logger.error(o)}})}registerExpirerEvents(){this.core.expirer.on(Ye.expired,async e=>{const{topic:t}=nn(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Wt.expire,{topic:t}))})}}class ju extends Vo{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new nt.EventEmitter,this.name=gu,this.version=pu,this.cached=[],this.initialized=!1,this.storagePrefix=yt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:o}),this.records.has(s.id))return;const a={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:o,expiry:tt(M.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(st.created,a)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=et(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.events.emit(st.updated,s))},this.get=async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s)),this.delete=(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===r){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(st.deleted,o)}})},this.exists=async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=F.generateChildLogger(t,this.name)}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:Ct(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=A("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(st.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(st.created,e=>{const t=st.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(st.updated,e=>{const t=st.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(st.deleted,e=>{const t=st.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.core.heartbeat.on($t.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{M.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ku extends Yo{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new nt.EventEmitter,this.name=yu,this.version=mu,this.cached=[],this.initialized=!1,this.storagePrefix=yt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(r,s)=>{this.isInitialized();const o=this.formatTarget(r),a={target:o,expiry:s};this.expirations.set(o,a),this.checkExpiry(o,a),this.events.emit(Ye.created,{target:o,expiration:a})},this.get=r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)},this.del=r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Ye.deleted,{target:s,expiration:o})}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=F.generateChildLogger(t,this.name)}get context(){return F.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return yc(e);if(typeof e=="number")return mc(e);const{message:t}=A("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ye.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=A("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;M.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Ye.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on($t.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ye.created,e=>{const t=Ye.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ye.expired,e=>{const t=Ye.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ye.deleted,e=>{const t=Ye.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}}}class zu extends Qo{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=Ci,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async r=>{if(this.verifyDisabled||Lt()||!Ut())return;const s=this.getVerifyUrl(r==null?void 0:r.verifyUrl);this.verifyUrl!==s&&this.removeIframe(),this.verifyUrl=s;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Hi;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async r=>{this.initialized?this.sendPost(r.attestationId):(this.addToQueue(r.attestationId),await this.init())},this.resolve=async r=>{if(this.isDevEnv)return"";const s=this.getVerifyUrl(r==null?void 0:r.verifyUrl);let o;try{o=await this.fetchAttestation(r.attestationId,s)}catch(a){this.logger.info(`failed to resolve attestation: ${r.attestationId} from url: ${s}`),this.logger.info(a),o=await this.fetchAttestation(r.attestationId,Hi)}return o},this.fetchAttestation=async(r,s)=>{this.logger.info(`resolving attestation: ${r} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*2),a=await fetch(`${s}/attestation/${r}`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0},this.addToQueue=r=>{this.queue.push(r)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(r=>this.sendPost(r)),this.queue=[])},this.sendPost=r=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(r,"*"),this.logger.info(`postMessage sent: ${r} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let r;const s=o=>{o.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),r())};await Promise.race([new Promise(o=>{if(document.getElementById(Ci))return o();window.addEventListener("message",s);const a=document.createElement("iframe");a.id=Ci,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,r=o}),new Promise((o,a)=>setTimeout(()=>{window.removeEventListener("message",s),a("verify iframe load timeout")},M.toMiliseconds(M.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=r=>{let s=r||Rt;return wu.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Rt}`),s=Rt),s},this.logger=F.generateChildLogger(t,this.name),this.verifyUrl=Rt,this.abortController=new AbortController,this.isDevEnv=rr()&&bh.IS_VITEST}get context(){return F.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var Ku=Object.defineProperty,gs=Object.getOwnPropertySymbols,Fu=Object.prototype.hasOwnProperty,Vu=Object.prototype.propertyIsEnumerable,ps=(i,e,t)=>e in i?Ku(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ys=(i,e)=>{for(var t in e||(e={}))Fu.call(e,t)&&ps(i,t,e[t]);if(gs)for(var t of gs(e))Vu.call(e,t)&&ps(i,t,e[t]);return i};class or extends Fo{constructor(e){super(e),this.protocol=bn,this.version=Vl,this.name=nr,this.events=new nt.EventEmitter,this.initialized=!1,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||En,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:F.pino(F.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Hl.logger}));this.logger=F.generateChildLogger(t,this.name),this.heartbeat=new $t.HeartBeat,this.crypto=new vu(this,this.logger,e==null?void 0:e.keychain),this.history=new ju(this,this.logger),this.expirer=new ku(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Do(ys(ys({},Bl),e==null?void 0:e.storageOptions)),this.relayer=new Du({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new qu(this,this.logger),this.verify=new zu(this.projectId||"",this.logger)}static async init(e){const t=new or(e);await t.initialize();const r=await t.crypto.getClientId();return await t.storage.setItem(cu,r),t}get context(){return F.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Hu=or,_n="wc",Sn=2,In="client",ar=`${_n}@${Sn}:${In}:`,$i={name:In,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ms="WALLETCONNECT_DEEPLINK_CHOICE",Bu="proposal",Wu="Proposal expired",Gu="session",ai=M.SEVEN_DAYS,Ju="engine",Ht={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1115}}},Di={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},lt={idle:"IDLE",active:"ACTIVE"},Yu="request",Qu=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Xu=Object.defineProperty,Zu=Object.defineProperties,ed=Object.getOwnPropertyDescriptors,ws=Object.getOwnPropertySymbols,td=Object.prototype.hasOwnProperty,id=Object.prototype.propertyIsEnumerable,bs=(i,e,t)=>e in i?Xu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ke=(i,e)=>{for(var t in e||(e={}))td.call(e,t)&&bs(i,t,e[t]);if(ws)for(var t of ws(e))id.call(e,t)&&bs(i,t,e[t]);return i},Bt=(i,e)=>Zu(i,ed(e));class rd extends Zo{constructor(e){super(e),this.name=Ju,this.events=new Cs,this.initialized=!1,this.ignoredPayloadTypes=[It],this.requestQueue={state:lt.idle,queue:[]},this.sessionRequestQueue={state:lt.idle,queue:[]},this.requestQueueDelay=M.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ht)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const r=Bt(Ke({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,relays:g}=r;let l=s,d,y=!1;if(l&&(y=this.client.core.pairing.pairings.get(l).active),!l||!y){const{topic:f,uri:p}=await this.client.core.pairing.create();l=f,d=p}const E=await this.client.core.crypto.generateKeyPair(),N=Ke({requiredNamespaces:o,optionalNamespaces:a,relays:g??[{protocol:vn}],proposer:{publicKey:E,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:I,resolve:T,done:C}=Tt(M.FIVE_MINUTES,Wu);if(this.events.once(ne("session_connect"),async({error:f,session:p})=>{if(f)I(f);else if(p){p.self.publicKey=E;const m=Bt(Ke({},p),{requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces});await this.client.session.set(p.topic,m),await this.setExpiry(p.topic,p.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:p.peer.metadata}),T(m)}}),!l){const{message:f}=A("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(f)}const q=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:N}),h=tt(M.FIVE_MINUTES);return await this.setProposal(q,Ke({id:q,expiry:h},N)),{uri:d,approval:C}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:r,relayProtocol:s,namespaces:o,sessionProperties:a}=t,c=this.client.proposal.get(r);let{pairingTopic:g,proposer:l,requiredNamespaces:d,optionalNamespaces:y}=c;g=g||"",Gt(d)||(d=Ac(o,"approve()"));const E=await this.client.core.crypto.generateKeyPair(),N=l.publicKey,I=await this.client.core.crypto.generateSharedKey(E,N);g&&r&&(await this.client.core.pairing.updateMetadata({topic:g,metadata:l.metadata}),await this.sendResult({id:r,topic:g,result:{relay:{protocol:s??"irn"},responderPublicKey:E}}),await this.client.proposal.delete(r,le("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}));const T=Ke({relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:d,optionalNamespaces:y,pairingTopic:g,controller:{publicKey:E,metadata:this.client.metadata},expiry:tt(ai)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(I),await this.sendRequest({topic:I,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0});const C=Bt(Ke({},T),{topic:I,pairingTopic:g,acknowledged:!1,self:T.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:E});return await this.client.session.set(I,C),await this.setExpiry(I,tt(ai)),{topic:I,acknowledged:()=>new Promise(q=>setTimeout(()=>q(this.client.session.get(I)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:r,reason:s}=t,{pairingTopic:o}=this.client.proposal.get(r);o&&(await this.sendError(r,o,s),await this.client.proposal.delete(r,le("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:r,namespaces:s}=t,o=await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:s}}),{done:a,resolve:c,reject:g}=Tt();return this.events.once(ne("session_update",o),({error:l})=>{l?g(l):c()}),await this.client.session.update(r,{namespaces:s}),{acknowledged:a}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:r}=t,s=await this.sendRequest({topic:r,method:"wc_sessionExtend",params:{}}),{done:o,resolve:a,reject:c}=Tt();return this.events.once(ne("session_extend",s),({error:g})=>{g?c(g):a()}),await this.setExpiry(r,tt(ai)),{acknowledged:o}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:r,request:s,topic:o,expiry:a}=t,c=Kn(),{done:g,resolve:l,reject:d}=Tt(a,"Request expired. Please try again.");return this.events.once(ne("session_request",c),({error:y,result:E})=>{y?d(y):l(E)}),await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,topic:o,method:"wc_sessionRequest",params:{request:s,chainId:r},expiry:a,throwOnFailedPublish:!0}).catch(E=>d(E)),this.client.events.emit("session_request_sent",{topic:o,request:s,chainId:r,id:c}),y()}),new Promise(async y=>{const E=await bc(this.client.core.storage,ms);wc({id:c,topic:o,wcDeepLink:E}),y()}),g()]).then(y=>y[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:s}=t,{id:o}=s;ut(s)?await this.sendResult({id:o,topic:r,result:s.result,throwOnFailedPublish:!0}):et(s)&&await this.sendError(o,r,s.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:r}=t;if(this.client.session.keys.includes(r)){const s=await this.sendRequest({topic:r,method:"wc_sessionPing",params:{}}),{done:o,resolve:a,reject:c}=Tt();this.events.once(ne("session_ping",s),({error:g})=>{g?c(g):a()}),await o()}else this.client.core.pairing.pairings.keys.includes(r)&&await this.client.core.pairing.ping({topic:r})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:r,event:s,chainId:o}=t;await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:s,chainId:o}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:r}=t;this.client.session.keys.includes(r)?(await this.sendRequest({topic:r,method:"wc_sessionDelete",params:le("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(r)):await this.client.core.pairing.disconnect({topic:r})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(r=>Lc(r,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const r=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(o=>{var a,c;return((a=o.peerMetadata)==null?void 0:a.url)&&((c=o.peerMetadata)==null?void 0:c.url)===t.peer.metadata.url&&o.topic&&o.topic!==r.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(o=>this.client.core.pairing.disconnect({topic:o.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}},this.deleteSession=async(t,r)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,le("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),r||this.client.core.expirer.del(t),this.client.core.storage.removeItem(ms).catch(o=>this.client.logger.warn(o))},this.deleteProposal=async(t,r)=>{await Promise.all([this.client.proposal.delete(t,le("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(o=>o.id!==t),s&&(this.sessionRequestQueue.state=lt.idle)},this.setExpiry=async(t,r)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:r}),this.client.core.expirer.set(t,r)},this.setProposal=async(t,r)=>{await this.client.proposal.set(t,r),this.client.core.expirer.set(t,r.expiry)},this.setPendingSessionRequest=async t=>{const r=Ht.wc_sessionRequest.req.ttl,{id:s,topic:o,params:a,verifyContext:c}=t;await this.client.pendingRequest.set(s,{id:s,topic:o,params:a,verifyContext:c}),r&&this.client.core.expirer.set(s,tt(r))},this.sendRequest=async t=>{const{topic:r,method:s,params:o,expiry:a,relayRpcId:c,clientRpcId:g,throwOnFailedPublish:l}=t,d=Ct(s,o,g);if(Ut()&&Qu.includes(s)){const N=At(JSON.stringify(d));this.client.core.verify.register({attestationId:N})}const y=await this.client.core.crypto.encode(r,d),E=Ht[s].req;return a&&(E.ttl=a),c&&(E.id=c),this.client.core.history.set(r,d),l?(E.internal=Bt(Ke({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,y,E)):this.client.core.relayer.publish(r,y,E).catch(N=>this.client.logger.error(N)),d.id},this.sendResult=async t=>{const{id:r,topic:s,result:o,throwOnFailedPublish:a}=t,c=Ji(r,o),g=await this.client.core.crypto.encode(s,c),l=await this.client.core.history.get(s,r),d=Ht[l.request.method].res;a?(d.internal=Bt(Ke({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,g,d)):this.client.core.relayer.publish(s,g,d).catch(y=>this.client.logger.error(y)),await this.client.core.history.resolve(c)},this.sendError=async(t,r,s)=>{const o=Gi(t,s),a=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),g=Ht[c.request.method].res;this.client.core.relayer.publish(r,a,g),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const t=[],r=[];this.client.session.getAll().forEach(s=>{pt(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{pt(s.expiry)&&r.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...r.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===lt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=lt.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(r=>setTimeout(r,300))}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=lt.idle},this.processRequest=t=>{const{topic:r,payload:s}=t,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(r,s);case"wc_sessionSettle":return this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return this.onSessionExtendRequest(r,s);case"wc_sessionPing":return this.onSessionPingRequest(r,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return this.onSessionRequest(r,s);case"wc_sessionEvent":return this.onSessionEventRequest(r,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async t=>{const{topic:r,payload:s}=t,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:r}=t,{message:s}=A("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidConnect(Ke({},r.params));const a=tt(M.FIVE_MINUTES),c=Ke({id:o,pairingTopic:t,expiry:a},s);await this.setProposal(o,c);const g=At(JSON.stringify(r)),l=await this.getVerifyContext(g,c.proposer.metadata);this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:l})}catch(a){await this.sendError(o,t,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(t,r)=>{const{id:s}=r;if(ut(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const g=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:g});const l=await this.client.core.crypto.generateSharedKey(c,g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const d=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:t})}else et(r)&&(await this.client.proposal.delete(s,le("USER_DISCONNECTED")),this.events.emit(ne("session_connect"),{error:r.error}))},this.onSessionSettleRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidSessionSettleRequest(o);const{relay:a,controller:c,expiry:g,namespaces:l,requiredNamespaces:d,optionalNamespaces:y,sessionProperties:E,pairingTopic:N}=r.params,I=Ke({topic:t,relay:a,expiry:g,namespaces:l,acknowledged:!0,pairingTopic:N,requiredNamespaces:d,optionalNamespaces:y,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},E&&{sessionProperties:E});await this.sendResult({id:r.id,topic:t,result:!0}),this.events.emit(ne("session_connect"),{session:I}),this.cleanupDuplicatePairings(I)}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(t,r)=>{const{id:s}=r;ut(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ne("session_approve",s),{})):et(r)&&(await this.client.session.delete(t,le("USER_DISCONNECTED")),this.events.emit(ne("session_approve",s),{error:r.error}))},this.onSessionUpdateRequest=async(t,r)=>{const{params:s,id:o}=r;try{const a=`${t}_session_update`,c=oi.get(a);if(c&&this.isRequestOutOfSync(c,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidUpdate(Ke({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:o,topic:t,result:!0}),this.client.events.emit("session_update",{id:o,topic:t,params:s}),oi.set(a,o)}catch(a){await this.sendError(o,t,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(t,r)=>parseInt(r.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,r)=>{const{id:s}=r;ut(r)?this.events.emit(ne("session_update",s),{}):et(r)&&this.events.emit(ne("session_update",s),{error:r.error})},this.onSessionExtendRequest=async(t,r)=>{const{id:s}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,tt(ai)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(t,r)=>{const{id:s}=r;ut(r)?this.events.emit(ne("session_extend",s),{}):et(r)&&this.events.emit(ne("session_extend",s),{error:r.error})},this.onSessionPingRequest=async(t,r)=>{const{id:s}=r;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionPingResponse=(t,r)=>{const{id:s}=r;setTimeout(()=>{ut(r)?this.events.emit(ne("session_ping",s),{}):et(r)&&this.events.emit(ne("session_ping",s),{error:r.error})},500)},this.onSessionDeleteRequest=async(t,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),await Promise.all([new Promise(o=>{this.client.core.relayer.once($e.publish,async()=>{o(await this.deleteSession(t))})}),this.sendResult({id:s,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:s,topic:t})}catch(o){this.client.logger.error(o)}},this.onSessionRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidRequest(Ke({topic:t},o));const a=At(JSON.stringify(Ct("wc_sessionRequest",o,s))),c=this.client.session.get(t),g=await this.getVerifyContext(a,c.peer.metadata),l={id:s,topic:t,params:o,verifyContext:g};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(t,r)=>{const{id:s}=r;ut(r)?this.events.emit(ne("session_request",s),{result:r.result}):et(r)&&this.events.emit(ne("session_request",s),{error:r.error})},this.onSessionEventRequest=async(t,r)=>{const{id:s,params:o}=r;try{const a=`${t}_session_event_${o.event.name}`,c=oi.get(a);if(c&&this.isRequestOutOfSync(c,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(Ke({topic:t},o)),this.client.events.emit("session_event",{id:s,topic:t,params:o}),oi.set(a,s)}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=lt.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===lt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=lt.active,this.client.events.emit("session_request",t)}catch(r){this.client.logger.error(r)}},this.onPairingCreated=t=>{if(t.active)return;const r=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);r&&this.onSessionProposeRequest(t.topic,Ct("wc_sessionPropose",{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties},r.id))},this.isValidConnect=async t=>{if(!Ve(t)){const{message:g}=A("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(g)}const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,relays:c}=t;if(qe(r)||await this.isValidPairingTopic(r),!Wc(c,!0)){const{message:g}=A("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(g)}!qe(s)&&Gt(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!qe(o)&&Gt(o)!==0&&this.validateNamespaces(o,"optionalNamespaces"),qe(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(t,r)=>{const s=Bc(t,"connect()",r);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!Ve(t))throw new Error(A("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:s,relayProtocol:o,sessionProperties:a}=t;await this.isValidProposalId(r);const c=this.client.proposal.get(r),g=ui(s,"approve()");if(g)throw new Error(g.message);const l=Gr(c.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!ue(o,!0)){const{message:d}=A("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(d)}qe(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async t=>{if(!Ve(t)){const{message:o}=A("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(o)}const{id:r,reason:s}=t;if(await this.isValidProposalId(r),!Jc(s)){const{message:o}=A("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=t=>{if(!Ve(t)){const{message:l}=A("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:r,controller:s,namespaces:o,expiry:a}=t;if(!an(r)){const{message:l}=A("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=kc(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const g=ui(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);if(pt(a)){const{message:l}=A("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async t=>{if(!Ve(t)){const{message:g}=A("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(g)}const{topic:r,namespaces:s}=t;await this.isValidSessionTopic(r);const o=this.client.session.get(r),a=ui(s,"update()");if(a)throw new Error(a.message);const c=Gr(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async t=>{if(!Ve(t)){const{message:s}=A("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionTopic(r)},this.isValidRequest=async t=>{if(!Ve(t)){const{message:g}=A("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(g)}const{topic:r,request:s,chainId:o,expiry:a}=t;await this.isValidSessionTopic(r);const{namespaces:c}=this.client.session.get(r);if(!Wr(c,o)){const{message:g}=A("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(g)}if(!Yc(s)){const{message:g}=A("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(g)}if(!Zc(c,o,s.method)){const{message:g}=A("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(g)}if(a&&!rh(a,Di)){const{message:g}=A("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Di.min} and ${Di.max}`);throw new Error(g)}},this.isValidRespond=async t=>{if(!Ve(t)){const{message:o}=A("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:r,response:s}=t;if(await this.isValidSessionTopic(r),!Qc(s)){const{message:o}=A("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async t=>{if(!Ve(t)){const{message:s}=A("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.isValidEmit=async t=>{if(!Ve(t)){const{message:c}=A("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(c)}const{topic:r,event:s,chainId:o}=t;await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!Wr(a,o)){const{message:c}=A("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!Xc(s)){const{message:c}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!eh(a,o,s.name)){const{message:c}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async t=>{if(!Ve(t)){const{message:s}=A("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.getVerifyContext=async(t,r)=>{const s={verified:{verifyUrl:r.verifyUrl||Rt,validation:"UNKNOWN",origin:r.url||""}};try{const o=await this.client.core.verify.resolve({attestationId:t,verifyUrl:r.verifyUrl});o&&(s.verified.origin=o.origin,s.verified.isScam=o.isScam,s.verified.validation=o.origin===new URL(r.url).origin?"VALID":"INVALID")}catch(o){this.client.logger.info(o)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(t,r)=>{Object.values(t).forEach(s=>{if(!ue(s,!1)){const{message:o}=A("MISSING_OR_INVALID",`${r} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(o)}})}}async isInitialized(){if(!this.initialized){const{message:e}=A("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on($e.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const s=await this.client.core.crypto.decode(t,r);try{Qi(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):yi(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.client.core.history.delete(t,s.id)):this.onRelayEventUnknownPayload({topic:t,payload:s})}catch(o){this.client.logger.error(o)}})}registerExpirerEvents(){this.client.core.expirer.on(Ye.expired,async e=>{const{topic:t,id:r}=nn(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,A("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Wt.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!ue(e,!1)){const{message:t}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(pt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=A("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ue(e,!1)){const{message:t}=A("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=A("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(pt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=A("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ue(e,!1)){const{message:t}=A("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=A("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Gc(e)){const{message:t}=A("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=A("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(pt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=A("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class sd extends wi{constructor(e,t){super(e,t,Bu,ar),this.core=e,this.logger=t}}class nd extends wi{constructor(e,t){super(e,t,Gu,ar),this.core=e,this.logger=t}}class od extends wi{constructor(e,t){super(e,t,Yu,ar,r=>r.id),this.core=e,this.logger=t}}class cr extends Xo{constructor(e){super(e),this.protocol=_n,this.version=Sn,this.name=$i.name,this.events=new nt.EventEmitter,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}},this.update=async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}},this.request=async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}},this.find=r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||$i.name,this.metadata=(e==null?void 0:e.metadata)||uc();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:F.pino(F.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||$i.logger}));this.core=(e==null?void 0:e.core)||new Hu(e),this.logger=F.generateChildLogger(t,this.name),this.session=new nd(this.core,this.logger),this.proposal=new sd(this.core,this.logger),this.pendingRequest=new od(this.core,this.logger),this.engine=new rd(this)}static async init(e){const t=new cr(e);return await t.initialize(),t}get context(){return F.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var W={};Object.defineProperty(W,"__esModule",{value:!0});W.getLocalStorage=W.getLocalStorageOrThrow=W.getCrypto=W.getCryptoOrThrow=W.getLocation=W.getLocationOrThrow=W.getNavigator=W.getNavigatorOrThrow=W.getDocument=W.getDocumentOrThrow=W.getFromWindowOrThrow=W.getFromWindow=void 0;function xt(i){let e;return typeof window<"u"&&typeof window[i]<"u"&&(e=window[i]),e}W.getFromWindow=xt;function qt(i){const e=xt(i);if(!e)throw new Error(`${i} is not defined in Window`);return e}W.getFromWindowOrThrow=qt;function ad(){return qt("document")}W.getDocumentOrThrow=ad;function cd(){return xt("document")}W.getDocument=cd;function hd(){return qt("navigator")}W.getNavigatorOrThrow=hd;function ld(){return xt("navigator")}W.getNavigator=ld;function ud(){return qt("location")}W.getLocationOrThrow=ud;function dd(){return xt("location")}W.getLocation=dd;function fd(){return qt("crypto")}W.getCryptoOrThrow=fd;function gd(){return xt("crypto")}W.getCrypto=gd;function pd(){return qt("localStorage")}W.getLocalStorageOrThrow=pd;function yd(){return xt("localStorage")}W.getLocalStorage=yd;var hr={};Object.defineProperty(hr,"__esModule",{value:!0});hr.getWindowMetadata=void 0;const vs=W;function md(){let i,e;try{i=vs.getDocumentOrThrow(),e=vs.getLocationOrThrow()}catch{return null}function t(){const y=i.getElementsByTagName("link"),E=[];for(let N=0;N<y.length;N++){const I=y[N],T=I.getAttribute("rel");if(T&&T.toLowerCase().indexOf("icon")>-1){const C=I.getAttribute("href");if(C)if(C.toLowerCase().indexOf("https:")===-1&&C.toLowerCase().indexOf("http:")===-1&&C.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(C.indexOf("/")===0)q+=C;else{const h=e.pathname.split("/");h.pop();const f=h.join("/");q+=f+"/"+C}E.push(q)}else if(C.indexOf("//")===0){const q=e.protocol+C;E.push(q)}else E.push(C)}}return E}function r(...y){const E=i.getElementsByTagName("meta");for(let N=0;N<E.length;N++){const I=E[N],T=["itemprop","property","name"].map(C=>I.getAttribute(C)).filter(C=>C?y.includes(C):!1);if(T.length&&T){const C=I.getAttribute("content");if(C)return C}}return""}function s(){let y=r("name","og:site_name","og:title","twitter:title");return y||(y=i.title),y}function o(){return r("description","og:description","twitter:description","keywords")}const a=s(),c=o(),g=e.origin,l=t();return{description:c,url:g,icons:l,name:a}}hr.getWindowMetadata=md;var wd={},xn="%[a-f0-9]{2}",Es=new RegExp("("+xn+")|([^%]+?)","gi"),_s=new RegExp("("+xn+")+","gi");function Bi(i,e){try{return[decodeURIComponent(i.join(""))]}catch{}if(i.length===1)return i;e=e||1;var t=i.slice(0,e),r=i.slice(e);return Array.prototype.concat.call([],Bi(t),Bi(r))}function bd(i){try{return decodeURIComponent(i)}catch{for(var e=i.match(Es)||[],t=1;t<e.length;t++)i=Bi(e,t).join(""),e=i.match(Es)||[];return i}}function vd(i){for(var e={"%FE%FF":"��","%FF%FE":"��"},t=_s.exec(i);t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{var r=bd(t[0]);r!==t[0]&&(e[t[0]]=r)}t=_s.exec(i)}e["%C2"]="�";for(var s=Object.keys(e),o=0;o<s.length;o++){var a=s[o];i=i.replace(new RegExp(a,"g"),e[a])}return i}var Ed=function(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return i=i.replace(/\+/g," "),decodeURIComponent(i)}catch{return vd(i)}},_d=(i,e)=>{if(!(typeof i=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[i];const t=i.indexOf(e);return t===-1?[i]:[i.slice(0,t),i.slice(t+e.length)]},Sd=function(i,e){for(var t={},r=Object.keys(i),s=Array.isArray(e),o=0;o<r.length;o++){var a=r[o],c=i[a];(s?e.indexOf(a)!==-1:e(a,c,i))&&(t[a]=c)}return t};(function(i){const e=Ns,t=Ed,r=_d,s=Sd,o=h=>h==null,a=Symbol("encodeFragmentIdentifier");function c(h){switch(h.arrayFormat){case"index":return f=>(p,m)=>{const u=p.length;return m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),"[",u,"]"].join("")]:[...p,[d(f,h),"[",d(u,h),"]=",d(m,h)].join("")]};case"bracket":return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),"[]"].join("")]:[...p,[d(f,h),"[]=",d(m,h)].join("")];case"colon-list-separator":return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,[d(f,h),":list="].join("")]:[...p,[d(f,h),":list=",d(m,h)].join("")];case"comma":case"separator":case"bracket-separator":{const f=h.arrayFormat==="bracket-separator"?"[]=":"=";return p=>(m,u)=>u===void 0||h.skipNull&&u===null||h.skipEmptyString&&u===""?m:(u=u===null?"":u,m.length===0?[[d(p,h),f,d(u,h)].join("")]:[[m,d(u,h)].join(h.arrayFormatSeparator)])}default:return f=>(p,m)=>m===void 0||h.skipNull&&m===null||h.skipEmptyString&&m===""?p:m===null?[...p,d(f,h)]:[...p,[d(f,h),"=",d(m,h)].join("")]}}function g(h){let f;switch(h.arrayFormat){case"index":return(p,m,u)=>{if(f=/\[(\d*)\]$/.exec(p),p=p.replace(/\[\d*\]$/,""),!f){u[p]=m;return}u[p]===void 0&&(u[p]={}),u[p][f[1]]=m};case"bracket":return(p,m,u)=>{if(f=/(\[\])$/.exec(p),p=p.replace(/\[\]$/,""),!f){u[p]=m;return}if(u[p]===void 0){u[p]=[m];return}u[p]=[].concat(u[p],m)};case"colon-list-separator":return(p,m,u)=>{if(f=/(:list)$/.exec(p),p=p.replace(/:list$/,""),!f){u[p]=m;return}if(u[p]===void 0){u[p]=[m];return}u[p]=[].concat(u[p],m)};case"comma":case"separator":return(p,m,u)=>{const _=typeof m=="string"&&m.includes(h.arrayFormatSeparator),v=typeof m=="string"&&!_&&y(m,h).includes(h.arrayFormatSeparator);m=v?y(m,h):m;const D=_||v?m.split(h.arrayFormatSeparator).map(j=>y(j,h)):m===null?m:y(m,h);u[p]=D};case"bracket-separator":return(p,m,u)=>{const _=/(\[\])$/.test(p);if(p=p.replace(/\[\]$/,""),!_){u[p]=m&&y(m,h);return}const v=m===null?[]:m.split(h.arrayFormatSeparator).map(D=>y(D,h));if(u[p]===void 0){u[p]=v;return}u[p]=[].concat(u[p],v)};default:return(p,m,u)=>{if(u[p]===void 0){u[p]=m;return}u[p]=[].concat(u[p],m)}}}function l(h){if(typeof h!="string"||h.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function d(h,f){return f.encode?f.strict?e(h):encodeURIComponent(h):h}function y(h,f){return f.decode?t(h):h}function E(h){return Array.isArray(h)?h.sort():typeof h=="object"?E(Object.keys(h)).sort((f,p)=>Number(f)-Number(p)).map(f=>h[f]):h}function N(h){const f=h.indexOf("#");return f!==-1&&(h=h.slice(0,f)),h}function I(h){let f="";const p=h.indexOf("#");return p!==-1&&(f=h.slice(p)),f}function T(h){h=N(h);const f=h.indexOf("?");return f===-1?"":h.slice(f+1)}function C(h,f){return f.parseNumbers&&!Number.isNaN(Number(h))&&typeof h=="string"&&h.trim()!==""?h=Number(h):f.parseBooleans&&h!==null&&(h.toLowerCase()==="true"||h.toLowerCase()==="false")&&(h=h.toLowerCase()==="true"),h}function q(h,f){f=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},f),l(f.arrayFormatSeparator);const p=g(f),m=Object.create(null);if(typeof h!="string"||(h=h.trim().replace(/^[?#&]/,""),!h))return m;for(const u of h.split("&")){if(u==="")continue;let[_,v]=r(f.decode?u.replace(/\+/g," "):u,"=");v=v===void 0?null:["comma","separator","bracket-separator"].includes(f.arrayFormat)?v:y(v,f),p(y(_,f),v,m)}for(const u of Object.keys(m)){const _=m[u];if(typeof _=="object"&&_!==null)for(const v of Object.keys(_))_[v]=C(_[v],f);else m[u]=C(_,f)}return f.sort===!1?m:(f.sort===!0?Object.keys(m).sort():Object.keys(m).sort(f.sort)).reduce((u,_)=>{const v=m[_];return v&&typeof v=="object"&&!Array.isArray(v)?u[_]=E(v):u[_]=v,u},Object.create(null))}i.extract=T,i.parse=q,i.stringify=(h,f)=>{if(!h)return"";f=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},f),l(f.arrayFormatSeparator);const p=v=>f.skipNull&&o(h[v])||f.skipEmptyString&&h[v]==="",m=c(f),u={};for(const v of Object.keys(h))p(v)||(u[v]=h[v]);const _=Object.keys(u);return f.sort!==!1&&_.sort(f.sort),_.map(v=>{const D=h[v];return D===void 0?"":D===null?d(v,f):Array.isArray(D)?D.length===0&&f.arrayFormat==="bracket-separator"?d(v,f)+"[]":D.reduce(m(v),[]).join("&"):d(v,f)+"="+d(D,f)}).filter(v=>v.length>0).join("&")},i.parseUrl=(h,f)=>{f=Object.assign({decode:!0},f);const[p,m]=r(h,"#");return Object.assign({url:p.split("?")[0]||"",query:q(T(h),f)},f&&f.parseFragmentIdentifier&&m?{fragmentIdentifier:y(m,f)}:{})},i.stringifyUrl=(h,f)=>{f=Object.assign({encode:!0,strict:!0,[a]:!0},f);const p=N(h.url).split("?")[0]||"",m=i.extract(h.url),u=i.parse(m,{sort:!1}),_=Object.assign(u,h.query);let v=i.stringify(_,f);v&&(v=`?${v}`);let D=I(h.url);return h.fragmentIdentifier&&(D=`#${f[a]?d(h.fragmentIdentifier,f):h.fragmentIdentifier}`),`${p}${v}${D}`},i.pick=(h,f,p)=>{p=Object.assign({parseFragmentIdentifier:!0,[a]:!1},p);const{url:m,query:u,fragmentIdentifier:_}=i.parseUrl(h,p);return i.stringifyUrl({url:m,query:s(u,f),fragmentIdentifier:_},p)},i.exclude=(h,f,p)=>{const m=Array.isArray(f)?u=>!f.includes(u):(u,_)=>!f(u,_);return i.pick(h,m,p)}})(wd);const Id={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Li(i,e){const{message:t,code:r}=Id[i];return{message:e?`${t} ${e}`:t,code:r}}function xd(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}const Ss=[{name:"Rainbow",chains:[dt.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[dt.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}},{name:"Argent",chains:[dt.EIP155],logo:"https://images.web3auth.io/login-argent.svg",mobile:{native:"argent://",universal:"https://www.argent.xyz/app"},desktop:{native:"",universal:""}},{name:"Trust Wallet",chains:[dt.EIP155],logo:"https://images.web3auth.io/login-trust.svg",mobile:{native:"trust:",universal:"https://link.trustwallet.com"},desktop:{native:"",universal:""}},{name:"Zerion",chains:[dt.EIP155],logo:"https://images.web3auth.io/login-zerion.svg",mobile:{native:"zerion://",universal:"https://wallet.zerion.io"},desktop:{native:"",universal:""}}];let Od=function(i){return i.ETH_SEND_TRANSACTION="eth_sendTransaction",i.ETH_SIGN="eth_sign",i.PERSONAL_SIGN="personal_sign",i.ETH_SIGN_TYPED_DATA="eth_signTypedData",i}({}),Nd=function(i){return i.ETH_CHAIN_CHANGED="chainChanged",i.ETH_ACCOUNTS_CHANGED="accountsChanged",i}({});const Pd=i=>{const{document:e}=i,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const r=e.querySelector('head > meta[name="title"]');return r?r.content:e.title&&e.title.length>0?e.title:i.location.hostname};function Is(i){return new Promise((e,t)=>{try{const r=document.createElement("img");r.onload=()=>e(!0),r.onerror=()=>e(!1),r.src=i}catch(r){t(r)}})}async function Td(i){const{document:e}=i;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await Is(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(r=>!!r.href)||null,t&&await Is(t.href))?t.href:null}const Rd=async()=>({name:Pd(window),icon:await Td(window)}),Cd=i=>{const e=[];return i.forEach(t=>{const[r]=t.split(":");e.includes(r)||e.push(r)}),e},Ad=i=>{switch(i){case dt.EIP155:return Object.values(Od);default:throw new Error(`No default methods for namespace: ${i}`)}},$d=i=>{switch(i){case dt.EIP155:return Object.values(Nd);default:throw new Error(`No default events for namespace: ${i}`)}},Dd=i=>{const e=Cd(i);return Object.fromEntries(e.map(t=>[t,{methods:Ad(t),chains:i.filter(r=>r.startsWith(t)),events:$d(t)}]))},Ld=async(i,e,t)=>{if(i===dt.EIP155){const r=await Rd(),s={walletConnectInitOptions:{projectId:t,relayUrl:"wss://relay.walletconnect.com",metadata:{name:r.name,description:r.name,url:window.location.origin,icons:[r.icon||""]}}},o=e.map(c=>`${i}:${c}`),a={requiredNamespaces:Dd(o)};return{adapterSettings:s,loginSettings:a}}throw new Error(`Unsupported chain namespace: ${i}`)},xs=(i,e,t)=>{var r,s;const o=(t==null?void 0:t.requiredNamespaces)||{},a=`${i}:${e}`;return!o[i].chains||((r=o[i].chains)===null||r===void 0?void 0:r.length)===0?!1:!!((s=o[i].chains)===null||s===void 0?void 0:s.includes(a))};class Gd extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),rt(this,"name",kt.WALLET_CONNECT_V2),rt(this,"adapterNamespace",Fn.EIP155),rt(this,"currentChainNamespace",dt.EIP155),rt(this,"type",Vn.EXTERNAL),rt(this,"adapterOptions",void 0),rt(this,"status",Xe.NOT_READY),rt(this,"adapterData",{uri:"",extensionAdapters:Ss}),rt(this,"connector",null),rt(this,"activeSession",null),rt(this,"wcProvider",null),this.adapterOptions=vi({},e)}get connected(){return!!this.activeSession}get provider(){return this.status!==Xe.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){var t,r,s;await super.init(),super.checkInitializationRequirements();const o=(t=this.adapterOptions.adapterSettings)===null||t===void 0||(t=t.walletConnectInitOptions)===null||t===void 0?void 0:t.projectId;if(!o)throw at.invalidParams("Wallet connect project id is required in wallet connect v2 adapter");const a=await Ld((r=this.chainConfig)===null||r===void 0?void 0:r.chainNamespace,[parseInt((s=this.chainConfig)===null||s===void 0?void 0:s.chainId,16)],o);this.adapterOptions.loginSettings||(this.adapterOptions.loginSettings=a.loginSettings),this.adapterOptions.adapterSettings=Hn(a.adapterSettings,this.adapterOptions.adapterSettings);const{adapterSettings:c}=this.adapterOptions;if(this.connector=await cr.init(c==null?void 0:c.walletConnectInitOptions),this.wcProvider=new ur({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(gt.READY,kt.WALLET_CONNECT_V2),this.status=Xe.READY,ct.debug("initializing wallet connect v2 adapter"),e.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler()}catch(g){ct.error("wallet auto connect",g),this.emit(gt.ERRORED,g)}}else this.status=Xe.NOT_READY,this.emit(gt.CACHE_CLEAR)}async connect(){if(super.checkConnectionRequirements(),!this.connector)throw at.notReady("Wallet adapter is not ready yet");try{return this.connected?(await this.onConnectHandler(),this.provider):(this.status!==Xe.CONNECTING&&await this.createNewSession(),this.provider)}catch(e){throw ct.error("Wallet connect v2 adapter error while connecting",e),this.status=Xe.READY,this.rehydrated=!0,this.emit(gt.ERRORED,e),e instanceof Bn?e:Ei.connectionError(`Failed to login with wallet connect: ${(e==null?void 0:e.message)||""}`)}}async addChain(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkAddChainRequirements(e,r),!xs(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw dr.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.addChain(e)),this.addChainConfig(e)}async switchChain(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkSwitchChainRequirements(e,r),!xs(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw dr.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.switchChain({chainId:e.chainId})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}async getUserInfo(){if(!this.connected)throw Ei.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(){var e,t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession();const{cleanup:s}=r;if(!this.connector||!this.connected||!((e=this.activeSession)!==null&&e!==void 0&&e.topic))throw Ei.notConnectedError("Not connected with wallet");await this.connector.disconnect({topic:(t=this.activeSession)===null||t===void 0?void 0:t.topic,reason:Li("USER_DISCONNECTED")}),this.rehydrated=!1,s?(this.connector=null,this.status=Xe.NOT_READY,this.wcProvider=null):this.status=Xe.READY,this.activeSession=null,await super.disconnect()}cleanupPendingPairings(){if(!this.connector)throw at.notReady("Wallet adapter is not ready yet");const e=this.connector.pairing.getAll({active:!1});xd(e)&&e.forEach(t=>{this.connector&&this.connector.pairing.delete(t.topic,Li("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw at.notReady("Wallet adapter is not ready yet");if(this.connector.session.length){const e=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[e])}return this.activeSession}async createNewSession(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{forceNewSession:!1};try{var t,r;if(!this.connector)throw at.notReady("Wallet adapter is not ready yet");if(!this.adapterOptions.loginSettings)throw at.notReady("login settings are not set yet");if(this.status=Xe.CONNECTING,this.emit(gt.CONNECTING,{adapter:kt.WALLET_CONNECT_V2}),e.forceNewSession&&(t=this.activeSession)!==null&&t!==void 0&&t.topic){var s;await this.connector.disconnect({topic:(s=this.activeSession)===null||s===void 0?void 0:s.topic,reason:Li("USER_DISCONNECTED")})}ct.debug("creating new session for web3auth wallet connect");const{uri:o,approval:a}=await this.connector.connect(this.adapterOptions.loginSettings),c=(r=this.adapterOptions)===null||r===void 0||(r=r.adapterSettings)===null||r===void 0?void 0:r.qrcodeModal;if(o)if(c)try{await c.openModal({uri:o}),ct.debug("EVENT","QR Code Modal closed"),this.status=Xe.READY,this.emit(gt.READY,kt.WALLET_CONNECT_V2)}catch{ct.error("unable to open qr code modal")}else this.updateAdapterData({uri:o,extensionAdapters:Ss});this.connector.events.once("proposal_expire",l=>{ct.info("proposal expired",l),this.createNewSession({forceNewSession:!0})}),ct.info("awaiting session approval from wallet");const g=await a();this.activeSession=g,await this.onConnectHandler(),c&&c.closeModal()}catch(o){throw ct.error("error while creating new wallet connect session",o),this.emit(gt.ERRORED,o),o}}async onConnectHandler(){var e;if(!this.connector||!this.wcProvider)throw at.notReady("Wallet adapter is not ready yet");if(!this.chainConfig)throw at.invalidParams("Chain config is not set");(e=this.adapterOptions.adapterSettings)!==null&&e!==void 0&&e.qrcodeModal&&(this.wcProvider=new ur({config:{chainConfig:this.chainConfig,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.subscribeEvents(),this.cleanupPendingPairings(),this.status=Xe.CONNECTED,this.emit(gt.CONNECTED,{adapter:kt.WALLET_CONNECT_V2,reconnected:this.rehydrated})}subscribeEvents(){if(!this.connector)throw at.notReady("Wallet adapter is not ready yet");this.connector.events.on("session_update",e=>{let{topic:t,params:r}=e;if(!this.connector)return;const{namespaces:s}=r,o=this.connector.session.get(t),a=vi(vi({},o),{},{namespaces:s});this.activeSession=a}),this.connector.events.on("session_delete",()=>{this.disconnect()})}}export{Od as DEFAULT_EIP155_METHODS,Nd as DEFAULT_EIP_155_EVENTS,Ss as WALLET_CONNECT_EXTENSION_ADAPTERS,Gd as WalletConnectV2Adapter,Cd as getNamespacesFromChains,Dd as getRequiredNamespaces,$d as getSupportedEventsByNamespace,Ad as getSupportedMethodsByNamespace,Ld as getWalletConnectV2Settings};
