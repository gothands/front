import{v as Xr,b as Pe,c as Oe,e as Zt,s as zr,r as en,d as Z,_ as Se,T as Qr,j as Zr,l as or,a as ei,C as ti}from"./index-L3ozMu8u.js";import{B as ni}from"./baseEvmAdapter.esm-bhfdtaJk.js";function ri({mustBeMetaMask:e=!1,silent:t=!1,timeout:n=3e3}={}){a();let r=!1;return new Promise(l=>{window.ethereum?d():(window.addEventListener("ethereum#initialized",d,{once:!0}),setTimeout(()=>{d()},n));function d(){if(r)return;r=!0,window.removeEventListener("ethereum#initialized",d);const{ethereum:b}=window;b&&(!e||b.isMetaMask)?l(b):(!t&&console.error("@metamask/detect-provider:",e&&b?"Non-MetaMask window.ethereum detected.":"Unable to detect window.ethereum."),l(null))}});function a(){if(typeof e!="boolean")throw new Error("@metamask/detect-provider: Expected option 'mustBeMetaMask' to be a boolean.");if(typeof t!="boolean")throw new Error("@metamask/detect-provider: Expected option 'silent' to be a boolean.");if(typeof n!="number")throw new Error("@metamask/detect-provider: Expected option 'timeout' to be a number.")}}var ii=ri;const oi=Xr(ii);var ai={exports:{}},Nt={exports:{}},V={ArrayIsArray(e){return Array.isArray(e)},ArrayPrototypeIncludes(e,t){return e.includes(t)},ArrayPrototypeIndexOf(e,t){return e.indexOf(t)},ArrayPrototypeJoin(e,t){return e.join(t)},ArrayPrototypeMap(e,t){return e.map(t)},ArrayPrototypePop(e,t){return e.pop(t)},ArrayPrototypePush(e,t){return e.push(t)},ArrayPrototypeSlice(e,t,n){return e.slice(t,n)},Error,FunctionPrototypeCall(e,t,...n){return e.call(t,...n)},FunctionPrototypeSymbolHasInstance(e,t){return Function.prototype[Symbol.hasInstance].call(e,t)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(e,t){return Object.defineProperties(e,t)},ObjectDefineProperty(e,t,n){return Object.defineProperty(e,t,n)},ObjectGetOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)},ObjectKeys(e){return Object.keys(e)},ObjectSetPrototypeOf(e,t){return Object.setPrototypeOf(e,t)},Promise,PromisePrototypeCatch(e,t){return e.catch(t)},PromisePrototypeThen(e,t,n){return e.then(t,n)},PromiseReject(e){return Promise.reject(e)},ReflectApply:Reflect.apply,RegExpPrototypeTest(e,t){return e.test(t)},SafeSet:Set,String,StringPrototypeSlice(e,t,n){return e.slice(t,n)},StringPrototypeToLowerCase(e){return e.toLowerCase()},StringPrototypeToUpperCase(e){return e.toUpperCase()},StringPrototypeTrim(e){return e.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(e,t,n){return e.set(t,n)},Uint8Array},ar={exports:{}};(function(e){const t=Pe,n=Object.getPrototypeOf(async function(){}).constructor,r=globalThis.Blob||t.Blob,a=typeof r<"u"?function(b){return b instanceof r}:function(b){return!1};class l extends Error{constructor(b){if(!Array.isArray(b))throw new TypeError(`Expected input to be an Array, got ${typeof b}`);let p="";for(let u=0;u<b.length;u++)p+=`    ${b[u].stack}
`;super(p),this.name="AggregateError",this.errors=b}}e.exports={AggregateError:l,kEmptyObject:Object.freeze({}),once(d){let b=!1;return function(...p){b||(b=!0,d.apply(this,p))}},createDeferredPromise:function(){let d,b;return{promise:new Promise((u,c)=>{d=u,b=c}),resolve:d,reject:b}},promisify(d){return new Promise((b,p)=>{d((u,...c)=>u?p(u):b(...c))})},debuglog(){return function(){}},format(d,...b){return d.replace(/%([sdifj])/g,function(...[p,u]){const c=b.shift();return u==="f"?c.toFixed(6):u==="j"?JSON.stringify(c):u==="s"&&typeof c=="object"?`${c.constructor!==Object?c.constructor.name:""} {}`.trim():c.toString()})},inspect(d){switch(typeof d){case"string":if(d.includes("'"))if(d.includes('"')){if(!d.includes("`")&&!d.includes("${"))return`\`${d}\``}else return`"${d}"`;return`'${d}'`;case"number":return isNaN(d)?"NaN":Object.is(d,-0)?String(d):d;case"bigint":return`${String(d)}n`;case"boolean":case"undefined":return String(d);case"object":return"{}"}},types:{isAsyncFunction(d){return d instanceof n},isArrayBufferView(d){return ArrayBuffer.isView(d)}},isBlob:a},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(ar);var we=ar.exports,tn={};const{format:li,inspect:at,AggregateError:si}=we,fi=globalThis.AggregateError||si,di=Symbol("kIsNodeError"),ui=["string","function","number","object","Function","Object","boolean","bigint","symbol"],ci=/^([A-Z][a-z0-9]*)+$/,hi="__node_internal_",dt={};function Me(e,t){if(!e)throw new dt.ERR_INTERNAL_ASSERTION(t)}function mn(e){let t="",n=e.length;const r=e[0]==="-"?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function bi(e,t,n){if(typeof t=="function")return Me(t.length<=n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${t.length}).`),t(...n);const r=(t.match(/%[dfijoOs]/g)||[]).length;return Me(r===n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${r}).`),n.length===0?t:li(t,...n)}function z(e,t,n){n||(n=Error);class r extends n{constructor(...l){super(bi(e,t,l))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(r.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),r.prototype.code=e,r.prototype[di]=!0,dt[e]=r}function Sn(e){const t=hi+e.name;return Object.defineProperty(e,"name",{value:t}),e}function gi(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;const n=new fi([t,e],t.message);return n.code=t.code,n}return e||t}let pi=class extends Error{constructor(t="The operation was aborted",n=void 0){if(n!==void 0&&typeof n!="object")throw new dt.ERR_INVALID_ARG_TYPE("options","Object",n);super(t,n),this.code="ABORT_ERR",this.name="AbortError"}};z("ERR_ASSERTION","%s",Error);z("ERR_INVALID_ARG_TYPE",(e,t,n)=>{Me(typeof e=="string","'name' must be a string"),Array.isArray(t)||(t=[t]);let r="The ";e.endsWith(" argument")?r+=`${e} `:r+=`"${e}" ${e.includes(".")?"property":"argument"} `,r+="must be ";const a=[],l=[],d=[];for(const p of t)Me(typeof p=="string","All expected entries have to be of type string"),ui.includes(p)?a.push(p.toLowerCase()):ci.test(p)?l.push(p):(Me(p!=="object",'The value "object" should be written as "Object"'),d.push(p));if(l.length>0){const p=a.indexOf("object");p!==-1&&(a.splice(a,p,1),l.push("Object"))}if(a.length>0){switch(a.length){case 1:r+=`of type ${a[0]}`;break;case 2:r+=`one of type ${a[0]} or ${a[1]}`;break;default:{const p=a.pop();r+=`one of type ${a.join(", ")}, or ${p}`}}(l.length>0||d.length>0)&&(r+=" or ")}if(l.length>0){switch(l.length){case 1:r+=`an instance of ${l[0]}`;break;case 2:r+=`an instance of ${l[0]} or ${l[1]}`;break;default:{const p=l.pop();r+=`an instance of ${l.join(", ")}, or ${p}`}}d.length>0&&(r+=" or ")}switch(d.length){case 0:break;case 1:d[0].toLowerCase()!==d[0]&&(r+="an "),r+=`${d[0]}`;break;case 2:r+=`one of ${d[0]} or ${d[1]}`;break;default:{const p=d.pop();r+=`one of ${d.join(", ")}, or ${p}`}}if(n==null)r+=`. Received ${n}`;else if(typeof n=="function"&&n.name)r+=`. Received function ${n.name}`;else if(typeof n=="object"){var b;if((b=n.constructor)!==null&&b!==void 0&&b.name)r+=`. Received an instance of ${n.constructor.name}`;else{const p=at(n,{depth:-1});r+=`. Received ${p}`}}else{let p=at(n,{colors:!1});p.length>25&&(p=`${p.slice(0,25)}...`),r+=`. Received type ${typeof n} (${p})`}return r},TypeError);z("ERR_INVALID_ARG_VALUE",(e,t,n="is invalid")=>{let r=at(t);return r.length>128&&(r=r.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${n}. Received ${r}`},TypeError);z("ERR_INVALID_RETURN_VALUE",(e,t,n)=>{var r;const a=n!=null&&(r=n.constructor)!==null&&r!==void 0&&r.name?`instance of ${n.constructor.name}`:`type ${typeof n}`;return`Expected ${e} to be returned from the "${t}" function but got ${a}.`},TypeError);z("ERR_MISSING_ARGS",(...e)=>{Me(e.length>0,"At least one arg needs to be specified");let t;const n=e.length;switch(e=(Array.isArray(e)?e:[e]).map(r=>`"${r}"`).join(" or "),n){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{const r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}break}return`${t} must be specified`},TypeError);z("ERR_OUT_OF_RANGE",(e,t,n)=>{Me(t,'Missing "range" argument');let r;return Number.isInteger(n)&&Math.abs(n)>2**32?r=mn(String(n)):typeof n=="bigint"?(r=String(n),(n>2n**32n||n<-(2n**32n))&&(r=mn(r)),r+="n"):r=at(n),`The value of "${e}" is out of range. It must be ${t}. Received ${r}`},RangeError);z("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);z("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);z("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);z("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);z("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);z("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);z("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);z("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);z("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);z("ERR_STREAM_WRITE_AFTER_END","write after end",Error);z("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var ne={AbortError:pi,aggregateTwoErrors:Sn(gi),hideStackFrames:Sn,codes:dt};const{ArrayIsArray:nn,ArrayPrototypeIncludes:lr,ArrayPrototypeJoin:sr,ArrayPrototypeMap:wi,NumberIsInteger:rn,NumberIsNaN:yi,NumberMAX_SAFE_INTEGER:_i,NumberMIN_SAFE_INTEGER:mi,NumberParseInt:Si,ObjectPrototypeHasOwnProperty:Ei,RegExpPrototypeExec:fr,String:Ri,StringPrototypeToUpperCase:Ai,StringPrototypeTrim:Ti}=V,{hideStackFrames:ie,codes:{ERR_SOCKET_BAD_PORT:Ni,ERR_INVALID_ARG_TYPE:ee,ERR_INVALID_ARG_VALUE:Fe,ERR_OUT_OF_RANGE:ve,ERR_UNKNOWN_SIGNAL:En}}=ne,{normalizeEncoding:Ii}=we,{isAsyncFunction:Mi,isArrayBufferView:vi}=we.types,Rn={};function Pi(e){return e===(e|0)}function Oi(e){return e===e>>>0}const $i=/^[0-7]+$/,Ci="must be a 32-bit unsigned integer or an octal string";function xi(e,t,n){if(typeof e>"u"&&(e=n),typeof e=="string"){if(fr($i,e)===null)throw new Fe(t,e,Ci);e=Si(e,8)}return dr(e,t),e}const Di=ie((e,t,n=mi,r=_i)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!rn(e))throw new ve(t,"an integer",e);if(e<n||e>r)throw new ve(t,`>= ${n} && <= ${r}`,e)}),ki=ie((e,t,n=-2147483648,r=2147483647)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!rn(e))throw new ve(t,"an integer",e);if(e<n||e>r)throw new ve(t,`>= ${n} && <= ${r}`,e)}),dr=ie((e,t,n=!1)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!rn(e))throw new ve(t,"an integer",e);const r=n?1:0,a=4294967295;if(e<r||e>a)throw new ve(t,`>= ${r} && <= ${a}`,e)});function on(e,t){if(typeof e!="string")throw new ee(t,"string",e)}function Li(e,t,n=void 0,r){if(typeof e!="number")throw new ee(t,"number",e);if(n!=null&&e<n||r!=null&&e>r||(n!=null||r!=null)&&yi(e))throw new ve(t,`${n!=null?`>= ${n}`:""}${n!=null&&r!=null?" && ":""}${r!=null?`<= ${r}`:""}`,e)}const Wi=ie((e,t,n)=>{if(!lr(n,e)){const a="must be one of: "+sr(wi(n,l=>typeof l=="string"?`'${l}'`:Ri(l)),", ");throw new Fe(t,e,a)}});function ur(e,t){if(typeof e!="boolean")throw new ee(t,"boolean",e)}function It(e,t,n){return e==null||!Ei(e,t)?n:e[t]}const Fi=ie((e,t,n=null)=>{const r=It(n,"allowArray",!1),a=It(n,"allowFunction",!1);if(!It(n,"nullable",!1)&&e===null||!r&&nn(e)||typeof e!="object"&&(!a||typeof e!="function"))throw new ee(t,"Object",e)}),ji=ie((e,t)=>{if(e!=null&&typeof e!="object"&&typeof e!="function")throw new ee(t,"a dictionary",e)}),an=ie((e,t,n=0)=>{if(!nn(e))throw new ee(t,"Array",e);if(e.length<n){const r=`must be longer than ${n}`;throw new Fe(t,e,r)}});function Ui(e,t){an(e,t);for(let n=0;n<e.length;n++)on(e[n],`${t}[${n}]`)}function Bi(e,t){an(e,t);for(let n=0;n<e.length;n++)ur(e[n],`${t}[${n}]`)}function Gi(e,t="signal"){if(on(e,t),Rn[e]===void 0)throw Rn[Ai(e)]!==void 0?new En(e+" (signals must use all capital letters)"):new En(e)}const Vi=ie((e,t="buffer")=>{if(!vi(e))throw new ee(t,["Buffer","TypedArray","DataView"],e)});function Hi(e,t){const n=Ii(t),r=e.length;if(n==="hex"&&r%2!==0)throw new Fe("encoding",t,`is invalid for data of length ${r}`)}function qi(e,t="Port",n=!0){if(typeof e!="number"&&typeof e!="string"||typeof e=="string"&&Ti(e).length===0||+e!==+e>>>0||e>65535||e===0&&!n)throw new Ni(t,e,n);return e|0}const Ki=ie((e,t)=>{if(e!==void 0&&(e===null||typeof e!="object"||!("aborted"in e)))throw new ee(t,"AbortSignal",e)}),Yi=ie((e,t)=>{if(typeof e!="function")throw new ee(t,"Function",e)}),Ji=ie((e,t)=>{if(typeof e!="function"||Mi(e))throw new ee(t,"Function",e)}),Xi=ie((e,t)=>{if(e!==void 0)throw new ee(t,"undefined",e)});function zi(e,t,n){if(!lr(n,e))throw new ee(t,`('${sr(n,"|")}')`,e)}const Qi=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function An(e,t){if(typeof e>"u"||!fr(Qi,e))throw new Fe(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Zi(e){if(typeof e=="string")return An(e,"hints"),e;if(nn(e)){const t=e.length;let n="";if(t===0)return n;for(let r=0;r<t;r++){const a=e[r];An(a,"hints"),n+=a,r!==t-1&&(n+=", ")}return n}throw new Fe("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var ut={isInt32:Pi,isUint32:Oi,parseFileMode:xi,validateArray:an,validateStringArray:Ui,validateBooleanArray:Bi,validateBoolean:ur,validateBuffer:Vi,validateDictionary:ji,validateEncoding:Hi,validateFunction:Yi,validateInt32:ki,validateInteger:Di,validateNumber:Li,validateObject:Fi,validateOneOf:Wi,validatePlainFunction:Ji,validatePort:qi,validateSignalName:Gi,validateString:on,validateUint32:dr,validateUndefined:Xi,validateUnion:zi,validateAbortSignal:Ki,validateLinkHeaderValue:Zi},ln={exports:{}};const{Symbol:ct,SymbolAsyncIterator:Tn,SymbolIterator:Nn,SymbolFor:cr}=V,hr=ct("kDestroyed"),br=ct("kIsErrored"),Gt=ct("kIsReadable"),gr=ct("kIsDisturbed"),eo=cr("nodejs.webstream.isClosedPromise"),to=cr("nodejs.webstream.controllerErrorFunction");function ht(e,t=!1){var n;return!!(e&&typeof e.pipe=="function"&&typeof e.on=="function"&&(!t||typeof e.pause=="function"&&typeof e.resume=="function")&&(!e._writableState||((n=e._readableState)===null||n===void 0?void 0:n.readable)!==!1)&&(!e._writableState||e._readableState))}function bt(e){var t;return!!(e&&typeof e.write=="function"&&typeof e.on=="function"&&(!e._readableState||((t=e._writableState)===null||t===void 0?void 0:t.writable)!==!1))}function no(e){return!!(e&&typeof e.pipe=="function"&&e._readableState&&typeof e.on=="function"&&typeof e.write=="function")}function ue(e){return e&&(e._readableState||e._writableState||typeof e.write=="function"&&typeof e.on=="function"||typeof e.pipe=="function"&&typeof e.on=="function")}function pr(e){return!!(e&&!ue(e)&&typeof e.pipeThrough=="function"&&typeof e.getReader=="function"&&typeof e.cancel=="function")}function wr(e){return!!(e&&!ue(e)&&typeof e.getWriter=="function"&&typeof e.abort=="function")}function yr(e){return!!(e&&!ue(e)&&typeof e.readable=="object"&&typeof e.writable=="object")}function ro(e){return pr(e)||wr(e)||yr(e)}function io(e,t){return e==null?!1:t===!0?typeof e[Tn]=="function":t===!1?typeof e[Nn]=="function":typeof e[Tn]=="function"||typeof e[Nn]=="function"}function gt(e){if(!ue(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!!(e.destroyed||e[hr]||r!=null&&r.destroyed)}function _r(e){if(!bt(e))return null;if(e.writableEnded===!0)return!0;const t=e._writableState;return t!=null&&t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function oo(e,t){if(!bt(e))return null;if(e.writableFinished===!0)return!0;const n=e._writableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.finished)!="boolean"?null:!!(n.finished||t===!1&&n.ended===!0&&n.length===0)}function ao(e){if(!ht(e))return null;if(e.readableEnded===!0)return!0;const t=e._readableState;return!t||t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function mr(e,t){if(!ht(e))return null;const n=e._readableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.endEmitted)!="boolean"?null:!!(n.endEmitted||t===!1&&n.ended===!0&&n.length===0)}function Sr(e){return e&&e[Gt]!=null?e[Gt]:typeof(e==null?void 0:e.readable)!="boolean"?null:gt(e)?!1:ht(e)&&e.readable&&!mr(e)}function Er(e){return typeof(e==null?void 0:e.writable)!="boolean"?null:gt(e)?!1:bt(e)&&e.writable&&!_r(e)}function lo(e,t){return ue(e)?gt(e)?!0:!((t==null?void 0:t.readable)!==!1&&Sr(e)||(t==null?void 0:t.writable)!==!1&&Er(e)):null}function so(e){var t,n;return ue(e)?e.writableErrored?e.writableErrored:(t=(n=e._writableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function fo(e){var t,n;return ue(e)?e.readableErrored?e.readableErrored:(t=(n=e._readableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function uo(e){if(!ue(e))return null;if(typeof e.closed=="boolean")return e.closed;const t=e._writableState,n=e._readableState;return typeof(t==null?void 0:t.closed)=="boolean"||typeof(n==null?void 0:n.closed)=="boolean"?(t==null?void 0:t.closed)||(n==null?void 0:n.closed):typeof e._closed=="boolean"&&Rr(e)?e._closed:null}function Rr(e){return typeof e._closed=="boolean"&&typeof e._defaultKeepAlive=="boolean"&&typeof e._removedConnection=="boolean"&&typeof e._removedContLen=="boolean"}function Ar(e){return typeof e._sent100=="boolean"&&Rr(e)}function co(e){var t;return typeof e._consuming=="boolean"&&typeof e._dumped=="boolean"&&((t=e.req)===null||t===void 0?void 0:t.upgradeOrConnect)===void 0}function ho(e){if(!ue(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!r&&Ar(e)||!!(r&&r.autoDestroy&&r.emitClose&&r.closed===!1)}function bo(e){var t;return!!(e&&((t=e[gr])!==null&&t!==void 0?t:e.readableDidRead||e.readableAborted))}function go(e){var t,n,r,a,l,d,b,p,u,c;return!!(e&&((t=(n=(r=(a=(l=(d=e[br])!==null&&d!==void 0?d:e.readableErrored)!==null&&l!==void 0?l:e.writableErrored)!==null&&a!==void 0?a:(b=e._readableState)===null||b===void 0?void 0:b.errorEmitted)!==null&&r!==void 0?r:(p=e._writableState)===null||p===void 0?void 0:p.errorEmitted)!==null&&n!==void 0?n:(u=e._readableState)===null||u===void 0?void 0:u.errored)!==null&&t!==void 0?t:!((c=e._writableState)===null||c===void 0)&&c.errored))}var ye={kDestroyed:hr,isDisturbed:bo,kIsDisturbed:gr,isErrored:go,kIsErrored:br,isReadable:Sr,kIsReadable:Gt,kIsClosedPromise:eo,kControllerErrorFunction:to,isClosed:uo,isDestroyed:gt,isDuplexNodeStream:no,isFinished:lo,isIterable:io,isReadableNodeStream:ht,isReadableStream:pr,isReadableEnded:ao,isReadableFinished:mr,isReadableErrored:fo,isNodeStream:ue,isWebStream:ro,isWritable:Er,isWritableNodeStream:bt,isWritableStream:wr,isWritableEnded:_r,isWritableFinished:oo,isWritableErrored:so,isServerRequest:co,isServerResponse:Ar,willEmitClose:ho,isTransformStream:yr};const me=Oe,{AbortError:Tr,codes:po}=ne,{ERR_INVALID_ARG_TYPE:wo,ERR_STREAM_PREMATURE_CLOSE:In}=po,{kEmptyObject:Vt,once:Ht}=we,{validateAbortSignal:yo,validateFunction:_o,validateObject:mo,validateBoolean:So}=ut,{Promise:Eo,PromisePrototypeThen:Ro}=V,{isClosed:Ao,isReadable:Mn,isReadableNodeStream:Mt,isReadableStream:To,isReadableFinished:vn,isReadableErrored:Pn,isWritable:On,isWritableNodeStream:$n,isWritableStream:No,isWritableFinished:Cn,isWritableErrored:xn,isNodeStream:Io,willEmitClose:Mo,kIsClosedPromise:vo}=ye;function Po(e){return e.setHeader&&typeof e.abort=="function"}const qt=()=>{};function Nr(e,t,n){var r,a;if(arguments.length===2?(n=t,t=Vt):t==null?t=Vt:mo(t,"options"),_o(n,"callback"),yo(t.signal,"options.signal"),n=Ht(n),To(e)||No(e))return Oo(e,t,n);if(!Io(e))throw new wo("stream",["ReadableStream","WritableStream","Stream"],e);const l=(r=t.readable)!==null&&r!==void 0?r:Mt(e),d=(a=t.writable)!==null&&a!==void 0?a:$n(e),b=e._writableState,p=e._readableState,u=()=>{e.writable||I()};let c=Mo(e)&&Mt(e)===l&&$n(e)===d,R=Cn(e,!1);const I=()=>{R=!0,e.destroyed&&(c=!1),!(c&&(!e.readable||l))&&(!l||y)&&n.call(e)};let y=vn(e,!1);const h=()=>{y=!0,e.destroyed&&(c=!1),!(c&&(!e.writable||d))&&(!d||R)&&n.call(e)},x=O=>{n.call(e,O)};let P=Ao(e);const M=()=>{P=!0;const O=xn(e)||Pn(e);if(O&&typeof O!="boolean")return n.call(e,O);if(l&&!y&&Mt(e,!0)&&!vn(e,!1))return n.call(e,new In);if(d&&!R&&!Cn(e,!1))return n.call(e,new In);n.call(e)},w=()=>{P=!0;const O=xn(e)||Pn(e);if(O&&typeof O!="boolean")return n.call(e,O);n.call(e)},C=()=>{e.req.on("finish",I)};Po(e)?(e.on("complete",I),c||e.on("abort",M),e.req?C():e.on("request",C)):d&&!b&&(e.on("end",u),e.on("close",u)),!c&&typeof e.aborted=="boolean"&&e.on("aborted",M),e.on("end",h),e.on("finish",I),t.error!==!1&&e.on("error",x),e.on("close",M),P?me.nextTick(M):b!=null&&b.errorEmitted||p!=null&&p.errorEmitted?c||me.nextTick(w):(!l&&(!c||Mn(e))&&(R||On(e)===!1)||!d&&(!c||On(e))&&(y||Mn(e)===!1)||p&&e.req&&e.aborted)&&me.nextTick(w);const U=()=>{n=qt,e.removeListener("aborted",M),e.removeListener("complete",I),e.removeListener("abort",M),e.removeListener("request",C),e.req&&e.req.removeListener("finish",I),e.removeListener("end",u),e.removeListener("close",u),e.removeListener("finish",I),e.removeListener("end",h),e.removeListener("error",x),e.removeListener("close",M)};if(t.signal&&!P){const O=()=>{const H=n;U(),H.call(e,new Tr(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)me.nextTick(O);else{const H=n;n=Ht((...B)=>{t.signal.removeEventListener("abort",O),H.apply(e,B)}),t.signal.addEventListener("abort",O)}}return U}function Oo(e,t,n){let r=!1,a=qt;if(t.signal)if(a=()=>{r=!0,n.call(e,new Tr(void 0,{cause:t.signal.reason}))},t.signal.aborted)me.nextTick(a);else{const d=n;n=Ht((...b)=>{t.signal.removeEventListener("abort",a),d.apply(e,b)}),t.signal.addEventListener("abort",a)}const l=(...d)=>{r||me.nextTick(()=>n.apply(e,d))};return Ro(e[vo].promise,l,l),qt}function $o(e,t){var n;let r=!1;return t===null&&(t=Vt),(n=t)!==null&&n!==void 0&&n.cleanup&&(So(t.cleanup,"cleanup"),r=t.cleanup),new Eo((a,l)=>{const d=Nr(e,t,b=>{r&&d(),b?l(b):a()})})}ln.exports=Nr;ln.exports.finished=$o;var Ee=ln.exports;const fe=Oe,{aggregateTwoErrors:Co,codes:{ERR_MULTIPLE_CALLBACK:xo},AbortError:Do}=ne,{Symbol:Ir}=V,{kDestroyed:ko,isDestroyed:Lo,isFinished:Wo,isServerRequest:Fo}=ye,Mr=Ir("kDestroy"),Kt=Ir("kConstruct");function vr(e,t,n){e&&(e.stack,t&&!t.errored&&(t.errored=e),n&&!n.errored&&(n.errored=e))}function jo(e,t){const n=this._readableState,r=this._writableState,a=r||n;return r!=null&&r.destroyed||n!=null&&n.destroyed?(typeof t=="function"&&t(),this):(vr(e,r,n),r&&(r.destroyed=!0),n&&(n.destroyed=!0),a.constructed?Dn(this,e,t):this.once(Mr,function(l){Dn(this,Co(l,e),t)}),this)}function Dn(e,t,n){let r=!1;function a(l){if(r)return;r=!0;const d=e._readableState,b=e._writableState;vr(l,b,d),b&&(b.closed=!0),d&&(d.closed=!0),typeof n=="function"&&n(l),l?fe.nextTick(Uo,e,l):fe.nextTick(Pr,e)}try{e._destroy(t||null,a)}catch(l){a(l)}}function Uo(e,t){Yt(e,t),Pr(e)}function Pr(e){const t=e._readableState,n=e._writableState;n&&(n.closeEmitted=!0),t&&(t.closeEmitted=!0),(n!=null&&n.emitClose||t!=null&&t.emitClose)&&e.emit("close")}function Yt(e,t){const n=e._readableState,r=e._writableState;r!=null&&r.errorEmitted||n!=null&&n.errorEmitted||(r&&(r.errorEmitted=!0),n&&(n.errorEmitted=!0),e.emit("error",t))}function Bo(){const e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=e.readable===!1,e.endEmitted=e.readable===!1),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=t.writable===!1,t.ending=t.writable===!1,t.finished=t.writable===!1)}function Jt(e,t,n){const r=e._readableState,a=e._writableState;if(a!=null&&a.destroyed||r!=null&&r.destroyed)return this;r!=null&&r.autoDestroy||a!=null&&a.autoDestroy?e.destroy(t):t&&(t.stack,a&&!a.errored&&(a.errored=t),r&&!r.errored&&(r.errored=t),n?fe.nextTick(Yt,e,t):Yt(e,t))}function Go(e,t){if(typeof e._construct!="function")return;const n=e._readableState,r=e._writableState;n&&(n.constructed=!1),r&&(r.constructed=!1),e.once(Kt,t),!(e.listenerCount(Kt)>1)&&fe.nextTick(Vo,e)}function Vo(e){let t=!1;function n(r){if(t){Jt(e,r??new xo);return}t=!0;const a=e._readableState,l=e._writableState,d=l||a;a&&(a.constructed=!0),l&&(l.constructed=!0),d.destroyed?e.emit(Mr,r):r?Jt(e,r,!0):fe.nextTick(Ho,e)}try{e._construct(r=>{fe.nextTick(n,r)})}catch(r){fe.nextTick(n,r)}}function Ho(e){e.emit(Kt)}function kn(e){return(e==null?void 0:e.setHeader)&&typeof e.abort=="function"}function Or(e){e.emit("close")}function qo(e,t){e.emit("error",t),fe.nextTick(Or,e)}function Ko(e,t){!e||Lo(e)||(!t&&!Wo(e)&&(t=new Do),Fo(e)?(e.socket=null,e.destroy(t)):kn(e)?e.abort():kn(e.req)?e.req.abort():typeof e.destroy=="function"?e.destroy(t):typeof e.close=="function"?e.close():t?fe.nextTick(qo,e,t):fe.nextTick(Or,e),e.destroyed||(e[ko]=!0))}var je={construct:Go,destroyer:Ko,destroy:jo,undestroy:Bo,errorOrDestroy:Jt};const{ArrayIsArray:Yo,ObjectSetPrototypeOf:$r}=V,{EventEmitter:pt}=Zt;function wt(e){pt.call(this,e)}$r(wt.prototype,pt.prototype);$r(wt,pt);wt.prototype.pipe=function(e,t){const n=this;function r(c){e.writable&&e.write(c)===!1&&n.pause&&n.pause()}n.on("data",r);function a(){n.readable&&n.resume&&n.resume()}e.on("drain",a),!e._isStdio&&(!t||t.end!==!1)&&(n.on("end",d),n.on("close",b));let l=!1;function d(){l||(l=!0,e.end())}function b(){l||(l=!0,typeof e.destroy=="function"&&e.destroy())}function p(c){u(),pt.listenerCount(this,"error")===0&&this.emit("error",c)}Xt(n,"error",p),Xt(e,"error",p);function u(){n.removeListener("data",r),e.removeListener("drain",a),n.removeListener("end",d),n.removeListener("close",b),n.removeListener("error",p),e.removeListener("error",p),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};function Xt(e,t,n){if(typeof e.prependListener=="function")return e.prependListener(t,n);!e._events||!e._events[t]?e.on(t,n):Yo(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]}var sn={Stream:wt,prependListener:Xt},Cr={exports:{}};(function(e){const{AbortError:t,codes:n}=ne,{isNodeStream:r,isWebStream:a,kControllerErrorFunction:l}=ye,d=Ee,{ERR_INVALID_ARG_TYPE:b}=n,p=(u,c)=>{if(typeof u!="object"||!("aborted"in u))throw new b(c,"AbortSignal",u)};e.exports.addAbortSignal=function(c,R){if(p(c,"signal"),!r(R)&&!a(R))throw new b("stream",["ReadableStream","WritableStream","Stream"],R);return e.exports.addAbortSignalNoValidate(c,R)},e.exports.addAbortSignalNoValidate=function(u,c){if(typeof u!="object"||!("aborted"in u))return c;const R=r(c)?()=>{c.destroy(new t(void 0,{cause:u.reason}))}:()=>{c[l](new t(void 0,{cause:u.reason}))};return u.aborted?R():(u.addEventListener("abort",R),d(c,()=>u.removeEventListener("abort",R))),c}})(Cr);var yt=Cr.exports;const{StringPrototypeSlice:Ln,SymbolIterator:Jo,TypedArrayPrototypeSet:Ze,Uint8Array:Xo}=V,{Buffer:vt}=Pe,{inspect:zo}=we;var Qo=class{constructor(){this.head=null,this.tail=null,this.length=0}push(t){const n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}unshift(t){const n={data:t,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}shift(){if(this.length===0)return;const t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}clear(){this.head=this.tail=null,this.length=0}join(t){if(this.length===0)return"";let n=this.head,r=""+n.data;for(;(n=n.next)!==null;)r+=t+n.data;return r}concat(t){if(this.length===0)return vt.alloc(0);const n=vt.allocUnsafe(t>>>0);let r=this.head,a=0;for(;r;)Ze(n,r.data,a),a+=r.data.length,r=r.next;return n}consume(t,n){const r=this.head.data;if(t<r.length){const a=r.slice(0,t);return this.head.data=r.slice(t),a}return t===r.length?this.shift():n?this._getString(t):this._getBuffer(t)}first(){return this.head.data}*[Jo](){for(let t=this.head;t;t=t.next)yield t.data}_getString(t){let n="",r=this.head,a=0;do{const l=r.data;if(t>l.length)n+=l,t-=l.length;else{t===l.length?(n+=l,++a,r.next?this.head=r.next:this.head=this.tail=null):(n+=Ln(l,0,t),this.head=r,r.data=Ln(l,t));break}++a}while((r=r.next)!==null);return this.length-=a,n}_getBuffer(t){const n=vt.allocUnsafe(t),r=t;let a=this.head,l=0;do{const d=a.data;if(t>d.length)Ze(n,d,r-t),t-=d.length;else{t===d.length?(Ze(n,d,r-t),++l,a.next?this.head=a.next:this.head=this.tail=null):(Ze(n,new Xo(d.buffer,d.byteOffset,t),r-t),this.head=a,a.data=d.slice(t));break}++l}while((a=a.next)!==null);return this.length-=l,n}[Symbol.for("nodejs.util.inspect.custom")](t,n){return zo(this,{...n,depth:0,customInspect:!1})}};const{MathFloor:Zo,NumberIsInteger:ea}=V,{ERR_INVALID_ARG_VALUE:ta}=ne.codes;function na(e,t,n){return e.highWaterMark!=null?e.highWaterMark:t?e[n]:null}function xr(e){return e?16:16*1024}function ra(e,t,n,r){const a=na(t,r,n);if(a!=null){if(!ea(a)||a<0){const l=r?`options.${n}`:"options.highWaterMark";throw new ta(l,a)}return Zo(a)}return xr(e.objectMode)}var fn={getHighWaterMark:ra,getDefaultHighWaterMark:xr};const Wn=Oe,{PromisePrototypeThen:ia,SymbolAsyncIterator:Fn,SymbolIterator:jn}=V,{Buffer:oa}=Pe,{ERR_INVALID_ARG_TYPE:aa,ERR_STREAM_NULL_VALUES:la}=ne.codes;function sa(e,t,n){let r;if(typeof t=="string"||t instanceof oa)return new e({objectMode:!0,...n,read(){this.push(t),this.push(null)}});let a;if(t&&t[Fn])a=!0,r=t[Fn]();else if(t&&t[jn])a=!1,r=t[jn]();else throw new aa("iterable",["Iterable"],t);const l=new e({objectMode:!0,highWaterMark:1,...n});let d=!1;l._read=function(){d||(d=!0,p())},l._destroy=function(u,c){ia(b(u),()=>Wn.nextTick(c,u),R=>Wn.nextTick(c,R||u))};async function b(u){const c=u!=null,R=typeof r.throw=="function";if(c&&R){const{value:I,done:y}=await r.throw(u);if(await I,y)return}if(typeof r.return=="function"){const{value:I}=await r.return();await I}}async function p(){for(;;){try{const{value:u,done:c}=a?await r.next():r.next();if(c)l.push(null);else{const R=u&&typeof u.then=="function"?await u:u;if(R===null)throw d=!1,new la;if(l.push(R))continue;d=!1}}catch(u){l.destroy(u)}break}}return l}var Dr=sa,Pt,Un;function _t(){if(Un)return Pt;Un=1;const e=Oe,{ArrayPrototypeIndexOf:t,NumberIsInteger:n,NumberIsNaN:r,NumberParseInt:a,ObjectDefineProperties:l,ObjectKeys:d,ObjectSetPrototypeOf:b,Promise:p,SafeSet:u,SymbolAsyncIterator:c,Symbol:R}=V;Pt=m,m.ReadableState=oe;const{EventEmitter:I}=Zt,{Stream:y,prependListener:h}=sn,{Buffer:x}=Pe,{addAbortSignal:P}=yt,M=Ee;let w=we.debuglog("stream",i=>{w=i});const C=Qo,U=je,{getHighWaterMark:O,getDefaultHighWaterMark:H}=fn,{aggregateTwoErrors:B,codes:{ERR_INVALID_ARG_TYPE:q,ERR_METHOD_NOT_IMPLEMENTED:j,ERR_OUT_OF_RANGE:_,ERR_STREAM_PUSH_AFTER_EOF:$,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:K}}=ne,{validateObject:D}=ut,k=R("kPaused"),{StringDecoder:v}=zr,G=Dr;b(m.prototype,y.prototype),b(m,y);const Y=()=>{},{errorOrDestroy:L}=U;function oe(i,o,S){typeof S!="boolean"&&(S=o instanceof ge()),this.objectMode=!!(i&&i.objectMode),S&&(this.objectMode=this.objectMode||!!(i&&i.readableObjectMode)),this.highWaterMark=i?O(this,i,"readableHighWaterMark",S):H(!1),this.buffer=new C,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[k]=null,this.errorEmitted=!1,this.emitClose=!i||i.emitClose!==!1,this.autoDestroy=!i||i.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=i&&i.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,i&&i.encoding&&(this.decoder=new v(i.encoding),this.encoding=i.encoding)}function m(i){if(!(this instanceof m))return new m(i);const o=this instanceof ge();this._readableState=new oe(i,this,o),i&&(typeof i.read=="function"&&(this._read=i.read),typeof i.destroy=="function"&&(this._destroy=i.destroy),typeof i.construct=="function"&&(this._construct=i.construct),i.signal&&!o&&P(i.signal,this)),y.call(this,i),U.construct(this,()=>{this._readableState.needReadable&&_e(this,this._readableState)})}m.prototype.destroy=U.destroy,m.prototype._undestroy=U.undestroy,m.prototype._destroy=function(i,o){o(i)},m.prototype[I.captureRejectionSymbol]=function(i){this.destroy(i)},m.prototype.push=function(i,o){return te(this,i,o,!1)},m.prototype.unshift=function(i,o){return te(this,i,o,!0)};function te(i,o,S,E){w("readableAddChunk",o);const A=i._readableState;let Q;if(A.objectMode||(typeof o=="string"?(S=S||A.defaultEncoding,A.encoding!==S&&(E&&A.encoding?o=x.from(o,S).toString(A.encoding):(o=x.from(o,S),S=""))):o instanceof x?S="":y._isUint8Array(o)?(o=y._uint8ArrayToBuffer(o),S=""):o!=null&&(Q=new q("chunk",["string","Buffer","Uint8Array"],o))),Q)L(i,Q);else if(o===null)A.reading=!1,St(i,A);else if(A.objectMode||o&&o.length>0)if(E)if(A.endEmitted)L(i,new K);else{if(A.destroyed||A.errored)return!1;ce(i,A,o,!0)}else if(A.ended)L(i,new $);else{if(A.destroyed||A.errored)return!1;A.reading=!1,A.decoder&&!S?(o=A.decoder.write(o),A.objectMode||o.length!==0?ce(i,A,o,!1):_e(i,A)):ce(i,A,o,!1)}else E||(A.reading=!1,_e(i,A));return!A.ended&&(A.length<A.highWaterMark||A.length===0)}function ce(i,o,S,E){o.flowing&&o.length===0&&!o.sync&&i.listenerCount("data")>0?(o.multiAwaitDrain?o.awaitDrainWriters.clear():o.awaitDrainWriters=null,o.dataEmitted=!0,i.emit("data",S)):(o.length+=o.objectMode?1:S.length,E?o.buffer.unshift(S):o.buffer.push(S),o.needReadable&&xe(i)),_e(i,o)}m.prototype.isPaused=function(){const i=this._readableState;return i[k]===!0||i.flowing===!1},m.prototype.setEncoding=function(i){const o=new v(i);this._readableState.decoder=o,this._readableState.encoding=this._readableState.decoder.encoding;const S=this._readableState.buffer;let E="";for(const A of S)E+=o.write(A);return S.clear(),E!==""&&S.push(E),this._readableState.length=E.length,this};const Ue=1073741824;function Be(i){if(i>Ue)throw new _("size","<= 1GiB",i);return i--,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i++,i}function Re(i,o){return i<=0||o.length===0&&o.ended?0:o.objectMode?1:r(i)?o.flowing&&o.length?o.buffer.first().length:o.length:i<=o.length?i:o.ended?o.length:0}m.prototype.read=function(i){w("read",i),i===void 0?i=NaN:n(i)||(i=a(i,10));const o=this._readableState,S=i;if(i>o.highWaterMark&&(o.highWaterMark=Be(i)),i!==0&&(o.emittedReadable=!1),i===0&&o.needReadable&&((o.highWaterMark!==0?o.length>=o.highWaterMark:o.length>0)||o.ended))return w("read: emitReadable",o.length,o.ended),o.length===0&&o.ended?le(this):xe(this),null;if(i=Re(i,o),i===0&&o.ended)return o.length===0&&le(this),null;let E=o.needReadable;if(w("need readable",E),(o.length===0||o.length-i<o.highWaterMark)&&(E=!0,w("length less than watermark",E)),o.ended||o.reading||o.destroyed||o.errored||!o.constructed)E=!1,w("reading, ended or constructing",E);else if(E){w("do read"),o.reading=!0,o.sync=!0,o.length===0&&(o.needReadable=!0);try{this._read(o.highWaterMark)}catch(Q){L(this,Q)}o.sync=!1,o.reading||(i=Re(S,o))}let A;return i>0?A=F(i,o):A=null,A===null?(o.needReadable=o.length<=o.highWaterMark,i=0):(o.length-=i,o.multiAwaitDrain?o.awaitDrainWriters.clear():o.awaitDrainWriters=null),o.length===0&&(o.ended||(o.needReadable=!0),S!==i&&o.ended&&le(this)),A!==null&&!o.errorEmitted&&!o.closeEmitted&&(o.dataEmitted=!0,this.emit("data",A)),A};function St(i,o){if(w("onEofChunk"),!o.ended){if(o.decoder){const S=o.decoder.end();S&&S.length&&(o.buffer.push(S),o.length+=o.objectMode?1:S.length)}o.ended=!0,o.sync?xe(i):(o.needReadable=!1,o.emittedReadable=!0,De(i))}}function xe(i){const o=i._readableState;w("emitReadable",o.needReadable,o.emittedReadable),o.needReadable=!1,o.emittedReadable||(w("emitReadable",o.flowing),o.emittedReadable=!0,e.nextTick(De,i))}function De(i){const o=i._readableState;w("emitReadable_",o.destroyed,o.length,o.ended),!o.destroyed&&!o.errored&&(o.length||o.ended)&&(i.emit("readable"),o.emittedReadable=!1),o.needReadable=!o.flowing&&!o.ended&&o.length<=o.highWaterMark,T(i)}function _e(i,o){!o.readingMore&&o.constructed&&(o.readingMore=!0,e.nextTick(Et,i,o))}function Et(i,o){for(;!o.reading&&!o.ended&&(o.length<o.highWaterMark||o.flowing&&o.length===0);){const S=o.length;if(w("maybeReadMore read 0"),i.read(0),S===o.length)break}o.readingMore=!1}m.prototype._read=function(i){throw new j("_read()")},m.prototype.pipe=function(i,o){const S=this,E=this._readableState;E.pipes.length===1&&(E.multiAwaitDrain||(E.multiAwaitDrain=!0,E.awaitDrainWriters=new u(E.awaitDrainWriters?[E.awaitDrainWriters]:[]))),E.pipes.push(i),w("pipe count=%d opts=%j",E.pipes.length,o);const Q=(!o||o.end!==!1)&&i!==e.stdout&&i!==e.stderr?pn:qe;E.endEmitted?e.nextTick(Q):S.once("end",Q),i.on("unpipe",re);function re(Te,be){w("onunpipe"),Te===S&&be&&be.hasUnpiped===!1&&(be.hasUnpiped=!0,Jr())}function pn(){w("onend"),i.end()}let Ae,wn=!1;function Jr(){w("cleanup"),i.removeListener("close",At),i.removeListener("finish",Tt),Ae&&i.removeListener("drain",Ae),i.removeListener("error",Rt),i.removeListener("unpipe",re),S.removeListener("end",pn),S.removeListener("end",qe),S.removeListener("data",_n),wn=!0,Ae&&E.awaitDrainWriters&&(!i._writableState||i._writableState.needDrain)&&Ae()}function yn(){wn||(E.pipes.length===1&&E.pipes[0]===i?(w("false write response, pause",0),E.awaitDrainWriters=i,E.multiAwaitDrain=!1):E.pipes.length>1&&E.pipes.includes(i)&&(w("false write response, pause",E.awaitDrainWriters.size),E.awaitDrainWriters.add(i)),S.pause()),Ae||(Ae=Ge(S,i),i.on("drain",Ae))}S.on("data",_n);function _n(Te){w("ondata");const be=i.write(Te);w("dest.write",be),be===!1&&yn()}function Rt(Te){if(w("onerror",Te),qe(),i.removeListener("error",Rt),i.listenerCount("error")===0){const be=i._writableState||i._readableState;be&&!be.errorEmitted?L(i,Te):i.emit("error",Te)}}h(i,"error",Rt);function At(){i.removeListener("finish",Tt),qe()}i.once("close",At);function Tt(){w("onfinish"),i.removeListener("close",At),qe()}i.once("finish",Tt);function qe(){w("unpipe"),S.unpipe(i)}return i.emit("pipe",S),i.writableNeedDrain===!0?E.flowing&&yn():E.flowing||(w("pipe resume"),S.resume()),i};function Ge(i,o){return function(){const E=i._readableState;E.awaitDrainWriters===o?(w("pipeOnDrain",1),E.awaitDrainWriters=null):E.multiAwaitDrain&&(w("pipeOnDrain",E.awaitDrainWriters.size),E.awaitDrainWriters.delete(o)),(!E.awaitDrainWriters||E.awaitDrainWriters.size===0)&&i.listenerCount("data")&&i.resume()}}m.prototype.unpipe=function(i){const o=this._readableState,S={hasUnpiped:!1};if(o.pipes.length===0)return this;if(!i){const A=o.pipes;o.pipes=[],this.pause();for(let Q=0;Q<A.length;Q++)A[Q].emit("unpipe",this,{hasUnpiped:!1});return this}const E=t(o.pipes,i);return E===-1?this:(o.pipes.splice(E,1),o.pipes.length===0&&this.pause(),i.emit("unpipe",this,S),this)},m.prototype.on=function(i,o){const S=y.prototype.on.call(this,i,o),E=this._readableState;return i==="data"?(E.readableListening=this.listenerCount("readable")>0,E.flowing!==!1&&this.resume()):i==="readable"&&!E.endEmitted&&!E.readableListening&&(E.readableListening=E.needReadable=!0,E.flowing=!1,E.emittedReadable=!1,w("on readable",E.length,E.reading),E.length?xe(this):E.reading||e.nextTick(s,this)),S},m.prototype.addListener=m.prototype.on,m.prototype.removeListener=function(i,o){const S=y.prototype.removeListener.call(this,i,o);return i==="readable"&&e.nextTick(Ve,this),S},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(i){const o=y.prototype.removeAllListeners.apply(this,arguments);return(i==="readable"||i===void 0)&&e.nextTick(Ve,this),o};function Ve(i){const o=i._readableState;o.readableListening=i.listenerCount("readable")>0,o.resumeScheduled&&o[k]===!1?o.flowing=!0:i.listenerCount("data")>0?i.resume():o.readableListening||(o.flowing=null)}function s(i){w("readable nexttick read 0"),i.read(0)}m.prototype.resume=function(){const i=this._readableState;return i.flowing||(w("resume"),i.flowing=!i.readableListening,f(this,i)),i[k]=!1,this};function f(i,o){o.resumeScheduled||(o.resumeScheduled=!0,e.nextTick(g,i,o))}function g(i,o){w("resume",o.reading),o.reading||i.read(0),o.resumeScheduled=!1,i.emit("resume"),T(i),o.flowing&&!o.reading&&i.read(0)}m.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[k]=!0,this};function T(i){const o=i._readableState;for(w("flow",o.flowing);o.flowing&&i.read()!==null;);}m.prototype.wrap=function(i){let o=!1;i.on("data",E=>{!this.push(E)&&i.pause&&(o=!0,i.pause())}),i.on("end",()=>{this.push(null)}),i.on("error",E=>{L(this,E)}),i.on("close",()=>{this.destroy()}),i.on("destroy",()=>{this.destroy()}),this._read=()=>{o&&i.resume&&(o=!1,i.resume())};const S=d(i);for(let E=1;E<S.length;E++){const A=S[E];this[A]===void 0&&typeof i[A]=="function"&&(this[A]=i[A].bind(i))}return this},m.prototype[c]=function(){return N(this)},m.prototype.iterator=function(i){return i!==void 0&&D(i,"options"),N(this,i)};function N(i,o){typeof i.read!="function"&&(i=m.wrap(i,{objectMode:!0}));const S=W(i,o);return S.stream=i,S}async function*W(i,o){let S=Y;function E(re){this===i?(S(),S=Y):S=re}i.on("readable",E);let A;const Q=M(i,{writable:!1},re=>{A=re?B(A,re):null,S(),S=Y});try{for(;;){const re=i.destroyed?null:i.read();if(re!==null)yield re;else{if(A)throw A;if(A===null)return;await new p(E)}}}catch(re){throw A=B(A,re),A}finally{(A||(o==null?void 0:o.destroyOnReturn)!==!1)&&(A===void 0||i._readableState.autoDestroy)?U.destroyer(i,null):(i.off("readable",E),Q())}}l(m.prototype,{readable:{__proto__:null,get(){const i=this._readableState;return!!i&&i.readable!==!1&&!i.destroyed&&!i.errorEmitted&&!i.endEmitted},set(i){this._readableState&&(this._readableState.readable=!!i)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(i){this._readableState&&(this._readableState.flowing=i)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(i){this._readableState&&(this._readableState.destroyed=i)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),l(oe.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[k]!==!1},set(i){this[k]=!!i}}}),m._fromList=F;function F(i,o){if(o.length===0)return null;let S;return o.objectMode?S=o.buffer.shift():!i||i>=o.length?(o.decoder?S=o.buffer.join(""):o.buffer.length===1?S=o.buffer.first():S=o.buffer.concat(o.length),o.buffer.clear()):S=o.buffer.consume(i,o.decoder),S}function le(i){const o=i._readableState;w("endReadable",o.endEmitted),o.endEmitted||(o.ended=!0,e.nextTick(ke,o,i))}function ke(i,o){if(w("endReadableNT",i.endEmitted,i.length),!i.errored&&!i.closeEmitted&&!i.endEmitted&&i.length===0){if(i.endEmitted=!0,o.emit("end"),o.writable&&o.allowHalfOpen===!1)e.nextTick(He,o);else if(i.autoDestroy){const S=o._writableState;(!S||S.autoDestroy&&(S.finished||S.writable===!1))&&o.destroy()}}}function He(i){i.writable&&!i.writableEnded&&!i.destroyed&&i.end()}m.from=function(i,o){return G(m,i,o)};let he;function gn(){return he===void 0&&(he={}),he}return m.fromWeb=function(i,o){return gn().newStreamReadableFromReadableStream(i,o)},m.toWeb=function(i,o){return gn().newReadableStreamFromStreamReadable(i,o)},m.wrap=function(i,o){var S,E;return new m({objectMode:(S=(E=i.readableObjectMode)!==null&&E!==void 0?E:i.objectMode)!==null&&S!==void 0?S:!0,...o,destroy(A,Q){U.destroyer(i,A),Q(A)}}).wrap(i)},Pt}var Ot,Bn;function kr(){if(Bn)return Ot;Bn=1;const e=Oe,{ArrayPrototypeSlice:t,Error:n,FunctionPrototypeSymbolHasInstance:r,ObjectDefineProperty:a,ObjectDefineProperties:l,ObjectSetPrototypeOf:d,StringPrototypeToLowerCase:b,Symbol:p,SymbolHasInstance:u}=V;Ot=v,v.WritableState=D;const{EventEmitter:c}=Zt,R=sn.Stream,{Buffer:I}=Pe,y=je,{addAbortSignal:h}=yt,{getHighWaterMark:x,getDefaultHighWaterMark:P}=fn,{ERR_INVALID_ARG_TYPE:M,ERR_METHOD_NOT_IMPLEMENTED:w,ERR_MULTIPLE_CALLBACK:C,ERR_STREAM_CANNOT_PIPE:U,ERR_STREAM_DESTROYED:O,ERR_STREAM_ALREADY_FINISHED:H,ERR_STREAM_NULL_VALUES:B,ERR_STREAM_WRITE_AFTER_END:q,ERR_UNKNOWN_ENCODING:j}=ne.codes,{errorOrDestroy:_}=y;d(v.prototype,R.prototype),d(v,R);function $(){}const K=p("kOnFinished");function D(s,f,g){typeof g!="boolean"&&(g=f instanceof ge()),this.objectMode=!!(s&&s.objectMode),g&&(this.objectMode=this.objectMode||!!(s&&s.writableObjectMode)),this.highWaterMark=s?x(this,s,"writableHighWaterMark",g):P(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const T=!!(s&&s.decodeStrings===!1);this.decodeStrings=!T,this.defaultEncoding=s&&s.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=m.bind(void 0,f),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,k(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!s||s.emitClose!==!1,this.autoDestroy=!s||s.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[K]=[]}function k(s){s.buffered=[],s.bufferedIndex=0,s.allBuffers=!0,s.allNoop=!0}D.prototype.getBuffer=function(){return t(this.buffered,this.bufferedIndex)},a(D.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function v(s){const f=this instanceof ge();if(!f&&!r(v,this))return new v(s);this._writableState=new D(s,this,f),s&&(typeof s.write=="function"&&(this._write=s.write),typeof s.writev=="function"&&(this._writev=s.writev),typeof s.destroy=="function"&&(this._destroy=s.destroy),typeof s.final=="function"&&(this._final=s.final),typeof s.construct=="function"&&(this._construct=s.construct),s.signal&&h(s.signal,this)),R.call(this,s),y.construct(this,()=>{const g=this._writableState;g.writing||Be(this,g),De(this,g)})}a(v,u,{__proto__:null,value:function(s){return r(this,s)?!0:this!==v?!1:s&&s._writableState instanceof D}}),v.prototype.pipe=function(){_(this,new U)};function G(s,f,g,T){const N=s._writableState;if(typeof g=="function")T=g,g=N.defaultEncoding;else{if(!g)g=N.defaultEncoding;else if(g!=="buffer"&&!I.isEncoding(g))throw new j(g);typeof T!="function"&&(T=$)}if(f===null)throw new B;if(!N.objectMode)if(typeof f=="string")N.decodeStrings!==!1&&(f=I.from(f,g),g="buffer");else if(f instanceof I)g="buffer";else if(R._isUint8Array(f))f=R._uint8ArrayToBuffer(f),g="buffer";else throw new M("chunk",["string","Buffer","Uint8Array"],f);let W;return N.ending?W=new q:N.destroyed&&(W=new O("write")),W?(e.nextTick(T,W),_(s,W,!0),W):(N.pendingcb++,Y(s,N,f,g,T))}v.prototype.write=function(s,f,g){return G(this,s,f,g)===!0},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){const s=this._writableState;s.corked&&(s.corked--,s.writing||Be(this,s))},v.prototype.setDefaultEncoding=function(f){if(typeof f=="string"&&(f=b(f)),!I.isEncoding(f))throw new j(f);return this._writableState.defaultEncoding=f,this};function Y(s,f,g,T,N){const W=f.objectMode?1:g.length;f.length+=W;const F=f.length<f.highWaterMark;return F||(f.needDrain=!0),f.writing||f.corked||f.errored||!f.constructed?(f.buffered.push({chunk:g,encoding:T,callback:N}),f.allBuffers&&T!=="buffer"&&(f.allBuffers=!1),f.allNoop&&N!==$&&(f.allNoop=!1)):(f.writelen=W,f.writecb=N,f.writing=!0,f.sync=!0,s._write(g,T,f.onwrite),f.sync=!1),F&&!f.errored&&!f.destroyed}function L(s,f,g,T,N,W,F){f.writelen=T,f.writecb=F,f.writing=!0,f.sync=!0,f.destroyed?f.onwrite(new O("write")):g?s._writev(N,f.onwrite):s._write(N,W,f.onwrite),f.sync=!1}function oe(s,f,g,T){--f.pendingcb,T(g),Ue(f),_(s,g)}function m(s,f){const g=s._writableState,T=g.sync,N=g.writecb;if(typeof N!="function"){_(s,new C);return}g.writing=!1,g.writecb=null,g.length-=g.writelen,g.writelen=0,f?(f.stack,g.errored||(g.errored=f),s._readableState&&!s._readableState.errored&&(s._readableState.errored=f),T?e.nextTick(oe,s,g,f,N):oe(s,g,f,N)):(g.buffered.length>g.bufferedIndex&&Be(s,g),T?g.afterWriteTickInfo!==null&&g.afterWriteTickInfo.cb===N?g.afterWriteTickInfo.count++:(g.afterWriteTickInfo={count:1,cb:N,stream:s,state:g},e.nextTick(te,g.afterWriteTickInfo)):ce(s,g,1,N))}function te({stream:s,state:f,count:g,cb:T}){return f.afterWriteTickInfo=null,ce(s,f,g,T)}function ce(s,f,g,T){for(!f.ending&&!s.destroyed&&f.length===0&&f.needDrain&&(f.needDrain=!1,s.emit("drain"));g-- >0;)f.pendingcb--,T();f.destroyed&&Ue(f),De(s,f)}function Ue(s){if(s.writing)return;for(let N=s.bufferedIndex;N<s.buffered.length;++N){var f;const{chunk:W,callback:F}=s.buffered[N],le=s.objectMode?1:W.length;s.length-=le,F((f=s.errored)!==null&&f!==void 0?f:new O("write"))}const g=s[K].splice(0);for(let N=0;N<g.length;N++){var T;g[N]((T=s.errored)!==null&&T!==void 0?T:new O("end"))}k(s)}function Be(s,f){if(f.corked||f.bufferProcessing||f.destroyed||!f.constructed)return;const{buffered:g,bufferedIndex:T,objectMode:N}=f,W=g.length-T;if(!W)return;let F=T;if(f.bufferProcessing=!0,W>1&&s._writev){f.pendingcb-=W-1;const le=f.allNoop?$:He=>{for(let he=F;he<g.length;++he)g[he].callback(He)},ke=f.allNoop&&F===0?g:t(g,F);ke.allBuffers=f.allBuffers,L(s,f,!0,f.length,ke,"",le),k(f)}else{do{const{chunk:le,encoding:ke,callback:He}=g[F];g[F++]=null;const he=N?1:le.length;L(s,f,!1,he,le,ke,He)}while(F<g.length&&!f.writing);F===g.length?k(f):F>256?(g.splice(0,F),f.bufferedIndex=0):f.bufferedIndex=F}f.bufferProcessing=!1}v.prototype._write=function(s,f,g){if(this._writev)this._writev([{chunk:s,encoding:f}],g);else throw new w("_write()")},v.prototype._writev=null,v.prototype.end=function(s,f,g){const T=this._writableState;typeof s=="function"?(g=s,s=null,f=null):typeof f=="function"&&(g=f,f=null);let N;if(s!=null){const W=G(this,s,f);W instanceof n&&(N=W)}return T.corked&&(T.corked=1,this.uncork()),N||(!T.errored&&!T.ending?(T.ending=!0,De(this,T,!0),T.ended=!0):T.finished?N=new H("end"):T.destroyed&&(N=new O("end"))),typeof g=="function"&&(N||T.finished?e.nextTick(g,N):T[K].push(g)),this};function Re(s){return s.ending&&!s.destroyed&&s.constructed&&s.length===0&&!s.errored&&s.buffered.length===0&&!s.finished&&!s.writing&&!s.errorEmitted&&!s.closeEmitted}function St(s,f){let g=!1;function T(N){if(g){_(s,N??C());return}if(g=!0,f.pendingcb--,N){const W=f[K].splice(0);for(let F=0;F<W.length;F++)W[F](N);_(s,N,f.sync)}else Re(f)&&(f.prefinished=!0,s.emit("prefinish"),f.pendingcb++,e.nextTick(_e,s,f))}f.sync=!0,f.pendingcb++;try{s._final(T)}catch(N){T(N)}f.sync=!1}function xe(s,f){!f.prefinished&&!f.finalCalled&&(typeof s._final=="function"&&!f.destroyed?(f.finalCalled=!0,St(s,f)):(f.prefinished=!0,s.emit("prefinish")))}function De(s,f,g){Re(f)&&(xe(s,f),f.pendingcb===0&&(g?(f.pendingcb++,e.nextTick((T,N)=>{Re(N)?_e(T,N):N.pendingcb--},s,f)):Re(f)&&(f.pendingcb++,_e(s,f))))}function _e(s,f){f.pendingcb--,f.finished=!0;const g=f[K].splice(0);for(let T=0;T<g.length;T++)g[T]();if(s.emit("finish"),f.autoDestroy){const T=s._readableState;(!T||T.autoDestroy&&(T.endEmitted||T.readable===!1))&&s.destroy()}}l(v.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(s){this._writableState&&(this._writableState.destroyed=s)}},writable:{__proto__:null,get(){const s=this._writableState;return!!s&&s.writable!==!1&&!s.destroyed&&!s.errored&&!s.ending&&!s.ended},set(s){this._writableState&&(this._writableState.writable=!!s)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const s=this._writableState;return s?!s.destroyed&&!s.ending&&s.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Et=y.destroy;v.prototype.destroy=function(s,f){const g=this._writableState;return!g.destroyed&&(g.bufferedIndex<g.buffered.length||g[K].length)&&e.nextTick(Ue,g),Et.call(this,s,f),this},v.prototype._undestroy=y.undestroy,v.prototype._destroy=function(s,f){f(s)},v.prototype[c.captureRejectionSymbol]=function(s){this.destroy(s)};let Ge;function Ve(){return Ge===void 0&&(Ge={}),Ge}return v.fromWeb=function(s,f){return Ve().newStreamWritableFromWritableStream(s,f)},v.toWeb=function(s){return Ve().newWritableStreamFromStreamWritable(s)},Ot}var $t,Gn;function fa(){if(Gn)return $t;Gn=1;const e=Oe,t=Pe,{isReadable:n,isWritable:r,isIterable:a,isNodeStream:l,isReadableNodeStream:d,isWritableNodeStream:b,isDuplexNodeStream:p}=ye,u=Ee,{AbortError:c,codes:{ERR_INVALID_ARG_TYPE:R,ERR_INVALID_RETURN_VALUE:I}}=ne,{destroyer:y}=je,h=ge(),x=_t(),{createDeferredPromise:P}=we,M=Dr,w=globalThis.Blob||t.Blob,C=typeof w<"u"?function(_){return _ instanceof w}:function(_){return!1},U=globalThis.AbortController||en().AbortController,{FunctionPrototypeCall:O}=V;class H extends h{constructor(_){super(_),(_==null?void 0:_.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(_==null?void 0:_.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}$t=function j(_,$){if(p(_))return _;if(d(_))return q({readable:_});if(b(_))return q({writable:_});if(l(_))return q({writable:!1,readable:!1});if(typeof _=="function"){const{value:D,write:k,final:v,destroy:G}=B(_);if(a(D))return M(H,D,{objectMode:!0,write:k,final:v,destroy:G});const Y=D==null?void 0:D.then;if(typeof Y=="function"){let L;const oe=O(Y,D,m=>{if(m!=null)throw new I("nully","body",m)},m=>{y(L,m)});return L=new H({objectMode:!0,readable:!1,write:k,final(m){v(async()=>{try{await oe,e.nextTick(m,null)}catch(te){e.nextTick(m,te)}})},destroy:G})}throw new I("Iterable, AsyncIterable or AsyncFunction",$,D)}if(C(_))return j(_.arrayBuffer());if(a(_))return M(H,_,{objectMode:!0,writable:!1});if(typeof(_==null?void 0:_.writable)=="object"||typeof(_==null?void 0:_.readable)=="object"){const D=_!=null&&_.readable?d(_==null?void 0:_.readable)?_==null?void 0:_.readable:j(_.readable):void 0,k=_!=null&&_.writable?b(_==null?void 0:_.writable)?_==null?void 0:_.writable:j(_.writable):void 0;return q({readable:D,writable:k})}const K=_==null?void 0:_.then;if(typeof K=="function"){let D;return O(K,_,k=>{k!=null&&D.push(k),D.push(null)},k=>{y(D,k)}),D=new H({objectMode:!0,writable:!1,read(){}})}throw new R($,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],_)};function B(j){let{promise:_,resolve:$}=P();const K=new U,D=K.signal;return{value:j(async function*(){for(;;){const v=_;_=null;const{chunk:G,done:Y,cb:L}=await v;if(e.nextTick(L),Y)return;if(D.aborted)throw new c(void 0,{cause:D.reason});({promise:_,resolve:$}=P()),yield G}}(),{signal:D}),write(v,G,Y){const L=$;$=null,L({chunk:v,done:!1,cb:Y})},final(v){const G=$;$=null,G({done:!0,cb:v})},destroy(v,G){K.abort(),G(v)}}}function q(j){const _=j.readable&&typeof j.readable.read!="function"?x.wrap(j.readable):j.readable,$=j.writable;let K=!!n(_),D=!!r($),k,v,G,Y,L;function oe(m){const te=Y;Y=null,te?te(m):m&&L.destroy(m)}return L=new H({readableObjectMode:!!(_!=null&&_.readableObjectMode),writableObjectMode:!!($!=null&&$.writableObjectMode),readable:K,writable:D}),D&&(u($,m=>{D=!1,m&&y(_,m),oe(m)}),L._write=function(m,te,ce){$.write(m,te)?ce():k=ce},L._final=function(m){$.end(),v=m},$.on("drain",function(){if(k){const m=k;k=null,m()}}),$.on("finish",function(){if(v){const m=v;v=null,m()}})),K&&(u(_,m=>{K=!1,m&&y(_,m),oe(m)}),_.on("readable",function(){if(G){const m=G;G=null,m()}}),_.on("end",function(){L.push(null)}),L._read=function(){for(;;){const m=_.read();if(m===null){G=L._read;return}if(!L.push(m))return}}),L._destroy=function(m,te){!m&&Y!==null&&(m=new c),G=null,k=null,v=null,Y===null?te(m):(Y=te,y($,m),y(_,m))},L}return $t}var Ct,Vn;function ge(){if(Vn)return Ct;Vn=1;const{ObjectDefineProperties:e,ObjectGetOwnPropertyDescriptor:t,ObjectKeys:n,ObjectSetPrototypeOf:r}=V;Ct=d;const a=_t(),l=kr();r(d.prototype,a.prototype),r(d,a);{const c=n(l.prototype);for(let R=0;R<c.length;R++){const I=c[R];d.prototype[I]||(d.prototype[I]=l.prototype[I])}}function d(c){if(!(this instanceof d))return new d(c);a.call(this,c),l.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}e(d.prototype,{writable:{__proto__:null,...t(l.prototype,"writable")},writableHighWaterMark:{__proto__:null,...t(l.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...t(l.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...t(l.prototype,"writableBuffer")},writableLength:{__proto__:null,...t(l.prototype,"writableLength")},writableFinished:{__proto__:null,...t(l.prototype,"writableFinished")},writableCorked:{__proto__:null,...t(l.prototype,"writableCorked")},writableEnded:{__proto__:null,...t(l.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...t(l.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});let b;function p(){return b===void 0&&(b={}),b}d.fromWeb=function(c,R){return p().newStreamDuplexFromReadableWritablePair(c,R)},d.toWeb=function(c){return p().newReadableWritablePairFromDuplex(c)};let u;return d.from=function(c){return u||(u=fa()),u(c,"body")},Ct}const{ObjectSetPrototypeOf:Lr,Symbol:da}=V;var Wr=pe;const{ERR_METHOD_NOT_IMPLEMENTED:ua}=ne.codes,dn=ge(),{getHighWaterMark:ca}=fn;Lr(pe.prototype,dn.prototype);Lr(pe,dn);const Xe=da("kCallback");function pe(e){if(!(this instanceof pe))return new pe(e);const t=e?ca(this,e,"readableHighWaterMark",!0):null;t===0&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),dn.call(this,e),this._readableState.sync=!1,this[Xe]=null,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",ha)}function zt(e){typeof this._flush=="function"&&!this.destroyed?this._flush((t,n)=>{if(t){e?e(t):this.destroy(t);return}n!=null&&this.push(n),this.push(null),e&&e()}):(this.push(null),e&&e())}function ha(){this._final!==zt&&zt.call(this)}pe.prototype._final=zt;pe.prototype._transform=function(e,t,n){throw new ua("_transform()")};pe.prototype._write=function(e,t,n){const r=this._readableState,a=this._writableState,l=r.length;this._transform(e,t,(d,b)=>{if(d){n(d);return}b!=null&&this.push(b),a.ended||l===r.length||r.length<r.highWaterMark?n():this[Xe]=n})};pe.prototype._read=function(){if(this[Xe]){const e=this[Xe];this[Xe]=null,e()}};const{ObjectSetPrototypeOf:Fr}=V;var jr=We;const un=Wr;Fr(We.prototype,un.prototype);Fr(We,un);function We(e){if(!(this instanceof We))return new We(e);un.call(this,e)}We.prototype._transform=function(e,t,n){n(null,e)};const Ye=Oe,{ArrayIsArray:ba,Promise:ga,SymbolAsyncIterator:pa}=V,lt=Ee,{once:wa}=we,ya=je,Hn=ge(),{aggregateTwoErrors:_a,codes:{ERR_INVALID_ARG_TYPE:Qt,ERR_INVALID_RETURN_VALUE:xt,ERR_MISSING_ARGS:ma,ERR_STREAM_DESTROYED:Sa,ERR_STREAM_PREMATURE_CLOSE:Ea},AbortError:Ra}=ne,{validateFunction:Aa,validateAbortSignal:Ta}=ut,{isIterable:Ie,isReadable:Dt,isReadableNodeStream:it,isNodeStream:qn,isTransformStream:Le,isWebStream:Na,isReadableStream:kt,isReadableEnded:Ia}=ye,Ma=globalThis.AbortController||en().AbortController;let Lt,Wt;function Kn(e,t,n){let r=!1;e.on("close",()=>{r=!0});const a=lt(e,{readable:t,writable:n},l=>{r=!l});return{destroy:l=>{r||(r=!0,ya.destroyer(e,l||new Sa("pipe")))},cleanup:a}}function va(e){return Aa(e[e.length-1],"streams[stream.length - 1]"),e.pop()}function Ft(e){if(Ie(e))return e;if(it(e))return Pa(e);throw new Qt("val",["Readable","Iterable","AsyncIterable"],e)}async function*Pa(e){Wt||(Wt=_t()),yield*Wt.prototype[pa].call(e)}async function et(e,t,n,{end:r}){let a,l=null;const d=u=>{if(u&&(a=u),l){const c=l;l=null,c()}},b=()=>new ga((u,c)=>{a?c(a):l=()=>{a?c(a):u()}});t.on("drain",d);const p=lt(t,{readable:!1},d);try{t.writableNeedDrain&&await b();for await(const u of e)t.write(u)||await b();r&&t.end(),await b(),n()}catch(u){n(a!==u?_a(a,u):u)}finally{p(),t.off("drain",d)}}async function jt(e,t,n,{end:r}){Le(t)&&(t=t.writable);const a=t.getWriter();try{for await(const l of e)await a.ready,a.write(l).catch(()=>{});await a.ready,r&&await a.close(),n()}catch(l){try{await a.abort(l),n(l)}catch(d){n(d)}}}function Oa(...e){return Ur(e,wa(va(e)))}function Ur(e,t,n){if(e.length===1&&ba(e[0])&&(e=e[0]),e.length<2)throw new ma("streams");const r=new Ma,a=r.signal,l=n==null?void 0:n.signal,d=[];Ta(l,"options.signal");function b(){y(new Ra)}l==null||l.addEventListener("abort",b);let p,u;const c=[];let R=0;function I(M){y(M,--R===0)}function y(M,w){if(M&&(!p||p.code==="ERR_STREAM_PREMATURE_CLOSE")&&(p=M),!(!p&&!w)){for(;c.length;)c.shift()(p);l==null||l.removeEventListener("abort",b),r.abort(),w&&(p||d.forEach(C=>C()),Ye.nextTick(t,p,u))}}let h;for(let M=0;M<e.length;M++){const w=e[M],C=M<e.length-1,U=M>0,O=C||(n==null?void 0:n.end)!==!1,H=M===e.length-1;if(qn(w)){let B=function(q){q&&q.name!=="AbortError"&&q.code!=="ERR_STREAM_PREMATURE_CLOSE"&&I(q)};if(O){const{destroy:q,cleanup:j}=Kn(w,C,U);c.push(q),Dt(w)&&H&&d.push(j)}w.on("error",B),Dt(w)&&H&&d.push(()=>{w.removeListener("error",B)})}if(M===0)if(typeof w=="function"){if(h=w({signal:a}),!Ie(h))throw new xt("Iterable, AsyncIterable or Stream","source",h)}else Ie(w)||it(w)||Le(w)?h=w:h=Hn.from(w);else if(typeof w=="function"){if(Le(h)){var x;h=Ft((x=h)===null||x===void 0?void 0:x.readable)}else h=Ft(h);if(h=w(h,{signal:a}),C){if(!Ie(h,!0))throw new xt("AsyncIterable",`transform[${M-1}]`,h)}else{var P;Lt||(Lt=jr);const B=new Lt({objectMode:!0}),q=(P=h)===null||P===void 0?void 0:P.then;if(typeof q=="function")R++,q.call(h,$=>{u=$,$!=null&&B.write($),O&&B.end(),Ye.nextTick(I)},$=>{B.destroy($),Ye.nextTick(I,$)});else if(Ie(h,!0))R++,et(h,B,I,{end:O});else if(kt(h)||Le(h)){const $=h.readable||h;R++,et($,B,I,{end:O})}else throw new xt("AsyncIterable or Promise","destination",h);h=B;const{destroy:j,cleanup:_}=Kn(h,!1,!0);c.push(j),H&&d.push(_)}}else if(qn(w)){if(it(h)){R+=2;const B=$a(h,w,I,{end:O});Dt(w)&&H&&d.push(B)}else if(Le(h)||kt(h)){const B=h.readable||h;R++,et(B,w,I,{end:O})}else if(Ie(h))R++,et(h,w,I,{end:O});else throw new Qt("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],h);h=w}else if(Na(w)){if(it(h))R++,jt(Ft(h),w,I,{end:O});else if(kt(h)||Ie(h))R++,jt(h,w,I,{end:O});else if(Le(h))R++,jt(h.readable,w,I,{end:O});else throw new Qt("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],h);h=w}else h=Hn.from(w)}return(a!=null&&a.aborted||l!=null&&l.aborted)&&Ye.nextTick(b),h}function $a(e,t,n,{end:r}){let a=!1;if(t.on("close",()=>{a||n(new Ea)}),e.pipe(t,{end:!1}),r){let l=function(){a=!0,t.end()};Ia(e)?Ye.nextTick(l):e.once("end",l)}else n();return lt(e,{readable:!0,writable:!1},l=>{const d=e._readableState;l&&l.code==="ERR_STREAM_PREMATURE_CLOSE"&&d&&d.ended&&!d.errored&&!d.errorEmitted?e.once("end",n).once("error",n):n(l)}),lt(t,{readable:!1,writable:!0},n)}var cn={pipelineImpl:Ur,pipeline:Oa};const{pipeline:Ca}=cn,tt=ge(),{destroyer:xa}=je,{isNodeStream:nt,isReadable:Yn,isWritable:Jn,isWebStream:Ut,isTransformStream:Ne,isWritableStream:Xn,isReadableStream:zn}=ye,{AbortError:Da,codes:{ERR_INVALID_ARG_VALUE:Qn,ERR_MISSING_ARGS:ka}}=ne,La=Ee;var Br=function(...t){if(t.length===0)throw new ka("streams");if(t.length===1)return tt.from(t[0]);const n=[...t];if(typeof t[0]=="function"&&(t[0]=tt.from(t[0])),typeof t[t.length-1]=="function"){const y=t.length-1;t[y]=tt.from(t[y])}for(let y=0;y<t.length;++y)if(!(!nt(t[y])&&!Ut(t[y]))){if(y<t.length-1&&!(Yn(t[y])||zn(t[y])||Ne(t[y])))throw new Qn(`streams[${y}]`,n[y],"must be readable");if(y>0&&!(Jn(t[y])||Xn(t[y])||Ne(t[y])))throw new Qn(`streams[${y}]`,n[y],"must be writable")}let r,a,l,d,b;function p(y){const h=d;d=null,h?h(y):y?b.destroy(y):!I&&!R&&b.destroy()}const u=t[0],c=Ca(t,p),R=!!(Jn(u)||Xn(u)||Ne(u)),I=!!(Yn(c)||zn(c)||Ne(c));if(b=new tt({writableObjectMode:!!(u!=null&&u.writableObjectMode),readableObjectMode:!!(c!=null&&c.writableObjectMode),writable:R,readable:I}),R){if(nt(u))b._write=function(h,x,P){u.write(h,x)?P():r=P},b._final=function(h){u.end(),a=h},u.on("drain",function(){if(r){const h=r;r=null,h()}});else if(Ut(u)){const x=(Ne(u)?u.writable:u).getWriter();b._write=async function(P,M,w){try{await x.ready,x.write(P).catch(()=>{}),w()}catch(C){w(C)}},b._final=async function(P){try{await x.ready,x.close().catch(()=>{}),a=P}catch(M){P(M)}}}const y=Ne(c)?c.readable:c;La(y,()=>{if(a){const h=a;a=null,h()}})}if(I){if(nt(c))c.on("readable",function(){if(l){const y=l;l=null,y()}}),c.on("end",function(){b.push(null)}),b._read=function(){for(;;){const y=c.read();if(y===null){l=b._read;return}if(!b.push(y))return}};else if(Ut(c)){const h=(Ne(c)?c.readable:c).getReader();b._read=async function(){for(;;)try{const{value:x,done:P}=await h.read();if(!b.push(x))return;if(P){b.push(null);return}}catch{return}}}}return b._destroy=function(y,h){!y&&d!==null&&(y=new Da),l=null,r=null,a=null,d===null?h(y):(d=h,nt(c)&&xa(c,y))},b};const Gr=globalThis.AbortController||en().AbortController,{codes:{ERR_INVALID_ARG_VALUE:Wa,ERR_INVALID_ARG_TYPE:ze,ERR_MISSING_ARGS:Fa,ERR_OUT_OF_RANGE:ja},AbortError:de}=ne,{validateAbortSignal:$e,validateInteger:Ua,validateObject:Ce}=ut,Ba=V.Symbol("kWeak"),{finished:Ga}=Ee,Va=Br,{addAbortSignalNoValidate:Ha}=yt,{isWritable:qa,isNodeStream:Ka}=ye,{ArrayPrototypePush:Ya,MathFloor:Ja,Number:Xa,NumberIsNaN:za,Promise:Zn,PromiseReject:er,PromisePrototypeThen:Qa,Symbol:Vr}=V,st=Vr("kEmpty"),tr=Vr("kEof");function Za(e,t){if(t!=null&&Ce(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),Ka(e)&&!qa(e))throw new Wa("stream",e,"must be writable");const n=Va(this,e);return t!=null&&t.signal&&Ha(t.signal,n),n}function mt(e,t){if(typeof e!="function")throw new ze("fn",["Function","AsyncFunction"],e);t!=null&&Ce(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal");let n=1;return(t==null?void 0:t.concurrency)!=null&&(n=Ja(t.concurrency)),Ua(n,"concurrency",1),(async function*(){var a,l;const d=new Gr,b=this,p=[],u=d.signal,c={signal:u},R=()=>d.abort();t!=null&&(a=t.signal)!==null&&a!==void 0&&a.aborted&&R(),t==null||(l=t.signal)===null||l===void 0||l.addEventListener("abort",R);let I,y,h=!1;function x(){h=!0}async function P(){try{for await(let C of b){var M;if(h)return;if(u.aborted)throw new de;try{C=e(C,c)}catch(U){C=er(U)}C!==st&&(typeof((M=C)===null||M===void 0?void 0:M.catch)=="function"&&C.catch(x),p.push(C),I&&(I(),I=null),!h&&p.length&&p.length>=n&&await new Zn(U=>{y=U}))}p.push(tr)}catch(C){const U=er(C);Qa(U,void 0,x),p.push(U)}finally{var w;h=!0,I&&(I(),I=null),t==null||(w=t.signal)===null||w===void 0||w.removeEventListener("abort",R)}}P();try{for(;;){for(;p.length>0;){const M=await p[0];if(M===tr)return;if(u.aborted)throw new de;M!==st&&(yield M),p.shift(),y&&(y(),y=null)}await new Zn(M=>{I=M})}}finally{d.abort(),h=!0,y&&(y(),y=null)}}).call(this)}function el(e=void 0){return e!=null&&Ce(e,"options"),(e==null?void 0:e.signal)!=null&&$e(e.signal,"options.signal"),(async function*(){let n=0;for await(const a of this){var r;if(e!=null&&(r=e.signal)!==null&&r!==void 0&&r.aborted)throw new de({cause:e.signal.reason});yield[n++,a]}}).call(this)}async function Hr(e,t=void 0){for await(const n of hn.call(this,e,t))return!0;return!1}async function tl(e,t=void 0){if(typeof e!="function")throw new ze("fn",["Function","AsyncFunction"],e);return!await Hr.call(this,async(...n)=>!await e(...n),t)}async function nl(e,t){for await(const n of hn.call(this,e,t))return n}async function rl(e,t){if(typeof e!="function")throw new ze("fn",["Function","AsyncFunction"],e);async function n(r,a){return await e(r,a),st}for await(const r of mt.call(this,n,t));}function hn(e,t){if(typeof e!="function")throw new ze("fn",["Function","AsyncFunction"],e);async function n(r,a){return await e(r,a)?r:st}return mt.call(this,n,t)}class il extends Fa{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function ol(e,t,n){var r;if(typeof e!="function")throw new ze("reducer",["Function","AsyncFunction"],e);n!=null&&Ce(n,"options"),(n==null?void 0:n.signal)!=null&&$e(n.signal,"options.signal");let a=arguments.length>1;if(n!=null&&(r=n.signal)!==null&&r!==void 0&&r.aborted){const u=new de(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await Ga(this.destroy(u)),u}const l=new Gr,d=l.signal;if(n!=null&&n.signal){const u={once:!0,[Ba]:this};n.signal.addEventListener("abort",()=>l.abort(),u)}let b=!1;try{for await(const u of this){var p;if(b=!0,n!=null&&(p=n.signal)!==null&&p!==void 0&&p.aborted)throw new de;a?t=await e(t,u,{signal:d}):(t=u,a=!0)}if(!b&&!a)throw new il}finally{l.abort()}return t}async function al(e){e!=null&&Ce(e,"options"),(e==null?void 0:e.signal)!=null&&$e(e.signal,"options.signal");const t=[];for await(const r of this){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new de(void 0,{cause:e.signal.reason});Ya(t,r)}return t}function ll(e,t){const n=mt.call(this,e,t);return(async function*(){for await(const a of n)yield*a}).call(this)}function qr(e){if(e=Xa(e),za(e))return 0;if(e<0)throw new ja("number",">= 0",e);return e}function sl(e,t=void 0){return t!=null&&Ce(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),e=qr(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new de;for await(const l of this){var a;if(t!=null&&(a=t.signal)!==null&&a!==void 0&&a.aborted)throw new de;e--<=0&&(yield l)}}).call(this)}function fl(e,t=void 0){return t!=null&&Ce(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),e=qr(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new de;for await(const l of this){var a;if(t!=null&&(a=t.signal)!==null&&a!==void 0&&a.aborted)throw new de;if(e-- >0)yield l;else return}}).call(this)}tn.streamReturningOperators={asIndexedPairs:el,drop:sl,filter:hn,flatMap:ll,map:mt,take:fl,compose:Za};tn.promiseReturningOperators={every:tl,forEach:rl,reduce:ol,toArray:al,some:Hr,find:nl};var Bt,nr;function Kr(){if(nr)return Bt;nr=1;const{ArrayPrototypePop:e,Promise:t}=V,{isIterable:n,isNodeStream:r,isWebStream:a}=ye,{pipelineImpl:l}=cn,{finished:d}=Ee;Yr();function b(...p){return new t((u,c)=>{let R,I;const y=p[p.length-1];if(y&&typeof y=="object"&&!r(y)&&!n(y)&&!a(y)){const h=e(p);R=h.signal,I=h.end}l(p,(h,x)=>{h?c(h):u(x)},{signal:R,end:I})})}return Bt={finished:d,pipeline:b},Bt}var rr;function Yr(){if(rr)return Nt.exports;rr=1;const{Buffer:e}=Pe,{ObjectDefineProperty:t,ObjectKeys:n,ReflectApply:r}=V,{promisify:{custom:a}}=we,{streamReturningOperators:l,promiseReturningOperators:d}=tn,{codes:{ERR_ILLEGAL_CONSTRUCTOR:b}}=ne,p=Br,{pipeline:u}=cn,{destroyer:c}=je,R=Ee,I=Kr(),y=ye,h=Nt.exports=sn.Stream;h.isDisturbed=y.isDisturbed,h.isErrored=y.isErrored,h.isReadable=y.isReadable,h.Readable=_t();for(const P of n(l)){let w=function(...C){if(new.target)throw b();return h.Readable.from(r(M,this,C))};const M=l[P];t(w,"name",{__proto__:null,value:M.name}),t(w,"length",{__proto__:null,value:M.length}),t(h.Readable.prototype,P,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}for(const P of n(d)){let w=function(...C){if(new.target)throw b();return r(M,this,C)};const M=d[P];t(w,"name",{__proto__:null,value:M.name}),t(w,"length",{__proto__:null,value:M.length}),t(h.Readable.prototype,P,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}h.Writable=kr(),h.Duplex=ge(),h.Transform=Wr,h.PassThrough=jr,h.pipeline=u;const{addAbortSignal:x}=yt;return h.addAbortSignal=x,h.finished=R,h.destroy=c,h.compose=p,t(h,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return I}}),t(u,a,{__proto__:null,enumerable:!0,get(){return I.pipeline}}),t(R,a,{__proto__:null,enumerable:!0,get(){return I.finished}}),h.Stream=h,h._isUint8Array=function(M){return M instanceof Uint8Array},h._uint8ArrayToBuffer=function(M){return e.from(M.buffer,M.byteOffset,M.byteLength)},Nt.exports}(function(e){const t=Yr(),n=Kr(),r=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=r,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return n}}),e.exports.Stream=t.Stream,e.exports.default=e.exports})(ai);function ir(e){let t=!1,n=0,r;try{r=window[e],t=!0,n=r.length;const a="__storage_test__";return r.setItem(a,a),r.removeItem(a),!0}catch(a){const l=a;return l&&(l.code===22||l.code===1014||l.name==="QuotaExceededError"||l.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&n!==0}}class dl{constructor(){Z(this,"store",{})}getItem(t){return this.store[t]||null}setItem(t,n){this.store[t]=n}}class ul{constructor(t,n){Z(this,"storage",void 0),Z(this,"_storeKey",void 0),this.storage=n,this._storeKey=t;try{n.getItem(t)||this.resetStore()}catch{}}static getInstance(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){let r;n==="local"&&ir("localStorage")?r=window.localStorage:n==="session"&&ir("sessionStorage")?r=window.sessionStorage:r=new dl,this.instance=new this(t,r)}return this.instance}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const t=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),t}getStore(){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")}get(t){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")[t]}set(t,n){const r=JSON.parse(this.storage.getItem(this._storeKey)||"{}");r[t]=n,this.storage.setItem(this._storeKey,JSON.stringify(r))}}Z(ul,"instance",void 0);Se(Se({},Qr),Zr);const cl=or.getLogger("http-helpers");cl.setLevel(ei.levels.INFO);class hl extends Error{}hl.prototype.name="InvalidTokenError";const bl={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},gl={EIP155:"eip155",SOLANA:"solana",XRPL:"xrpl",MULTICHAIN:"multichain"};class Qe extends ti{constructor(t,n){super(n),Z(this,"code",void 0),Z(this,"message",void 0),this.code=t,this.message=n||"",Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class J extends Qe{constructor(t,n){super(t,n),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new J(t,`${J.messages[t]}, ${n}`)}static notFound(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5001,t)}static notInstalled(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5002,t)}static notReady(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5003,t)}static windowBlocked(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5004,t)}static windowClosed(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5005,t)}static incompatibleChainNameSpace(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5006,t)}static duplicateAdapterError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5007,t)}static invalidProviderConfigError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5008,t)}static providerNotReadyError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5009,t)}static rpcConnectionError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5010,t)}static invalidParams(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5011,t)}static invalidNetwork(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return J.fromCode(5013,t)}}Z(J,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class X extends Qe{constructor(t,n){super(t,n),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new X(t,`${X.messages[t]}. ${n}`)}static connectionError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5111,t)}static disconnectionError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5112,t)}static notConnectedError(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5113,t)}static popupClosed(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5114,t)}static mfaEnabled(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5115,t)}static chainConfigNotAdded(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5116,t)}static unsupportedOperation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5117,t)}static coreKitKeyNotFound(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5118,t)}static userNotLoggedIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return X.fromCode(5119,t)}}Z(X,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class ae extends Qe{constructor(t,n){super(t,n),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new ae(t,`${ae.messages[t]}, ${n}`)}static chainIDNotAllowed(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5201,t)}static operationNotAllowed(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5202,t)}static chainNamespaceNotAllowed(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5203,t)}}Z(ae,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});class bn extends Qe{constructor(t,n){super(t,n),Object.defineProperty(this,"name",{value:"WalletProviderError"})}static fromCode(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new ae(t,`${bn.messages[t]}, ${n}`)}static invalidRequestArgs(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5301,t)}static invalidRequestMethod(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5302,t)}static invalidRequestParams(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ae.fromCode(5303,t)}}Z(bn,"messages",{5e3:"Custom",5301:"Expected a single, non-array, object argument.",5302:"'args.method' must be a non-empty string.",5303:"'args.params' must be an object or array if provided."});const ft={OPENLOGIN:"openlogin",WALLET_CONNECT_V2:"wallet-connect-v2"},Je=Se({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLFLARE:"solflare",SLOPE:"slope"},ft),ot=Se({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},ft),rt=Se(Se({},ot),Je);ft.OPENLOGIN+"",ft.WALLET_CONNECT_V2+"",Je.TORUS_SOLANA+"",Je.PHANTOM+"",Je.SOLFLARE+"",Je.SLOPE+"",ot.TORUS_EVM+"",ot.METAMASK+"",ot.COINBASE+"";const pl={EXTERNAL:"external",IN_APP:"in_app"},se={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},Ke=Se(Se({},se),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});var wl=or.getLogger("web3auth-logger");class El extends ni{constructor(){super(...arguments),Z(this,"adapterNamespace",gl.EIP155),Z(this,"currentChainNamespace",bl.EIP155),Z(this,"type",pl.EXTERNAL),Z(this,"name",rt.METAMASK),Z(this,"status",se.NOT_READY),Z(this,"metamaskProvider",null)}get provider(){return this.status!==se.NOT_READY&&this.metamaskProvider?this.metamaskProvider:null}set provider(t){throw new Error("Not implemented")}async init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(await super.init(t),super.checkInitializationRequirements(),this.metamaskProvider=await oi({mustBeMetaMask:!0,silent:!0,timeout:1e3}),!this.metamaskProvider)throw J.notInstalled("Metamask extension is not installed");this.status=se.READY,this.emit(Ke.READY,rt.METAMASK);try{wl.debug("initializing metamask adapter"),t.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(n){this.emit(Ke.ERRORED,n)}}async connect(){if(super.checkConnectionRequirements(),!this.metamaskProvider)throw X.notConnectedError("Not able to connect with metamask");const{ethereum:t}=window,n="isPhantom"in t;if(t&&t.isMetaMask&&n){if(t.providers&&t.providers.length>0){const r=t.providers.find(a=>a.isMetaMask&&!a.overrideIsMetaMask);r&&t.setProvider(r)}}else if(t&&(t.providers||[]).length>0){const r=t.providers.find(a=>a.isMetaMask);r&&t.setSelectedProvider(r)}this.status=se.CONNECTING,this.emit(Ke.CONNECTING,{adapter:rt.METAMASK});try{await this.metamaskProvider.request({method:"eth_requestAccounts"});const{chainId:r}=this.metamaskProvider;if(r!==this.chainConfig.chainId&&(await this.addChain(this.chainConfig,!0),await this.switchChain(this.chainConfig,!0)),this.status=se.CONNECTED,!this.provider)throw X.notConnectedError("Failed to connect with provider");const a=()=>{var l;this.disconnect(),(l=this.provider)===null||l===void 0||l.removeListener("disconnect",a)};return this.provider.on("disconnect",a),this.emit(Ke.CONNECTED,{adapter:rt.METAMASK,reconnected:this.rehydrated}),this.provider}catch(r){throw this.status=se.READY,this.rehydrated=!1,this.emit(Ke.ERRORED,r),r instanceof Qe?r:X.connectionError("Failed to login with metamask wallet")}}async disconnect(){var t;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession(),(t=this.provider)===null||t===void 0||t.removeAllListeners(),n.cleanup?(this.status=se.NOT_READY,this.metamaskProvider=null):this.status=se.READY,await super.disconnect()}async getUserInfo(){if(this.status!==se.CONNECTED)throw X.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async addChain(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(t,r),await((n=this.metamaskProvider)===null||n===void 0?void 0:n.request({method:"wallet_addEthereumChain",params:[{chainId:t.chainId,chainName:t.displayName,rpcUrls:[t.rpcTarget],blockExplorerUrls:[t.blockExplorer],nativeCurrency:{name:t.tickerName,symbol:t.ticker,decimals:t.decimals||18}}]})),this.addChainConfig(t)}async switchChain(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(t,r),await((n=this.metamaskProvider)===null||n===void 0?void 0:n.request({method:"wallet_switchEthereumChain",params:[{chainId:t.chainId}]})),this.setAdapterSettings({chainConfig:this.getChainConfig(t.chainId)})}}export{El as MetamaskAdapter};
