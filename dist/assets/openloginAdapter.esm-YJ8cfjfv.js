import{l as at,a as Nt,aQ as Ct,i as A,aR as st,aS as fo,aT as ho,d as I,_ as P,T as po,j as Gi,m as lt,C as Yi,e as Ot,aU as An,b as He,c as Ve,s as go,r as gr}from"./index-L3ozMu8u.js";const Ee=Object.create(null);Ee.open="0";Ee.close="1";Ee.ping="2";Ee.pong="3";Ee.message="4";Ee.upgrade="5";Ee.noop="6";const Kt=Object.create(null);Object.keys(Ee).forEach(t=>{Kt[Ee[t]]=t});const Qn={type:"error",data:"parser error"},Ji=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",zi=typeof ArrayBuffer=="function",Xi=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,yr=({type:t,data:e},n,r)=>Ji&&e instanceof Blob?n?r(e):Wr(e,r):zi&&(e instanceof ArrayBuffer||Xi(e))?n?r(e):Wr(new Blob([e]),r):r(Ee[t]+(e||"")),Wr=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function Kr(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Tn;function yo(t,e){if(Ji&&t.data instanceof Blob)return t.data.arrayBuffer().then(Kr).then(e);if(zi&&(t.data instanceof ArrayBuffer||Xi(t.data)))return e(Kr(t.data));yr(t,!1,n=>{Tn||(Tn=new TextEncoder),e(Tn.encode(n))})}const jr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_t=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<jr.length;t++)_t[jr.charCodeAt(t)]=t;const bo=t=>{let e=t.length*.75,n=t.length,r,i=0,s,o,c,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const f=new ArrayBuffer(e),p=new Uint8Array(f);for(r=0;r<n;r+=4)s=_t[t.charCodeAt(r)],o=_t[t.charCodeAt(r+1)],c=_t[t.charCodeAt(r+2)],u=_t[t.charCodeAt(r+3)],p[i++]=s<<2|o>>4,p[i++]=(o&15)<<4|c>>2,p[i++]=(c&3)<<6|u&63;return f},mo=typeof ArrayBuffer=="function",br=(t,e)=>{if(typeof t!="string")return{type:"message",data:Qi(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:wo(t.substring(1),e)}:Kt[n]?t.length>1?{type:Kt[n],data:t.substring(1)}:{type:Kt[n]}:Qn},wo=(t,e)=>{if(mo){const n=bo(t);return Qi(n,e)}else return{base64:!0,data:t}},Qi=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Zi="",_o=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((s,o)=>{yr(s,!1,c=>{r[o]=c,++i===n&&e(r.join(Zi))})})},So=(t,e)=>{const n=t.split(Zi),r=[];for(let i=0;i<n.length;i++){const s=br(n[i],e);if(r.push(s),s.type==="error")break}return r};function Eo(){return new TransformStream({transform(t,e){yo(t,n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(n)})}})}let Nn;function Pt(t){return t.reduce((e,n)=>e+n.length,0)}function xt(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)n[i]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function Ro(t,e){Nn||(Nn=new TextDecoder);const n=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,c){for(n.push(o);;){if(r===0){if(Pt(n)<1)break;const u=xt(n,1);s=(u[0]&128)===128,i=u[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(Pt(n)<2)break;const u=xt(n,2);i=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),r=3}else if(r===2){if(Pt(n)<8)break;const u=xt(n,8),f=new DataView(u.buffer,u.byteOffset,u.length),p=f.getUint32(0);if(p>Math.pow(2,21)-1){c.enqueue(Qn);break}i=p*Math.pow(2,32)+f.getUint32(4),r=3}else{if(Pt(n)<i)break;const u=xt(n,i);c.enqueue(br(s?u:Nn.decode(u),e)),r=0}if(i===0||i>t){c.enqueue(Qn);break}}}})}const es=4;function X(t){if(t)return vo(t)}function vo(t){for(var e in X.prototype)t[e]=X.prototype[e];return t}X.prototype.on=X.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};X.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};X.prototype.off=X.prototype.removeListener=X.prototype.removeAllListeners=X.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};X.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};X.prototype.emitReserved=X.prototype.emit;X.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};X.prototype.hasListeners=function(t){return!!this.listeners(t).length};const de=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function ts(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const Ao=de.setTimeout,To=de.clearTimeout;function nn(t,e){e.useNativeTimers?(t.setTimeoutFn=Ao.bind(de),t.clearTimeoutFn=To.bind(de)):(t.setTimeoutFn=de.setTimeout.bind(de),t.clearTimeoutFn=de.clearTimeout.bind(de))}const No=1.33;function Co(t){return typeof t=="string"?Oo(t):Math.ceil((t.byteLength||t.size)*No)}function Oo(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function ko(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Io(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class Po extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class mr extends X{constructor(e){super(),this.writable=!1,nn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new Po(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=br(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=ko(e);return n.length?"?"+n:""}}const ns="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Zn=64,xo={};let qr=0,Lt=0,Hr;function Vr(t){let e="";do e=ns[t%Zn]+e,t=Math.floor(t/Zn);while(t>0);return e}function rs(){const t=Vr(+new Date);return t!==Hr?(qr=0,Hr=t):t+"."+Vr(qr++)}for(;Lt<Zn;Lt++)xo[ns[Lt]]=Lt;let is=!1;try{is=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Lo=is;function ss(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Lo))return new XMLHttpRequest}catch{}if(!e)try{return new de[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Mo(){}const Do=function(){return new ss({xdomain:!1}).responseType!=null}();class $o extends mr{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const n=e&&e.forceBase64;this.supportsBinary=Do&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};So(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,_o(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=rs()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new _e(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class _e extends X{constructor(e,n){super(),nn(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=n.data!==void 0?n.data:null,this.create()}create(){var e;const n=ts(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new ss(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=_e.requestsCount++,_e.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Mo,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete _e.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}_e.requestsCount=0;_e.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Gr);else if(typeof addEventListener=="function"){const t="onpagehide"in de?"pagehide":"unload";addEventListener(t,Gr,!1)}}function Gr(){for(let t in _e.requests)_e.requests.hasOwnProperty(t)&&_e.requests[t].abort()}const wr=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),Mt=de.WebSocket||de.MozWebSocket,Yr=!0,Bo="arraybuffer",Jr=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Uo extends mr{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=Jr?{}:ts(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Yr&&!Jr?n?new Mt(e,n):new Mt(e):new Mt(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;yr(r,this.supportsBinary,s=>{const o={};try{Yr&&this.ws.send(s)}catch{}i&&wr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=rs()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}check(){return!!Mt}}class Fo extends mr{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const n=Ro(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(n).getReader(),i=Eo();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const s=()=>{r.read().then(({done:c,value:u})=>{c||(this.onPacket(u),s())}).catch(c=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;this.writer.write(r).then(()=>{i&&wr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Wo={websocket:Uo,webtransport:Fo,polling:$o},Ko=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function er(t){if(t.length>2e3)throw"URI too long";const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Ko.exec(t||""),s={},o=14;for(;o--;)s[jo[o]]=i[o]||"";return n!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=qo(s,s.path),s.queryKey=Ho(s,s.query),s}function qo(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Ho(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(n[i]=s)}),n}let os=class Qe extends X{constructor(e,n={}){super(),this.binaryType=Bo,this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=er(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=er(n.host).host),nn(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Io(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=es,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Wo[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;Qe.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",w=>{if(!r)if(w.type==="pong"&&w.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Qe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const v=new Error("probe error");v.transport=n.name,this.emitReserved("upgradeError",v)}}))};function s(){r||(r=!0,p(),n.close(),n=null)}const o=w=>{const v=new Error("probe error: "+w);v.transport=n.name,s(),this.emitReserved("upgradeError",v)};function c(){o("transport closed")}function u(){o("socket closed")}function f(w){n&&w.name!==n.name&&s()}const p=()=>{n.removeListener("open",i),n.removeListener("error",o),n.removeListener("close",c),this.off("close",u),this.off("upgrading",f)};n.once("open",i),n.once("error",o),n.once("close",c),this.once("close",u),this.once("upgrading",f),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",Qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Co(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:n,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Qe.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}};os.protocol=es;function Vo(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=er(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}const Go=typeof ArrayBuffer=="function",Yo=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,as=Object.prototype.toString,Jo=typeof Blob=="function"||typeof Blob<"u"&&as.call(Blob)==="[object BlobConstructor]",zo=typeof File=="function"||typeof File<"u"&&as.call(File)==="[object FileConstructor]";function _r(t){return Go&&(t instanceof ArrayBuffer||Yo(t))||Jo&&t instanceof Blob||zo&&t instanceof File}function jt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(jt(t[n]))return!0;return!1}if(_r(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return jt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&jt(t[n]))return!0;return!1}function Xo(t){const e=[],n=t.data,r=t;return r.data=tr(n,e),r.attachments=e.length,{packet:r,buffers:e}}function tr(t,e){if(!t)return t;if(_r(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=tr(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=tr(t[r],e));return n}return t}function Qo(t,e){return t.data=nr(t.data,e),delete t.attachments,t}function nr(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=nr(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=nr(t[n],e));return t}const Zo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ea=5;var $;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})($||($={}));class ta{constructor(e){this.replacer=e}encode(e){return(e.type===$.EVENT||e.type===$.ACK)&&jt(e)?this.encodeAsBinary({type:e.type===$.EVENT?$.BINARY_EVENT:$.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===$.BINARY_EVENT||e.type===$.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=Xo(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function zr(t){return Object.prototype.toString.call(t)==="[object Object]"}class Sr extends X{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===$.BINARY_EVENT;r||n.type===$.BINARY_ACK?(n.type=r?$.EVENT:$.ACK,this.reconstructor=new na(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(_r(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if($[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===$.BINARY_EVENT||r.type===$.BINARY_ACK){const s=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(s,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(s,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const s=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}r.id=Number(e.substring(s,n+1))}if(e.charAt(++n)){const s=this.tryParse(e.substr(n));if(Sr.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case $.CONNECT:return zr(n);case $.DISCONNECT:return n===void 0;case $.CONNECT_ERROR:return typeof n=="string"||zr(n);case $.EVENT:case $.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Zo.indexOf(n[0])===-1);case $.ACK:case $.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class na{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Qo(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ra=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Sr,Encoder:ta,get PacketType(){return $},protocol:ea},Symbol.toStringTag,{value:"Module"}));function be(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const ia=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ls extends X{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[be(e,"open",this.onopen.bind(this)),be(e,"packet",this.onpacket.bind(this)),be(e,"error",this.onerror.bind(this)),be(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(ia.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:$.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const o=this.ids++,c=n.pop();this._registerAckCallback(o,c),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),n.apply(this,[null,...o])}}emitWithAck(e,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{n.push((o,c)=>r?o?s(o):i(c):i(o)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:$.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case $.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $.EVENT:case $.BINARY_EVENT:this.onevent(e);break;case $.ACK:case $.BINARY_ACK:this.onack(e);break;case $.DISCONNECT:this.ondisconnect();break;case $.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:$.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function ct(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ct.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};ct.prototype.reset=function(){this.attempts=0};ct.prototype.setMin=function(t){this.ms=t};ct.prototype.setMax=function(t){this.max=t};ct.prototype.setJitter=function(t){this.jitter=t};class rr extends X{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,nn(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ct({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||ra;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new os(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=be(n,"open",function(){r.onopen(),e&&e()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},o=be(n,"error",s);if(this._timeout!==!1){const c=this._timeout,u=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),n.close()},c);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(be(e,"ping",this.onping.bind(this)),be(e,"data",this.ondata.bind(this)),be(e,"error",this.onerror.bind(this)),be(e,"close",this.onclose.bind(this)),be(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){wr(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new ls(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const mt={};function qt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Vo(t,e.path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=mt[i]&&s in mt[i].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let u;return c?u=new rr(r,e):(mt[i]||(mt[i]=new rr(r,e)),u=mt[i]),n.query&&!e.query&&(e.query=n.queryKey),u.socket(n.path,e)}Object.assign(qt,{Manager:rr,Socket:ls,io:qt,connect:qt});const sa=at.getLogger("http-helpers");sa.setLevel(Nt.levels.INFO);var Dt={},Cn,Xr;function oa(){if(Xr)return Cn;Xr=1;var t,e,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},r;function i(y){throw{name:"SyntaxError",message:y,at:t,text:r}}function s(y){return y&&y!==e&&i("Expected '"+y+"' instead of '"+e+"'"),e=r.charAt(t),t+=1,e}function o(){var y,g="";for(e==="-"&&(g="-",s("-"));e>="0"&&e<="9";)g+=e,s();if(e===".")for(g+=".";s()&&e>="0"&&e<="9";)g+=e;if(e==="e"||e==="E")for(g+=e,s(),(e==="-"||e==="+")&&(g+=e,s());e>="0"&&e<="9";)g+=e,s();return y=Number(g),isFinite(y)||i("Bad number"),y}function c(){var y,g,T="",M;if(e==='"')for(;s();){if(e==='"')return s(),T;if(e==="\\")if(s(),e==="u"){for(M=0,g=0;g<4&&(y=parseInt(s(),16),!!isFinite(y));g+=1)M=M*16+y;T+=String.fromCharCode(M)}else if(typeof n[e]=="string")T+=n[e];else break;else T+=e}i("Bad string")}function u(){for(;e&&e<=" ";)s()}function f(){switch(e){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;default:i("Unexpected '"+e+"'")}}function p(){var y=[];if(e==="["){if(s("["),u(),e==="]")return s("]"),y;for(;e;){if(y.push(v()),u(),e==="]")return s("]"),y;s(","),u()}}i("Bad array")}function w(){var y,g={};if(e==="{"){if(s("{"),u(),e==="}")return s("}"),g;for(;e;){if(y=c(),u(),s(":"),Object.prototype.hasOwnProperty.call(g,y)&&i('Duplicate key "'+y+'"'),g[y]=v(),u(),e==="}")return s("}"),g;s(","),u()}}i("Bad object")}function v(){switch(u(),e){case"{":return w();case"[":return p();case'"':return c();case"-":return o();default:return e>="0"&&e<="9"?o():f()}}return Cn=function(y,g){var T;return r=y,t=0,e=" ",T=v(),u(),e&&i("Syntax error"),typeof g=="function"?function M(C,m){var D,j,x=C[m];if(x&&typeof x=="object")for(D in v)Object.prototype.hasOwnProperty.call(x,D)&&(j=M(x,D),typeof j>"u"?delete x[D]:x[D]=j);return g.call(C,m,x)}({"":T},""):T},Cn}var On,Qr;function aa(){if(Qr)return On;Qr=1;var t=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,n,r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;function s(c){return t.lastIndex=0,t.test(c)?'"'+c.replace(t,function(u){var f=r[u];return typeof f=="string"?f:"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function o(c,u){var f,p,w,v,y=e,g,T=u[c];switch(T&&typeof T=="object"&&typeof T.toJSON=="function"&&(T=T.toJSON(c)),typeof i=="function"&&(T=i.call(u,c,T)),typeof T){case"string":return s(T);case"number":return isFinite(T)?String(T):"null";case"boolean":case"null":return String(T);case"object":if(!T)return"null";if(e+=n,g=[],Object.prototype.toString.apply(T)==="[object Array]"){for(v=T.length,f=0;f<v;f+=1)g[f]=o(f,T)||"null";return w=g.length===0?"[]":e?`[
`+e+g.join(`,
`+e)+`
`+y+"]":"["+g.join(",")+"]",e=y,w}if(i&&typeof i=="object")for(v=i.length,f=0;f<v;f+=1)p=i[f],typeof p=="string"&&(w=o(p,T),w&&g.push(s(p)+(e?": ":":")+w));else for(p in T)Object.prototype.hasOwnProperty.call(T,p)&&(w=o(p,T),w&&g.push(s(p)+(e?": ":":")+w));return w=g.length===0?"{}":e?`{
`+e+g.join(`,
`+e)+`
`+y+"}":"{"+g.join(",")+"}",e=y,w}}return On=function(c,u,f){var p;if(e="",n="",typeof f=="number")for(p=0;p<f;p+=1)n+=" ";else typeof f=="string"&&(n=f);if(i=u,u&&typeof u!="function"&&(typeof u!="object"||typeof u.length!="number"))throw new Error("JSON.stringify");return o("",{"":c})},On}var Zr;function la(){return Zr||(Zr=1,Dt.parse=oa(),Dt.stringify=aa()),Dt}(typeof JSON<"u"?JSON:la()).stringify;const At=new Ct.ec("secp256k1"),Yt=A.global.crypto||A.global.msCrypto||{},Me=Yt.subtle||Yt.webkitSubtle,ca=A.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),ua=A.Buffer.alloc(32,0);function ae(t,e){if(!t)throw new Error(e||"Assertion failed")}function fa(t){return A.Buffer.isBuffer(t)&&t.length===32}function rn(t){return fa(t)?t.compare(ua)>0&&t.compare(ca)<0:!1}function da(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function kn(t){const e=new Uint8Array(t);return typeof Yt.getRandomValues>"u"?A.Buffer.from(st.randomBytes(t)):(Yt.getRandomValues(e),A.Buffer.from(e))}async function cs(t){if(Me){const r=await Me.digest("SHA-512",t);return new Uint8Array(r)}const n=st.createHash("sha512").update(t).digest();return new Uint8Array(n)}function us(t){return async function(e,n,r){if(Me){const i={name:"AES-CBC"},s=await Me.importKey("raw",n,i,!1,[t]),o={name:"AES-CBC",iv:e},c=await Me[t](o,s,r);return A.Buffer.from(new Uint8Array(c))}else if(t==="encrypt"){const i=st.createCipheriv("aes-256-cbc",n,e),s=i.update(r),o=i.final();return A.Buffer.concat([s,o])}else if(t==="decrypt"){const i=st.createDecipheriv("aes-256-cbc",n,e),s=i.update(r),o=i.final();return A.Buffer.concat([s,o])}throw new Error(`Unsupported operation: ${t}`)}}const ha=us("encrypt"),pa=us("decrypt");async function fs(t,e){if(Me){const i={name:"HMAC",hash:{name:"SHA-256"}},s=await Me.importKey("raw",new Uint8Array(t),i,!1,["sign","verify"]),o=await Me.sign("HMAC",s,e);return A.Buffer.from(new Uint8Array(o))}const n=st.createHmac("sha256",A.Buffer.from(t));return n.update(e),n.digest()}async function ga(t,e,n){const r=await fs(t,e);return da(r,n)}const ds=function(t){return ae(t.length===32,"Bad private key"),ae(rn(t),"Bad private key"),A.Buffer.from(At.keyFromPrivate(t).getPublic("array"))},ya=async function(t,e){ae(A.Buffer.isBuffer(t),"Bad private key"),ae(A.Buffer.isBuffer(e),"Bad public key"),ae(t.length===32,"Bad private key"),ae(rn(t),"Bad private key"),ae(e.length===65||e.length===33,"Bad public key"),e.length===65&&ae(e[0]===4,"Bad public key"),e.length===33&&ae(e[0]===2||e[0]===3,"Bad public key");const n=At.keyFromPrivate(t),r=At.keyFromPublic(e),i=n.derive(r.getPublic());return A.Buffer.from(i.toArray())},hs=ya,ba=async function(t,e){ae(A.Buffer.isBuffer(t),"Bad private key"),ae(A.Buffer.isBuffer(e),"Bad public key"),ae(t.length===32,"Bad private key"),ae(rn(t),"Bad private key"),ae(e.length===65||e.length===33,"Bad public key"),e.length===65&&ae(e[0]===4,"Bad public key"),e.length===33&&ae(e[0]===2||e[0]===3,"Bad public key");const n=At.keyFromPrivate(t),r=At.keyFromPublic(e),i=n.derive(r.getPublic());return A.Buffer.from(i.toString(16,64),"hex")},ma=async function(t,e,n){n=n||{};let r=n.ephemPrivateKey||kn(32);for(;!rn(r);)r=n.ephemPrivateKey||kn(32);const i=ds(r),s=await hs(r,t),o=await cs(s),c=n.iv||kn(16),u=o.slice(0,32),f=o.slice(32),w=await ha(c,A.Buffer.from(u),e),v=A.Buffer.concat([c,i,w]),y=await fs(A.Buffer.from(f),v);return{iv:c,ephemPublicKey:i,ciphertext:w,mac:y}},ps=async function(t,e,n){const r=n??!1,s=await(r?ba:hs)(t,e.ephemPublicKey),o=await cs(s),c=o.slice(0,32),u=o.slice(32),f=A.Buffer.concat([e.iv,e.ephemPublicKey,e.ciphertext]),p=await ga(A.Buffer.from(u),f,e.mac);if(!p&&r===!1)return ps(t,e,!0);if(!p&&r===!0)throw new Error("bad MAC after trying padded");const w=await pa(e.iv,A.Buffer.from(c),e.ciphertext);return A.Buffer.from(new Uint8Array(w))};function rt(t){return A.Buffer.from(fo(t))}const wa=new Ct.ec("secp256k1");function _a(t){return{iv:A.Buffer.from(t.iv,"hex"),ephemPublicKey:A.Buffer.from(t.ephemPublicKey,"hex"),ciphertext:A.Buffer.from(t.ciphertext,"hex"),mac:A.Buffer.from(t.mac,"hex")}}function Sa(t){return{iv:A.Buffer.from(t.iv).toString("hex"),ephemPublicKey:A.Buffer.from(t.ephemPublicKey).toString("hex"),ciphertext:A.Buffer.from(t.ciphertext).toString("hex"),mac:A.Buffer.from(t.mac).toString("hex")}}async function Ht(t,e){const n=JSON.stringify(e),r=A.Buffer.from(n,"utf-8"),i=await ma(ds(A.Buffer.from(t,"hex")),r),s=Sa(i);return JSON.stringify(s)}async function gs(t,e){const n=JSON.parse(e),r=_a(n),i=wa.keyFromPrivate(t),o=(await ps(A.Buffer.from(i.getPrivate().toString("hex",64),"hex"),r)).toString("utf-8");return JSON.parse(o)}const sn=ho;function Ea(t){return sn.encode(t)}function In(t){return sn.decode(t)}function Ef(t){return JSON.parse(sn.decode(t))}function ei(t){return sn.encode(JSON.stringify(t))}function ti(t){let e=!1,n=0,r;try{r=window[t],e=!0,n=r.length;const i="__storage_test__";return r.setItem(i,i),r.removeItem(i),!0}catch(i){const s=i;return s&&(s.code===22||s.code===1014||s.name==="QuotaExceededError"||s.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&n!==0}}class Ra{constructor(){I(this,"store",{})}getItem(e){return this.store[e]||null}setItem(e,n){this.store[e]=n}}class ys{constructor(e,n){I(this,"storage",void 0),I(this,"_storeKey",void 0),this.storage=n,this._storeKey=e;try{n.getItem(e)||this.resetStore()}catch{}}static getInstance(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){let r;n==="local"&&ti("localStorage")?r=window.localStorage:n==="session"&&ti("sessionStorage")?r=window.sessionStorage:r=new Ra,this.instance=new this(e,r)}return this.instance}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")}get(e){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")[e]}set(e,n){const r=JSON.parse(this.storage.getItem(this._storeKey)||"{}");r[e]=n,this.storage.setItem(this._storeKey,JSON.stringify(r))}}I(ys,"instance",void 0);const Rf="openlogin_store",Ke={POPUP:"popup",REDIRECT:"redirect"},it=P(P({},po),Gi),ni={SECP256K1:"secp256k1",ED25519:"ed25519"},ri={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless",SMS_PASSWORDLESS:"sms_passwordless",WEBAUTHN:"webauthn",JWT:"jwt"},vf={DEFAULT:"default",OPTIONAL:"optional",MANDATORY:"mandatory",NONE:"none"},Pn={LOGIN:"login",ENABLE_MFA:"enable_mfa",MODIFY_MFA:"modify_mfa"},we={PRODUCTION:"production",DEVELOPMENT:"development",STAGING:"staging",TESTING:"testing"},Af={en:"en",ja:"ja",ko:"ko",de:"de",zh:"zh",es:"es",fr:"fr",pt:"pt",nl:"nl"},Tf={light:"light",dark:"dark",auto:"auto"},Nf={DEVICE:"deviceShareFactor",BACKUP_SHARE:"backUpShareFactor",SOCIAL_BACKUP:"socialBackupFactor",PASSWORD:"passwordFactor"},Jt=at.getLogger("http-helpers");Jt.setLevel(Nt.levels.INFO);let va="torus-default";const Aa="x-api-key";async function on(t,e){let n=null;try{n=new URL(t)}catch{}return fetch(t,e)}function an(){const t={};return t[Aa]=va,t}function ln(t){Jt.info(`Response: ${t.status} ${t.statusText}`),Jt.info(`Url: ${t.url}`)}function Ta(t){Jt.info(`Request tracing with traceID=${t.headers.get("x-web3-correlation-id")}`)}const Na=(t,e)=>{const n=new Promise((r,i)=>{const s=setTimeout(()=>{clearTimeout(s),i(new Error(`Timed out in ${t}ms`))},t)});return Promise.race([e,n])},Ca=async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r={mode:"cors",headers:{}};n.useAPIKey&&(r.headers=P(P({},r.headers),an()));const i=lt(r,e,{method:"GET"}),s=await on(t,i);if(s.ok){const o=s.headers.get("content-type");return o!=null&&o.includes("application/json")?s.json():s.text()}throw ln(s),s},Oa=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=P(P({},i.headers),an()));const s=lt(i,n,{method:"POST"});return r.isUrlEncodedData?(s.body=e,s.headers["Content-Type"]==="application/json; charset=utf-8"&&delete s.headers["Content-Type"]):s.body=JSON.stringify(e),Na(r.timeout||6e4,on(t,s).then(o=>{if(r.logTracingHeader&&Ta(o),o.ok){const c=o.headers.get("content-type");return c!=null&&c.includes("application/json")?o.json():o.text()}throw ln(o),o}))},ka=async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=P(P({},i.headers),an()));const s=lt(i,n,{method:"PATCH"});r.isUrlEncodedData?(s.body=e,s.headers["Content-Type"]==="application/json; charset=utf-8"&&delete s.headers["Content-Type"]):s.body=JSON.stringify(e);const o=await on(t,s);if(o.ok){const c=o.headers.get("content-type");return c!=null&&c.includes("application/json")?o.json():o.text()}throw ln(o),o},Ia=async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=P(P({},i.headers),an()));const s=lt(i,n,{method:"PUT"});r.isUrlEncodedData?(s.body=e,s.headers["Content-Type"]==="application/json; charset=utf-8"&&delete s.headers["Content-Type"]):s.body=JSON.stringify(e);const o=await on(t,s);if(o.ok){const c=o.headers.get("content-type");return c!=null&&c.includes("application/json")?o.json():o.text()}throw ln(o),o};class Pa{constructor(){I(this,"sessionId",void 0)}checkSessionParams(){if(!this.sessionId)throw new Error("Session id is required");this.sessionId=this.sessionId.padStart(64,"0")}request(e){let{method:n="GET",url:r,data:i={},headers:s={}}=e;const o={headers:s};switch(n){case"GET":return Ca(r,o);case"POST":return Oa(r,i,o);case"PUT":return Ia(r,i,o);case"PATCH":return ka(r,i,o)}throw new Error("Invalid method type")}}const bs=new Ct.ec("secp256k1"),zt=A.global.crypto||A.global.msCrypto||{};zt.subtle||zt.webkitSubtle;const xa=A.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),La=A.Buffer.alloc(32,0);function tt(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ma(t){return A.Buffer.isBuffer(t)&&t.length===32}function Er(t){return Ma(t)?t.compare(La)>0&&t.compare(xa)<0:!1}function ii(t){const e=new Uint8Array(t);return typeof zt.getRandomValues>"u"?A.Buffer.from(st.randomBytes(t)):(zt.getRandomValues(e),A.Buffer.from(e))}const Da=function(){let t=ii(32);for(;!Er(t);)t=ii(32);return t},$t=function(t){return tt(t.length===32,"Bad private key"),tt(Er(t),"Bad private key"),A.Buffer.from(bs.keyFromPrivate(t).getPublic("array"))},xn=async function(t,e){return tt(t.length===32,"Bad private key"),tt(Er(t),"Bad private key"),tt(e.length>0,"Message should not be empty"),tt(e.length<=32,"Message is too long"),A.Buffer.from(bs.sign(e,t,{canonical:!0}).toDER())},$a=86400;class Ln extends Pa{constructor(){let{sessionServerBaseUrl:e,sessionNamespace:n,sessionTime:r,sessionId:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),I(this,"sessionServerBaseUrl","https://broadcast-server.tor.us"),I(this,"sessionNamespace",void 0),I(this,"sessionTime",$a),I(this,"sessionId",""),e&&(this.sessionServerBaseUrl=e),n&&(this.sessionNamespace=n),r&&(this.sessionTime=r),i&&(this.sessionId=i.padStart(64,"0"))}static generateRandomSessionKey(){return Da().toString("hex").padStart(64,"0")}async createSession(e){super.checkSessionParams();const n=A.Buffer.from(this.sessionId,"hex"),r=$t(n).toString("hex"),i=await Ht(this.sessionId,e),s=(await xn(n,rt(A.Buffer.from(i,"utf8")))).toString("hex"),o={key:r,data:i,signature:s,namespace:this.sessionNamespace,timeout:this.sessionTime};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/store/set`,data:o}),this.sessionId}async authorizeSession(){super.checkSessionParams();const e=$t(A.Buffer.from(this.sessionId,"hex")).toString("hex"),n=new URL(`${this.sessionServerBaseUrl}/store/get`);n.searchParams.append("key",e),this.sessionNamespace&&n.searchParams.append("namespace",this.sessionNamespace);const r=await super.request({url:n.toString()});if(!r.message)throw new Error("Session Expired or Invalid public key");const i=await gs(this.sessionId,r.message);if(i.error)throw new Error("There was an error decrypting data.");return i}async updateSession(e){super.checkSessionParams();const n=A.Buffer.from(this.sessionId,"hex"),r=$t(n).toString("hex"),i=await Ht(this.sessionId,e),s=(await xn(n,rt(A.Buffer.from(i,"utf8")))).toString("hex"),o={key:r,data:i,signature:s,namespace:this.sessionNamespace};await super.request({method:"PUT",url:`${this.sessionServerBaseUrl}/store/update`,data:o})}async invalidateSession(){super.checkSessionParams();const e=A.Buffer.from(this.sessionId,"hex"),n=$t(e).toString("hex"),r=await Ht(this.sessionId,{}),i=(await xn(e,rt(A.Buffer.from(r,"utf8")))).toString("hex"),s={key:n,data:r,signature:i,namespace:this.sessionNamespace,timeout:1};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/store/set`,data:s}),this.sessionId="",!0}}const ms=new Ct.ec("secp256k1"),si=A.global.crypto||A.global.msCrypto||{};si.subtle||si.webkitSubtle;const Ba=A.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Ua=A.Buffer.alloc(32,0);function nt(t,e){if(!t)throw new Error(e||"Assertion failed")}function Fa(t){return A.Buffer.isBuffer(t)&&t.length===32}function ws(t){return Fa(t)?t.compare(Ua)>0&&t.compare(Ba)<0:!1}const oi=function(t){return nt(t.length===32,"Bad private key"),nt(ws(t),"Bad private key"),A.Buffer.from(ms.keyFromPrivate(t).getPublic("array"))},Wa=async function(t,e){return nt(t.length===32,"Bad private key"),nt(ws(t),"Bad private key"),nt(e.length>0,"Message should not be empty"),nt(e.length<=32,"Message is too long"),A.Buffer.from(ms.sign(e,t,{canonical:!0}).toDER())},Tt=at.getLogger("http-helpers");Tt.setLevel(Nt.levels.INFO);let Ka="torus-default";const ja="x-api-key";function qa(t){Tt.setLevel(t)}async function Ha(t,e){let n=null;try{n=new URL(t)}catch{}return fetch(t,e)}function Va(){const t={};return t[ja]=Ka,t}function Ga(t){Tt.info(`Response: ${t.status} ${t.statusText}`),Tt.info(`Url: ${t.url}`)}function Ya(t){Tt.info(`Request tracing with traceID=${t.headers.get("x-web3-correlation-id")}`)}const Ja=(t,e)=>{const n=new Promise((r,i)=>{const s=setTimeout(()=>{clearTimeout(s),i(new Error(`Timed out in ${t}ms`))},t)});return Promise.race([e,n])},za=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};r.useAPIKey&&(i.headers=P(P({},i.headers),Va()));const s=lt(i,n,{method:"POST"});return r.isUrlEncodedData?(s.body=e,s.headers["Content-Type"]==="application/json; charset=utf-8"&&delete s.headers["Content-Type"]):s.body=JSON.stringify(e),Ja(r.timeout||6e4,Ha(t,s).then(o=>{if(r.logTracingHeader&&Ya(o),o.ok){const c=o.headers.get("content-type");return c!=null&&c.includes("application/json")?o.json():o.text()}throw Ga(o),o}))};var oe=at.getLogger("SecurePubSub");class Xa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I(this,"options",void 0),I(this,"SOCKET_CONN",null),this.options=e,this.options.timeout=e.timeout||600,this.options.serverUrl=e.serverUrl||"https://broadcast-server.tor.us",this.options.enableLogging=e.enableLogging||!1,this.options.namespace=e.namespace||"",this.options.enableLogging?oe.enableAll():oe.disableAll()}static setLogLevel(e){oe.setLevel(e),qa(e)}async publish(e,n){const r=rt(A.Buffer.from(e,"utf8")),i=await Ht(r.toString("hex"),n),s=await Wa(r,rt(A.Buffer.from(i,"utf8"))),o={key:oi(r).toString("hex"),data:i,signature:s.toString("hex"),timeout:this.options.timeout,namespace:this.options.namespace};return za(`${this.options.serverUrl}/channel/set`,o)}async subscribe(e){let n=!0;const r=rt(A.Buffer.from(e,"utf8")),i=oi(r).toString("hex"),s=this.getSocketConnection();s.connected?(oe.debug("already connected with socket"),s.emit("check_auth_status",i,{namespace:this.options.namespace})):s.once("connect",()=>{oe.debug("connected with socket"),s.emit("check_auth_status",i,{namespace:this.options.namespace})});const o=()=>{s.once("connect",async()=>{oe.debug("connected with socket using reconnect"),n&&s.emit("check_auth_status",i,{namespace:this.options.namespace})})},c=()=>{n||document.removeEventListener("visibilitychange",c),!s.connected&&document.visibilityState==="visible"&&o()},u=()=>{oe.debug("socket disconnected",n),n?(oe.error("socket disconnected unexpectedly, reconnecting socket"),o()):s.removeListener("disconnect",u)};s.on("disconnect",u);const f=new Promise((p,w)=>{const v=async y=>{try{const g=await gs(r.toString("hex"),y);oe.info("got data",g),p(g)}catch(g){oe.error(g),w(g)}finally{n=!1,document.removeEventListener("visibilitychange",c)}};oe.info("listening to",`${i}_success`),s.once(`${i}_success`,v)});return typeof document<"u"&&document.addEventListener("visibilitychange",c),f}cleanup(){this.SOCKET_CONN&&(this.SOCKET_CONN.disconnect(),this.SOCKET_CONN=null)}getSocketConnection(){if(this.SOCKET_CONN)return this.SOCKET_CONN;const e=qt(this.options.serverUrl,{transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:10});return e.on("connect_error",n=>{e.io.opts.transports=["polling","websocket"],oe.error("connect error",n)}),e.on("connect",async()=>{const{engine:n}=e.io;oe.debug("initially connected to",n.transport.name),n.once("upgrade",()=>{oe.debug("upgraded",n.transport.name)}),n.once("close",r=>{oe.debug("connection closed",r)})}),e.on("error",n=>{oe.error("socket errored",n),e.disconnect()}),this.SOCKET_CONN=e,this.SOCKET_CONN}}new Ct.ec("secp256k1");const ai=A.global.crypto||A.global.msCrypto||{};ai.subtle||ai.webkitSubtle;A.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex");A.Buffer.alloc(32,0);class _s extends Yi{constructor(e,n){super(n),I(this,"code",void 0),I(this,"message",void 0),this.code=e,this.message=n||"",Object.defineProperty(this,"name",{value:"OpenloginError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class Le extends _s{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"InitializationError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Le(e,`${Le.messages[e]}, ${n}`)}static invalidParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Le.fromCode(5001,e)}static notInitialized(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Le.fromCode(5002,e)}}I(Le,"messages",{5e3:"Custom",5001:"Invalid constructor params",5002:"SDK not initialized. please call init first"});class re extends _s{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"LoginError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new re(e,`${re.messages[e]}, ${n}`)}static invalidLoginParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re.fromCode(5111,e)}static userNotLoggedIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re.fromCode(5112,e)}static popupClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re.fromCode(5113,e)}static loginFailed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re.fromCode(5114,e)}static popupBlocked(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re.fromCode(5115,e)}}I(re,"messages",{5e3:"Custom",5111:"Invalid login params",5112:"User not logged in.",5113:"login popup has been closed by the user",5114:"Login failed",5115:"Popup was blocked. Please call this function as soon as user clicks button or use redirect mode"});const Xt=Nt.getLogger("openlogin");Xt.setLevel("error");const Qa="6.1.0";function Za(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const e={},n=new URL(window.location.href);n.searchParams.forEach((c,u)=>{u!=="result"&&(e[u]=c)});const r=n.searchParams.get("result");if(r)try{const c=JSON.parse(In(r));Object.keys(c).forEach(u=>{e[u]=c[u]})}catch(c){Xt.error(c)}const i=n.hash.substring(1),s=new URL(`${window.location.origin}/?${i}`);s.searchParams.forEach((c,u)=>{u!=="result"&&(e[u]=c)});const o=s.searchParams.get("result");if(o)try{const c=JSON.parse(In(o));Object.keys(c).forEach(u=>{e[u]=c[u]})}catch(c){Xt.error(c)}if(t){const c=new URL(window.location.origin+window.location.pathname);if(c.search=window.location.search,o){const u=JSON.parse(In(o));delete u.sessionId,delete u.sessionNamespace,delete u.error,c.hash=Ea(JSON.stringify(u))}window.history.replaceState(P(P({},window.history.state),{},{as:c.href,url:c.href}),"",c.href)}return e}function ir(t){const{baseURL:e,query:n,hash:r}=t,i=new URL(e);if(n&&Object.keys(n).forEach(s=>{i.searchParams.append(s,n[s])}),r){const s=new URL(ir({baseURL:e,query:r})).searchParams.toString();i.hash=s}return i.toString()}function el(){if(typeof window>"u")return"";const t=window.screenLeft!==void 0?window.screenLeft:window.screenX,e=window.screenTop!==void 0?window.screenTop:window.screenY,n=1200,r=700,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,o=1,c=Math.abs((i-n)/2/o+t),u=Math.abs((s-r)/2/o+e);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${r/o},width=${n/o},top=${u},left=${c}`}function tl(){if(typeof window>"u")return!1;const e=An.getParser(window.navigator.userAgent).getPlatform();return e.type===An.PLATFORMS_MAP.tablet||e.type===An.PLATFORMS_MAP.mobile}function nl(t){return(t===ri.FACEBOOK||t===ri.LINE)&&tl()?1e3*60*5:1e3*10}class rl extends Ot.EventEmitter{constructor(e){let{url:n,target:r,features:i,timeout:s=3e4}=e;super(),I(this,"url",void 0),I(this,"target",void 0),I(this,"features",void 0),I(this,"window",void 0),I(this,"windowTimer",void 0),I(this,"iClosedWindow",void 0),I(this,"timeout",void 0),this.url=n,this.target=r||"_blank",this.features=i||el(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=s,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;if(this.window=window.open(this.url,this.target,this.features),!this.window)throw re.popupBlocked();(e=this.window)!==null&&e!==void 0&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url):window.location.href=this.url}async listenOnChannel(e){const n=new Xa,r=await n.subscribe(e);this.close(),n.cleanup();const i=JSON.parse(r);return i.error?{error:i.error,state:i.state}:i.data}}class il{constructor(e){if(I(this,"state",{}),I(this,"options",void 0),I(this,"sessionManager",void 0),I(this,"currentStorage",void 0),I(this,"_storageBaseKey","openlogin_store"),I(this,"dappState",void 0),I(this,"addVersionInUrls",!0),!e.clientId)throw Le.invalidParams("clientId is required");if(e.network||(e.network=it.SAPPHIRE_MAINNET),e.buildEnv||(e.buildEnv=we.PRODUCTION),(e.buildEnv===we.DEVELOPMENT||e.buildEnv===we.TESTING||e.sdkUrl)&&(this.addVersionInUrls=!1),!e.sdkUrl&&!e.useMpc&&(e.buildEnv===we.DEVELOPMENT?e.sdkUrl="http://localhost:3000":e.buildEnv===we.STAGING?e.sdkUrl="https://staging-auth.web3auth.io":e.buildEnv===we.TESTING?e.sdkUrl="https://develop-auth.web3auth.io":e.sdkUrl="https://auth.web3auth.io"),e.useMpc&&!e.sdkUrl){if(Object.values(Gi).includes(e.network))throw new Error("MPC is not supported on legacy networks");e.buildEnv===we.DEVELOPMENT?e.sdkUrl="http://localhost:3000":e.buildEnv===we.STAGING?e.sdkUrl="https://staging-mpc-auth.web3auth.io":e.buildEnv===we.TESTING?e.sdkUrl="https://develop-mpc-auth.web3auth.io":e.sdkUrl="https://mpc-auth.web3auth.io"}!e.redirectUrl&&typeof window<"u"&&(e.redirectUrl=`${window.location.protocol}//${window.location.host}${window.location.pathname}`),e.uxMode||(e.uxMode=Ke.REDIRECT),typeof e.replaceUrlOnRedirect!="boolean"&&(e.replaceUrlOnRedirect=!0),e.originData||(e.originData={}),e.whiteLabel||(e.whiteLabel={}),e.loginConfig||(e.loginConfig={}),e.mfaSettings||(e.mfaSettings={}),e.storageServerUrl||(e.storageServerUrl="https://broadcast-server.tor.us"),e.storageKey||(e.storageKey="local"),e.webauthnTransports||(e.webauthnTransports=["internal"]),e.sessionTime||(e.sessionTime=86400),this.options=e}get privKey(){return this.options.useMpc?this.state.factorKey||"":this.state.privKey?this.state.privKey.padStart(64,"0"):""}get coreKitKey(){return this.state.coreKitKey?this.state.coreKitKey.padStart(64,"0"):""}get ed25519PrivKey(){return this.state.ed25519PrivKey?this.state.ed25519PrivKey.padStart(128,"0"):""}get coreKitEd25519Key(){return this.state.coreKitEd25519PrivKey?this.state.coreKitEd25519PrivKey.padStart(128,"0"):""}get sessionId(){return this.state.sessionId||""}get sessionNamespace(){return this.options.sessionNamespace||""}get appState(){return this.state.userInfo.appState||this.dappState||""}get baseUrl(){return this.addVersionInUrls?`${this.options.sdkUrl}/v${Qa.split(".")[0]}`:`${this.options.sdkUrl}`}async init(){const e=Za(this.options.replaceUrlOnRedirect);e.sessionNamespace&&(this.options.sessionNamespace=e.sessionNamespace);const n=this.options.sessionNamespace?`${this._storageBaseKey}_${this.options.sessionNamespace}`:this._storageBaseKey;this.currentStorage=ys.getInstance(n,this.options.storageKey);const r=this.currentStorage.get("sessionId");if(this.sessionManager=new Ln({sessionServerBaseUrl:this.options.storageServerUrl,sessionNamespace:this.options.sessionNamespace,sessionTime:this.options.sessionTime,sessionId:r}),(this.options.network===it.TESTNET||this.options.network===it.SAPPHIRE_DEVNET)&&console.log(`%c WARNING! You are on ${this.options.network}. Please set network: 'mainnet' or 'sapphire_mainnet' in production`,"color: #FF0000"),this.options.buildEnv!==we.PRODUCTION&&console.log(`%c WARNING! You are using build env ${this.options.buildEnv}. Please set buildEnv: 'production' in production`,"color: #FF0000"),e.error)throw this.dappState=e.state,re.loginFailed(e.error);if(e.sessionId&&(this.currentStorage.set("sessionId",e.sessionId),this.sessionManager.sessionId=e.sessionId),this.sessionManager.sessionId){const i=await this._authorizeSession();this.updateState(i),Object.keys(i).length===0&&this.currentStorage.set("sessionId","")}}async login(e){if(!e.loginProvider)throw re.invalidLoginParams("loginProvider is required");const n={redirectUrl:this.options.redirectUrl},r=P(P({loginProvider:e.loginProvider},n),e),i={actionType:Pn.LOGIN,options:this.options,params:r},s=await this.openloginHandler(`${this.baseUrl}/start`,i,nl(e.loginProvider));if(this.options.uxMode===Ke.REDIRECT)return null;if(s.error)throw this.dappState=s.state,re.loginFailed(s.error);return this.sessionManager.sessionId=s.sessionId,this.options.sessionNamespace=s.sessionNamespace,this.currentStorage.set("sessionId",s.sessionId),await this.rehydrateSession(),{privKey:this.privKey}}async logout(){if(!this.sessionManager.sessionId)throw re.userNotLoggedIn();await this.sessionManager.invalidateSession(),this.updateState({privKey:"",coreKitKey:"",coreKitEd25519PrivKey:"",ed25519PrivKey:"",walletKey:"",oAuthPrivateKey:"",tKey:"",metadataNonce:"",keyMode:void 0,userInfo:{name:"",profileImage:"",dappShare:"",idToken:"",oAuthIdToken:"",oAuthAccessToken:"",appState:"",email:"",verifier:"",verifierId:"",aggregateVerifier:"",typeOfLogin:"",isMfaEnabled:!1},authToken:"",sessionId:"",factorKey:"",signatures:[],tssShareIndex:-1,tssPubKey:"",tssShare:"",tssNonce:-1}),this.currentStorage.set("sessionId","")}async setupMFA(e){if(!this.sessionId)throw re.userNotLoggedIn();const n={redirectUrl:this.options.redirectUrl},r={actionType:Pn.ENABLE_MFA,options:this.options,params:P(P({},n),e),sessionId:this.sessionId},i=await this.openloginHandler(`${this.baseUrl}/start`,r);if(this.options.uxMode!==Ke.REDIRECT)return this.sessionManager.sessionId=i.sessionId,this.options.sessionNamespace=i.sessionNamespace,this.currentStorage.set("sessionId",i.sessionId),await this.rehydrateSession(),!0}async changeSocialFactor(e){if(!this.sessionId)throw re.userNotLoggedIn();const n={redirectUrl:this.options.redirectUrl},r={actionType:Pn.MODIFY_MFA,options:this.options,params:P(P({},n),e),sessionId:this.sessionId},i=await this.openloginHandler(`${this.baseUrl}/start`,r);if(this.options.uxMode!==Ke.REDIRECT)return this.sessionManager.sessionId=i.sessionId,this.options.sessionNamespace=i.sessionNamespace,this.currentStorage.set("sessionId",i.sessionId),await this.rehydrateSession(),!0}getUserInfo(){if(!this.sessionManager.sessionId)throw re.userNotLoggedIn();return this.state.userInfo}async getLoginId(e){if(!this.sessionManager)throw Le.notInitialized();const n=Ln.generateRandomSessionKey();return await new Ln({sessionServerBaseUrl:this.options.storageServerUrl,sessionNamespace:this.options.sessionNamespace,sessionTime:600,sessionId:n}).createSession(JSON.parse(JSON.stringify(e))),n}async _authorizeSession(){try{return this.sessionManager.sessionId?await this.sessionManager.authorizeSession():{}}catch(e){return Xt.error("authorization failed",e),{}}}updateState(e){this.state=P(P({},this.state),e)}async rehydrateSession(){const e=await this._authorizeSession();this.updateState(e)}async openloginHandler(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e4;const i=await this.getLoginId(n),s={loginId:i,sessionNamespace:this.options.sessionNamespace};if(this.options.uxMode===Ke.REDIRECT){const o=ir({baseURL:e,hash:{b64Params:ei(s)}});window.location.href=o;return}return new Promise((o,c)=>{const u=ir({baseURL:e,hash:{b64Params:ei(s)}}),f=new rl({url:u,timeout:r});f.on("close",()=>{c(re.popupClosed())}),f.listenOnChannel(i).then(o).catch(c);try{f.open()}catch(p){c(p)}})}}var sl={exports:{}},Mn={exports:{}},Q={ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,e){return t.includes(e)},ArrayPrototypeIndexOf(t,e){return t.indexOf(e)},ArrayPrototypeJoin(t,e){return t.join(e)},ArrayPrototypeMap(t,e){return t.map(e)},ArrayPrototypePop(t,e){return t.pop(e)},ArrayPrototypePush(t,e){return t.push(e)},ArrayPrototypeSlice(t,e,n){return t.slice(e,n)},Error,FunctionPrototypeCall(t,e,...n){return t.call(e,...n)},FunctionPrototypeSymbolHasInstance(t,e){return Function.prototype[Symbol.hasInstance].call(t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,e){return Object.defineProperties(t,e)},ObjectDefineProperty(t,e,n){return Object.defineProperty(t,e,n)},ObjectGetOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,e){return Object.setPrototypeOf(t,e)},Promise,PromisePrototypeCatch(t,e){return t.catch(e)},PromisePrototypeThen(t,e,n){return t.then(e,n)},PromiseReject(t){return Promise.reject(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,e){return t.test(e)},SafeSet:Set,String,StringPrototypeSlice(t,e,n){return t.slice(e,n)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(t,e,n){return t.set(e,n)},Uint8Array},Ss={exports:{}};(function(t){const e=He,n=Object.getPrototypeOf(async function(){}).constructor,r=globalThis.Blob||e.Blob,i=typeof r<"u"?function(c){return c instanceof r}:function(c){return!1};class s extends Error{constructor(c){if(!Array.isArray(c))throw new TypeError(`Expected input to be an Array, got ${typeof c}`);let u="";for(let f=0;f<c.length;f++)u+=`    ${c[f].stack}
`;super(u),this.name="AggregateError",this.errors=c}}t.exports={AggregateError:s,kEmptyObject:Object.freeze({}),once(o){let c=!1;return function(...u){c||(c=!0,o.apply(this,u))}},createDeferredPromise:function(){let o,c;return{promise:new Promise((f,p)=>{o=f,c=p}),resolve:o,reject:c}},promisify(o){return new Promise((c,u)=>{o((f,...p)=>f?u(f):c(...p))})},debuglog(){return function(){}},format(o,...c){return o.replace(/%([sdifj])/g,function(...[u,f]){const p=c.shift();return f==="f"?p.toFixed(6):f==="j"?JSON.stringify(p):f==="s"&&typeof p=="object"?`${p.constructor!==Object?p.constructor.name:""} {}`.trim():p.toString()})},inspect(o){switch(typeof o){case"string":if(o.includes("'"))if(o.includes('"')){if(!o.includes("`")&&!o.includes("${"))return`\`${o}\``}else return`"${o}"`;return`'${o}'`;case"number":return isNaN(o)?"NaN":Object.is(o,-0)?String(o):o;case"bigint":return`${String(o)}n`;case"boolean":case"undefined":return String(o);case"object":return"{}"}},types:{isAsyncFunction(o){return o instanceof n},isArrayBufferView(o){return ArrayBuffer.isView(o)}},isBlob:i},t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(Ss);var ke=Ss.exports,Rr={};const{format:ol,inspect:Qt,AggregateError:al}=ke,ll=globalThis.AggregateError||al,cl=Symbol("kIsNodeError"),ul=["string","function","number","object","Function","Object","boolean","bigint","symbol"],fl=/^([A-Z][a-z0-9]*)+$/,dl="__node_internal_",cn={};function je(t,e){if(!t)throw new cn.ERR_INTERNAL_ASSERTION(e)}function li(t){let e="",n=t.length;const r=t[0]==="-"?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function hl(t,e,n){if(typeof e=="function")return je(e.length<=n.length,`Code: ${t}; The provided arguments length (${n.length}) does not match the required ones (${e.length}).`),e(...n);const r=(e.match(/%[dfijoOs]/g)||[]).length;return je(r===n.length,`Code: ${t}; The provided arguments length (${n.length}) does not match the required ones (${r}).`),n.length===0?e:ol(e,...n)}function ie(t,e,n){n||(n=Error);class r extends n{constructor(...s){super(hl(t,e,s))}toString(){return`${this.name} [${t}]: ${this.message}`}}Object.defineProperties(r.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),r.prototype.code=t,r.prototype[cl]=!0,cn[t]=r}function ci(t){const e=dl+t.name;return Object.defineProperty(t,"name",{value:e}),t}function pl(t,e){if(t&&e&&t!==e){if(Array.isArray(e.errors))return e.errors.push(t),e;const n=new ll([e,t],e.message);return n.code=e.code,n}return t||e}let gl=class extends Error{constructor(e="The operation was aborted",n=void 0){if(n!==void 0&&typeof n!="object")throw new cn.ERR_INVALID_ARG_TYPE("options","Object",n);super(e,n),this.code="ABORT_ERR",this.name="AbortError"}};ie("ERR_ASSERTION","%s",Error);ie("ERR_INVALID_ARG_TYPE",(t,e,n)=>{je(typeof t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let r="The ";t.endsWith(" argument")?r+=`${t} `:r+=`"${t}" ${t.includes(".")?"property":"argument"} `,r+="must be ";const i=[],s=[],o=[];for(const u of e)je(typeof u=="string","All expected entries have to be of type string"),ul.includes(u)?i.push(u.toLowerCase()):fl.test(u)?s.push(u):(je(u!=="object",'The value "object" should be written as "Object"'),o.push(u));if(s.length>0){const u=i.indexOf("object");u!==-1&&(i.splice(i,u,1),s.push("Object"))}if(i.length>0){switch(i.length){case 1:r+=`of type ${i[0]}`;break;case 2:r+=`one of type ${i[0]} or ${i[1]}`;break;default:{const u=i.pop();r+=`one of type ${i.join(", ")}, or ${u}`}}(s.length>0||o.length>0)&&(r+=" or ")}if(s.length>0){switch(s.length){case 1:r+=`an instance of ${s[0]}`;break;case 2:r+=`an instance of ${s[0]} or ${s[1]}`;break;default:{const u=s.pop();r+=`an instance of ${s.join(", ")}, or ${u}`}}o.length>0&&(r+=" or ")}switch(o.length){case 0:break;case 1:o[0].toLowerCase()!==o[0]&&(r+="an "),r+=`${o[0]}`;break;case 2:r+=`one of ${o[0]} or ${o[1]}`;break;default:{const u=o.pop();r+=`one of ${o.join(", ")}, or ${u}`}}if(n==null)r+=`. Received ${n}`;else if(typeof n=="function"&&n.name)r+=`. Received function ${n.name}`;else if(typeof n=="object"){var c;if((c=n.constructor)!==null&&c!==void 0&&c.name)r+=`. Received an instance of ${n.constructor.name}`;else{const u=Qt(n,{depth:-1});r+=`. Received ${u}`}}else{let u=Qt(n,{colors:!1});u.length>25&&(u=`${u.slice(0,25)}...`),r+=`. Received type ${typeof n} (${u})`}return r},TypeError);ie("ERR_INVALID_ARG_VALUE",(t,e,n="is invalid")=>{let r=Qt(e);return r.length>128&&(r=r.slice(0,128)+"..."),`The ${t.includes(".")?"property":"argument"} '${t}' ${n}. Received ${r}`},TypeError);ie("ERR_INVALID_RETURN_VALUE",(t,e,n)=>{var r;const i=n!=null&&(r=n.constructor)!==null&&r!==void 0&&r.name?`instance of ${n.constructor.name}`:`type ${typeof n}`;return`Expected ${t} to be returned from the "${e}" function but got ${i}.`},TypeError);ie("ERR_MISSING_ARGS",(...t)=>{je(t.length>0,"At least one arg needs to be specified");let e;const n=t.length;switch(t=(Array.isArray(t)?t:[t]).map(r=>`"${r}"`).join(" or "),n){case 1:e+=`The ${t[0]} argument`;break;case 2:e+=`The ${t[0]} and ${t[1]} arguments`;break;default:{const r=t.pop();e+=`The ${t.join(", ")}, and ${r} arguments`}break}return`${e} must be specified`},TypeError);ie("ERR_OUT_OF_RANGE",(t,e,n)=>{je(e,'Missing "range" argument');let r;return Number.isInteger(n)&&Math.abs(n)>2**32?r=li(String(n)):typeof n=="bigint"?(r=String(n),(n>2n**32n||n<-(2n**32n))&&(r=li(r)),r+="n"):r=Qt(n),`The value of "${t}" is out of range. It must be ${e}. Received ${r}`},RangeError);ie("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);ie("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);ie("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);ie("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);ie("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);ie("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);ie("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);ie("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);ie("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);ie("ERR_STREAM_WRITE_AFTER_END","write after end",Error);ie("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var ue={AbortError:gl,aggregateTwoErrors:ci(pl),hideStackFrames:ci,codes:cn};const{ArrayIsArray:vr,ArrayPrototypeIncludes:Es,ArrayPrototypeJoin:Rs,ArrayPrototypeMap:yl,NumberIsInteger:Ar,NumberIsNaN:bl,NumberMAX_SAFE_INTEGER:ml,NumberMIN_SAFE_INTEGER:wl,NumberParseInt:_l,ObjectPrototypeHasOwnProperty:Sl,RegExpPrototypeExec:vs,String:El,StringPrototypeToUpperCase:Rl,StringPrototypeTrim:vl}=Q,{hideStackFrames:ge,codes:{ERR_SOCKET_BAD_PORT:Al,ERR_INVALID_ARG_TYPE:le,ERR_INVALID_ARG_VALUE:ut,ERR_OUT_OF_RANGE:qe,ERR_UNKNOWN_SIGNAL:ui}}=ue,{normalizeEncoding:Tl}=ke,{isAsyncFunction:Nl,isArrayBufferView:Cl}=ke.types,fi={};function Ol(t){return t===(t|0)}function kl(t){return t===t>>>0}const Il=/^[0-7]+$/,Pl="must be a 32-bit unsigned integer or an octal string";function xl(t,e,n){if(typeof t>"u"&&(t=n),typeof t=="string"){if(vs(Il,t)===null)throw new ut(e,t,Pl);t=_l(t,8)}return As(t,e),t}const Ll=ge((t,e,n=wl,r=ml)=>{if(typeof t!="number")throw new le(e,"number",t);if(!Ar(t))throw new qe(e,"an integer",t);if(t<n||t>r)throw new qe(e,`>= ${n} && <= ${r}`,t)}),Ml=ge((t,e,n=-2147483648,r=2147483647)=>{if(typeof t!="number")throw new le(e,"number",t);if(!Ar(t))throw new qe(e,"an integer",t);if(t<n||t>r)throw new qe(e,`>= ${n} && <= ${r}`,t)}),As=ge((t,e,n=!1)=>{if(typeof t!="number")throw new le(e,"number",t);if(!Ar(t))throw new qe(e,"an integer",t);const r=n?1:0,i=4294967295;if(t<r||t>i)throw new qe(e,`>= ${r} && <= ${i}`,t)});function Tr(t,e){if(typeof t!="string")throw new le(e,"string",t)}function Dl(t,e,n=void 0,r){if(typeof t!="number")throw new le(e,"number",t);if(n!=null&&t<n||r!=null&&t>r||(n!=null||r!=null)&&bl(t))throw new qe(e,`${n!=null?`>= ${n}`:""}${n!=null&&r!=null?" && ":""}${r!=null?`<= ${r}`:""}`,t)}const $l=ge((t,e,n)=>{if(!Es(n,t)){const i="must be one of: "+Rs(yl(n,s=>typeof s=="string"?`'${s}'`:El(s)),", ");throw new ut(e,t,i)}});function Ts(t,e){if(typeof t!="boolean")throw new le(e,"boolean",t)}function Dn(t,e,n){return t==null||!Sl(t,e)?n:t[e]}const Bl=ge((t,e,n=null)=>{const r=Dn(n,"allowArray",!1),i=Dn(n,"allowFunction",!1);if(!Dn(n,"nullable",!1)&&t===null||!r&&vr(t)||typeof t!="object"&&(!i||typeof t!="function"))throw new le(e,"Object",t)}),Ul=ge((t,e)=>{if(t!=null&&typeof t!="object"&&typeof t!="function")throw new le(e,"a dictionary",t)}),Nr=ge((t,e,n=0)=>{if(!vr(t))throw new le(e,"Array",t);if(t.length<n){const r=`must be longer than ${n}`;throw new ut(e,t,r)}});function Fl(t,e){Nr(t,e);for(let n=0;n<t.length;n++)Tr(t[n],`${e}[${n}]`)}function Wl(t,e){Nr(t,e);for(let n=0;n<t.length;n++)Ts(t[n],`${e}[${n}]`)}function Kl(t,e="signal"){if(Tr(t,e),fi[t]===void 0)throw fi[Rl(t)]!==void 0?new ui(t+" (signals must use all capital letters)"):new ui(t)}const jl=ge((t,e="buffer")=>{if(!Cl(t))throw new le(e,["Buffer","TypedArray","DataView"],t)});function ql(t,e){const n=Tl(e),r=t.length;if(n==="hex"&&r%2!==0)throw new ut("encoding",e,`is invalid for data of length ${r}`)}function Hl(t,e="Port",n=!0){if(typeof t!="number"&&typeof t!="string"||typeof t=="string"&&vl(t).length===0||+t!==+t>>>0||t>65535||t===0&&!n)throw new Al(e,t,n);return t|0}const Vl=ge((t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new le(e,"AbortSignal",t)}),Gl=ge((t,e)=>{if(typeof t!="function")throw new le(e,"Function",t)}),Yl=ge((t,e)=>{if(typeof t!="function"||Nl(t))throw new le(e,"Function",t)}),Jl=ge((t,e)=>{if(t!==void 0)throw new le(e,"undefined",t)});function zl(t,e,n){if(!Es(n,t))throw new le(e,`('${Rs(n,"|")}')`,t)}const Xl=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function di(t,e){if(typeof t>"u"||!vs(Xl,t))throw new ut(e,t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Ql(t){if(typeof t=="string")return di(t,"hints"),t;if(vr(t)){const e=t.length;let n="";if(e===0)return n;for(let r=0;r<e;r++){const i=t[r];di(i,"hints"),n+=i,r!==e-1&&(n+=", ")}return n}throw new ut("hints",t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var un={isInt32:Ol,isUint32:kl,parseFileMode:xl,validateArray:Nr,validateStringArray:Fl,validateBooleanArray:Wl,validateBoolean:Ts,validateBuffer:jl,validateDictionary:Ul,validateEncoding:ql,validateFunction:Gl,validateInt32:Ml,validateInteger:Ll,validateNumber:Dl,validateObject:Bl,validateOneOf:$l,validatePlainFunction:Yl,validatePort:Hl,validateSignalName:Kl,validateString:Tr,validateUint32:As,validateUndefined:Jl,validateUnion:zl,validateAbortSignal:Vl,validateLinkHeaderValue:Ql},Cr={exports:{}};const{Symbol:fn,SymbolAsyncIterator:hi,SymbolIterator:pi,SymbolFor:Ns}=Q,Cs=fn("kDestroyed"),Os=fn("kIsErrored"),sr=fn("kIsReadable"),ks=fn("kIsDisturbed"),Zl=Ns("nodejs.webstream.isClosedPromise"),ec=Ns("nodejs.webstream.controllerErrorFunction");function dn(t,e=!1){var n;return!!(t&&typeof t.pipe=="function"&&typeof t.on=="function"&&(!e||typeof t.pause=="function"&&typeof t.resume=="function")&&(!t._writableState||((n=t._readableState)===null||n===void 0?void 0:n.readable)!==!1)&&(!t._writableState||t._readableState))}function hn(t){var e;return!!(t&&typeof t.write=="function"&&typeof t.on=="function"&&(!t._readableState||((e=t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function tc(t){return!!(t&&typeof t.pipe=="function"&&t._readableState&&typeof t.on=="function"&&typeof t.write=="function")}function ve(t){return t&&(t._readableState||t._writableState||typeof t.write=="function"&&typeof t.on=="function"||typeof t.pipe=="function"&&typeof t.on=="function")}function Is(t){return!!(t&&!ve(t)&&typeof t.pipeThrough=="function"&&typeof t.getReader=="function"&&typeof t.cancel=="function")}function Ps(t){return!!(t&&!ve(t)&&typeof t.getWriter=="function"&&typeof t.abort=="function")}function xs(t){return!!(t&&!ve(t)&&typeof t.readable=="object"&&typeof t.writable=="object")}function nc(t){return Is(t)||Ps(t)||xs(t)}function rc(t,e){return t==null?!1:e===!0?typeof t[hi]=="function":e===!1?typeof t[pi]=="function":typeof t[hi]=="function"||typeof t[pi]=="function"}function pn(t){if(!ve(t))return null;const e=t._writableState,n=t._readableState,r=e||n;return!!(t.destroyed||t[Cs]||r!=null&&r.destroyed)}function Ls(t){if(!hn(t))return null;if(t.writableEnded===!0)return!0;const e=t._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function ic(t,e){if(!hn(t))return null;if(t.writableFinished===!0)return!0;const n=t._writableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.finished)!="boolean"?null:!!(n.finished||e===!1&&n.ended===!0&&n.length===0)}function sc(t){if(!dn(t))return null;if(t.readableEnded===!0)return!0;const e=t._readableState;return!e||e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function Ms(t,e){if(!dn(t))return null;const n=t._readableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.endEmitted)!="boolean"?null:!!(n.endEmitted||e===!1&&n.ended===!0&&n.length===0)}function Ds(t){return t&&t[sr]!=null?t[sr]:typeof(t==null?void 0:t.readable)!="boolean"?null:pn(t)?!1:dn(t)&&t.readable&&!Ms(t)}function $s(t){return typeof(t==null?void 0:t.writable)!="boolean"?null:pn(t)?!1:hn(t)&&t.writable&&!Ls(t)}function oc(t,e){return ve(t)?pn(t)?!0:!((e==null?void 0:e.readable)!==!1&&Ds(t)||(e==null?void 0:e.writable)!==!1&&$s(t)):null}function ac(t){var e,n;return ve(t)?t.writableErrored?t.writableErrored:(e=(n=t._writableState)===null||n===void 0?void 0:n.errored)!==null&&e!==void 0?e:null:null}function lc(t){var e,n;return ve(t)?t.readableErrored?t.readableErrored:(e=(n=t._readableState)===null||n===void 0?void 0:n.errored)!==null&&e!==void 0?e:null:null}function cc(t){if(!ve(t))return null;if(typeof t.closed=="boolean")return t.closed;const e=t._writableState,n=t._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(n==null?void 0:n.closed)=="boolean"?(e==null?void 0:e.closed)||(n==null?void 0:n.closed):typeof t._closed=="boolean"&&Bs(t)?t._closed:null}function Bs(t){return typeof t._closed=="boolean"&&typeof t._defaultKeepAlive=="boolean"&&typeof t._removedConnection=="boolean"&&typeof t._removedContLen=="boolean"}function Us(t){return typeof t._sent100=="boolean"&&Bs(t)}function uc(t){var e;return typeof t._consuming=="boolean"&&typeof t._dumped=="boolean"&&((e=t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function fc(t){if(!ve(t))return null;const e=t._writableState,n=t._readableState,r=e||n;return!r&&Us(t)||!!(r&&r.autoDestroy&&r.emitClose&&r.closed===!1)}function dc(t){var e;return!!(t&&((e=t[ks])!==null&&e!==void 0?e:t.readableDidRead||t.readableAborted))}function hc(t){var e,n,r,i,s,o,c,u,f,p;return!!(t&&((e=(n=(r=(i=(s=(o=t[Os])!==null&&o!==void 0?o:t.readableErrored)!==null&&s!==void 0?s:t.writableErrored)!==null&&i!==void 0?i:(c=t._readableState)===null||c===void 0?void 0:c.errorEmitted)!==null&&r!==void 0?r:(u=t._writableState)===null||u===void 0?void 0:u.errorEmitted)!==null&&n!==void 0?n:(f=t._readableState)===null||f===void 0?void 0:f.errored)!==null&&e!==void 0?e:!((p=t._writableState)===null||p===void 0)&&p.errored))}var Ie={kDestroyed:Cs,isDisturbed:dc,kIsDisturbed:ks,isErrored:hc,kIsErrored:Os,isReadable:Ds,kIsReadable:sr,kIsClosedPromise:Zl,kControllerErrorFunction:ec,isClosed:cc,isDestroyed:pn,isDuplexNodeStream:tc,isFinished:oc,isIterable:rc,isReadableNodeStream:dn,isReadableStream:Is,isReadableEnded:sc,isReadableFinished:Ms,isReadableErrored:lc,isNodeStream:ve,isWebStream:nc,isWritable:$s,isWritableNodeStream:hn,isWritableStream:Ps,isWritableEnded:Ls,isWritableFinished:ic,isWritableErrored:ac,isServerRequest:uc,isServerResponse:Us,willEmitClose:fc,isTransformStream:xs};const xe=Ve,{AbortError:Fs,codes:pc}=ue,{ERR_INVALID_ARG_TYPE:gc,ERR_STREAM_PREMATURE_CLOSE:gi}=pc,{kEmptyObject:or,once:ar}=ke,{validateAbortSignal:yc,validateFunction:bc,validateObject:mc,validateBoolean:wc}=un,{Promise:_c,PromisePrototypeThen:Sc}=Q,{isClosed:Ec,isReadable:yi,isReadableNodeStream:$n,isReadableStream:Rc,isReadableFinished:bi,isReadableErrored:mi,isWritable:wi,isWritableNodeStream:_i,isWritableStream:vc,isWritableFinished:Si,isWritableErrored:Ei,isNodeStream:Ac,willEmitClose:Tc,kIsClosedPromise:Nc}=Ie;function Cc(t){return t.setHeader&&typeof t.abort=="function"}const lr=()=>{};function Ws(t,e,n){var r,i;if(arguments.length===2?(n=e,e=or):e==null?e=or:mc(e,"options"),bc(n,"callback"),yc(e.signal,"options.signal"),n=ar(n),Rc(t)||vc(t))return Oc(t,e,n);if(!Ac(t))throw new gc("stream",["ReadableStream","WritableStream","Stream"],t);const s=(r=e.readable)!==null&&r!==void 0?r:$n(t),o=(i=e.writable)!==null&&i!==void 0?i:_i(t),c=t._writableState,u=t._readableState,f=()=>{t.writable||v()};let p=Tc(t)&&$n(t)===s&&_i(t)===o,w=Si(t,!1);const v=()=>{w=!0,t.destroyed&&(p=!1),!(p&&(!t.readable||s))&&(!s||y)&&n.call(t)};let y=bi(t,!1);const g=()=>{y=!0,t.destroyed&&(p=!1),!(p&&(!t.writable||o))&&(!o||w)&&n.call(t)},T=x=>{n.call(t,x)};let M=Ec(t);const C=()=>{M=!0;const x=Ei(t)||mi(t);if(x&&typeof x!="boolean")return n.call(t,x);if(s&&!y&&$n(t,!0)&&!bi(t,!1))return n.call(t,new gi);if(o&&!w&&!Si(t,!1))return n.call(t,new gi);n.call(t)},m=()=>{M=!0;const x=Ei(t)||mi(t);if(x&&typeof x!="boolean")return n.call(t,x);n.call(t)},D=()=>{t.req.on("finish",v)};Cc(t)?(t.on("complete",v),p||t.on("abort",C),t.req?D():t.on("request",D)):o&&!c&&(t.on("end",f),t.on("close",f)),!p&&typeof t.aborted=="boolean"&&t.on("aborted",C),t.on("end",g),t.on("finish",v),e.error!==!1&&t.on("error",T),t.on("close",C),M?xe.nextTick(C):c!=null&&c.errorEmitted||u!=null&&u.errorEmitted?p||xe.nextTick(m):(!s&&(!p||yi(t))&&(w||wi(t)===!1)||!o&&(!p||wi(t))&&(y||yi(t)===!1)||u&&t.req&&t.aborted)&&xe.nextTick(m);const j=()=>{n=lr,t.removeListener("aborted",C),t.removeListener("complete",v),t.removeListener("abort",C),t.removeListener("request",D),t.req&&t.req.removeListener("finish",v),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",v),t.removeListener("end",g),t.removeListener("error",T),t.removeListener("close",C)};if(e.signal&&!M){const x=()=>{const Z=n;j(),Z.call(t,new Fs(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)xe.nextTick(x);else{const Z=n;n=ar((...Y)=>{e.signal.removeEventListener("abort",x),Z.apply(t,Y)}),e.signal.addEventListener("abort",x)}}return j}function Oc(t,e,n){let r=!1,i=lr;if(e.signal)if(i=()=>{r=!0,n.call(t,new Fs(void 0,{cause:e.signal.reason}))},e.signal.aborted)xe.nextTick(i);else{const o=n;n=ar((...c)=>{e.signal.removeEventListener("abort",i),o.apply(t,c)}),e.signal.addEventListener("abort",i)}const s=(...o)=>{r||xe.nextTick(()=>n.apply(t,o))};return Sc(t[Nc].promise,s,s),lr}function kc(t,e){var n;let r=!1;return e===null&&(e=or),(n=e)!==null&&n!==void 0&&n.cleanup&&(wc(e.cleanup,"cleanup"),r=e.cleanup),new _c((i,s)=>{const o=Ws(t,e,c=>{r&&o(),c?s(c):i()})})}Cr.exports=Ws;Cr.exports.finished=kc;var De=Cr.exports;const Se=Ve,{aggregateTwoErrors:Ic,codes:{ERR_MULTIPLE_CALLBACK:Pc},AbortError:xc}=ue,{Symbol:Ks}=Q,{kDestroyed:Lc,isDestroyed:Mc,isFinished:Dc,isServerRequest:$c}=Ie,js=Ks("kDestroy"),cr=Ks("kConstruct");function qs(t,e,n){t&&(t.stack,e&&!e.errored&&(e.errored=t),n&&!n.errored&&(n.errored=t))}function Bc(t,e){const n=this._readableState,r=this._writableState,i=r||n;return r!=null&&r.destroyed||n!=null&&n.destroyed?(typeof e=="function"&&e(),this):(qs(t,r,n),r&&(r.destroyed=!0),n&&(n.destroyed=!0),i.constructed?Ri(this,t,e):this.once(js,function(s){Ri(this,Ic(s,t),e)}),this)}function Ri(t,e,n){let r=!1;function i(s){if(r)return;r=!0;const o=t._readableState,c=t._writableState;qs(s,c,o),c&&(c.closed=!0),o&&(o.closed=!0),typeof n=="function"&&n(s),s?Se.nextTick(Uc,t,s):Se.nextTick(Hs,t)}try{t._destroy(e||null,i)}catch(s){i(s)}}function Uc(t,e){ur(t,e),Hs(t)}function Hs(t){const e=t._readableState,n=t._writableState;n&&(n.closeEmitted=!0),e&&(e.closeEmitted=!0),(n!=null&&n.emitClose||e!=null&&e.emitClose)&&t.emit("close")}function ur(t,e){const n=t._readableState,r=t._writableState;r!=null&&r.errorEmitted||n!=null&&n.errorEmitted||(r&&(r.errorEmitted=!0),n&&(n.errorEmitted=!0),t.emit("error",e))}function Fc(){const t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=t.readable===!1,t.endEmitted=t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function fr(t,e,n){const r=t._readableState,i=t._writableState;if(i!=null&&i.destroyed||r!=null&&r.destroyed)return this;r!=null&&r.autoDestroy||i!=null&&i.autoDestroy?t.destroy(e):e&&(e.stack,i&&!i.errored&&(i.errored=e),r&&!r.errored&&(r.errored=e),n?Se.nextTick(ur,t,e):ur(t,e))}function Wc(t,e){if(typeof t._construct!="function")return;const n=t._readableState,r=t._writableState;n&&(n.constructed=!1),r&&(r.constructed=!1),t.once(cr,e),!(t.listenerCount(cr)>1)&&Se.nextTick(Kc,t)}function Kc(t){let e=!1;function n(r){if(e){fr(t,r??new Pc);return}e=!0;const i=t._readableState,s=t._writableState,o=s||i;i&&(i.constructed=!0),s&&(s.constructed=!0),o.destroyed?t.emit(js,r):r?fr(t,r,!0):Se.nextTick(jc,t)}try{t._construct(r=>{Se.nextTick(n,r)})}catch(r){Se.nextTick(n,r)}}function jc(t){t.emit(cr)}function vi(t){return(t==null?void 0:t.setHeader)&&typeof t.abort=="function"}function Vs(t){t.emit("close")}function qc(t,e){t.emit("error",e),Se.nextTick(Vs,t)}function Hc(t,e){!t||Mc(t)||(!e&&!Dc(t)&&(e=new xc),$c(t)?(t.socket=null,t.destroy(e)):vi(t)?t.abort():vi(t.req)?t.req.abort():typeof t.destroy=="function"?t.destroy(e):typeof t.close=="function"?t.close():e?Se.nextTick(qc,t,e):Se.nextTick(Vs,t),t.destroyed||(t[Lc]=!0))}var ft={construct:Wc,destroyer:Hc,destroy:Bc,undestroy:Fc,errorOrDestroy:fr};const{ArrayIsArray:Vc,ObjectSetPrototypeOf:Gs}=Q,{EventEmitter:gn}=Ot;function yn(t){gn.call(this,t)}Gs(yn.prototype,gn.prototype);Gs(yn,gn);yn.prototype.pipe=function(t,e){const n=this;function r(p){t.writable&&t.write(p)===!1&&n.pause&&n.pause()}n.on("data",r);function i(){n.readable&&n.resume&&n.resume()}t.on("drain",i),!t._isStdio&&(!e||e.end!==!1)&&(n.on("end",o),n.on("close",c));let s=!1;function o(){s||(s=!0,t.end())}function c(){s||(s=!0,typeof t.destroy=="function"&&t.destroy())}function u(p){f(),gn.listenerCount(this,"error")===0&&this.emit("error",p)}dr(n,"error",u),dr(t,"error",u);function f(){n.removeListener("data",r),t.removeListener("drain",i),n.removeListener("end",o),n.removeListener("close",c),n.removeListener("error",u),t.removeListener("error",u),n.removeListener("end",f),n.removeListener("close",f),t.removeListener("close",f)}return n.on("end",f),n.on("close",f),t.on("close",f),t.emit("pipe",n),t};function dr(t,e,n){if(typeof t.prependListener=="function")return t.prependListener(e,n);!t._events||!t._events[e]?t.on(e,n):Vc(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]}var Or={Stream:yn,prependListener:dr},Ys={exports:{}};(function(t){const{AbortError:e,codes:n}=ue,{isNodeStream:r,isWebStream:i,kControllerErrorFunction:s}=Ie,o=De,{ERR_INVALID_ARG_TYPE:c}=n,u=(f,p)=>{if(typeof f!="object"||!("aborted"in f))throw new c(p,"AbortSignal",f)};t.exports.addAbortSignal=function(p,w){if(u(p,"signal"),!r(w)&&!i(w))throw new c("stream",["ReadableStream","WritableStream","Stream"],w);return t.exports.addAbortSignalNoValidate(p,w)},t.exports.addAbortSignalNoValidate=function(f,p){if(typeof f!="object"||!("aborted"in f))return p;const w=r(p)?()=>{p.destroy(new e(void 0,{cause:f.reason}))}:()=>{p[s](new e(void 0,{cause:f.reason}))};return f.aborted?w():(f.addEventListener("abort",w),o(p,()=>f.removeEventListener("abort",w))),p}})(Ys);var bn=Ys.exports;const{StringPrototypeSlice:Ai,SymbolIterator:Gc,TypedArrayPrototypeSet:Bt,Uint8Array:Yc}=Q,{Buffer:Bn}=He,{inspect:Jc}=ke;var zc=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const n={data:e,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}unshift(e){const n={data:e,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let n=this.head,r=""+n.data;for(;(n=n.next)!==null;)r+=e+n.data;return r}concat(e){if(this.length===0)return Bn.alloc(0);const n=Bn.allocUnsafe(e>>>0);let r=this.head,i=0;for(;r;)Bt(n,r.data,i),i+=r.data.length,r=r.next;return n}consume(e,n){const r=this.head.data;if(e<r.length){const i=r.slice(0,e);return this.head.data=r.slice(e),i}return e===r.length?this.shift():n?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[Gc](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let n="",r=this.head,i=0;do{const s=r.data;if(e>s.length)n+=s,e-=s.length;else{e===s.length?(n+=s,++i,r.next?this.head=r.next:this.head=this.tail=null):(n+=Ai(s,0,e),this.head=r,r.data=Ai(s,e));break}++i}while((r=r.next)!==null);return this.length-=i,n}_getBuffer(e){const n=Bn.allocUnsafe(e),r=e;let i=this.head,s=0;do{const o=i.data;if(e>o.length)Bt(n,o,r-e),e-=o.length;else{e===o.length?(Bt(n,o,r-e),++s,i.next?this.head=i.next:this.head=this.tail=null):(Bt(n,new Yc(o.buffer,o.byteOffset,e),r-e),this.head=i,i.data=o.slice(e));break}++s}while((i=i.next)!==null);return this.length-=s,n}[Symbol.for("nodejs.util.inspect.custom")](e,n){return Jc(this,{...n,depth:0,customInspect:!1})}};const{MathFloor:Xc,NumberIsInteger:Qc}=Q,{ERR_INVALID_ARG_VALUE:Zc}=ue.codes;function eu(t,e,n){return t.highWaterMark!=null?t.highWaterMark:e?t[n]:null}function Js(t){return t?16:16*1024}function tu(t,e,n,r){const i=eu(e,r,n);if(i!=null){if(!Qc(i)||i<0){const s=r?`options.${n}`:"options.highWaterMark";throw new Zc(s,i)}return Xc(i)}return Js(t.objectMode)}var kr={getHighWaterMark:tu,getDefaultHighWaterMark:Js};const Ti=Ve,{PromisePrototypeThen:nu,SymbolAsyncIterator:Ni,SymbolIterator:Ci}=Q,{Buffer:ru}=He,{ERR_INVALID_ARG_TYPE:iu,ERR_STREAM_NULL_VALUES:su}=ue.codes;function ou(t,e,n){let r;if(typeof e=="string"||e instanceof ru)return new t({objectMode:!0,...n,read(){this.push(e),this.push(null)}});let i;if(e&&e[Ni])i=!0,r=e[Ni]();else if(e&&e[Ci])i=!1,r=e[Ci]();else throw new iu("iterable",["Iterable"],e);const s=new t({objectMode:!0,highWaterMark:1,...n});let o=!1;s._read=function(){o||(o=!0,u())},s._destroy=function(f,p){nu(c(f),()=>Ti.nextTick(p,f),w=>Ti.nextTick(p,w||f))};async function c(f){const p=f!=null,w=typeof r.throw=="function";if(p&&w){const{value:v,done:y}=await r.throw(f);if(await v,y)return}if(typeof r.return=="function"){const{value:v}=await r.return();await v}}async function u(){for(;;){try{const{value:f,done:p}=i?await r.next():r.next();if(p)s.push(null);else{const w=f&&typeof f.then=="function"?await f:f;if(w===null)throw o=!1,new su;if(s.push(w))continue;o=!1}}catch(f){s.destroy(f)}break}}return s}var zs=ou,Un,Oi;function mn(){if(Oi)return Un;Oi=1;const t=Ve,{ArrayPrototypeIndexOf:e,NumberIsInteger:n,NumberIsNaN:r,NumberParseInt:i,ObjectDefineProperties:s,ObjectKeys:o,ObjectSetPrototypeOf:c,Promise:u,SafeSet:f,SymbolAsyncIterator:p,Symbol:w}=Q;Un=S,S.ReadableState=ye;const{EventEmitter:v}=Ot,{Stream:y,prependListener:g}=Or,{Buffer:T}=He,{addAbortSignal:M}=bn,C=De;let m=ke.debuglog("stream",a=>{m=a});const D=zc,j=ft,{getHighWaterMark:x,getDefaultHighWaterMark:Z}=kr,{aggregateTwoErrors:Y,codes:{ERR_INVALID_ARG_TYPE:ee,ERR_METHOD_NOT_IMPLEMENTED:G,ERR_OUT_OF_RANGE:_,ERR_STREAM_PUSH_AFTER_EOF:B,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:te}}=ue,{validateObject:F}=un,W=w("kPaused"),{StringDecoder:L}=go,z=zs;c(S.prototype,y.prototype),c(S,y);const ne=()=>{},{errorOrDestroy:K}=j;function ye(a,l,E){typeof E!="boolean"&&(E=l instanceof Ce()),this.objectMode=!!(a&&a.objectMode),E&&(this.objectMode=this.objectMode||!!(a&&a.readableObjectMode)),this.highWaterMark=a?x(this,a,"readableHighWaterMark",E):Z(!1),this.buffer=new D,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[W]=null,this.errorEmitted=!1,this.emitClose=!a||a.emitClose!==!1,this.autoDestroy=!a||a.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=a&&a.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,a&&a.encoding&&(this.decoder=new L(a.encoding),this.encoding=a.encoding)}function S(a){if(!(this instanceof S))return new S(a);const l=this instanceof Ce();this._readableState=new ye(a,this,l),a&&(typeof a.read=="function"&&(this._read=a.read),typeof a.destroy=="function"&&(this._destroy=a.destroy),typeof a.construct=="function"&&(this._construct=a.construct),a.signal&&!l&&M(a.signal,this)),y.call(this,a),j.construct(this,()=>{this._readableState.needReadable&&Pe(this,this._readableState)})}S.prototype.destroy=j.destroy,S.prototype._undestroy=j.undestroy,S.prototype._destroy=function(a,l){l(a)},S.prototype[v.captureRejectionSymbol]=function(a){this.destroy(a)},S.prototype.push=function(a,l){return ce(this,a,l,!1)},S.prototype.unshift=function(a,l){return ce(this,a,l,!0)};function ce(a,l,E,R){m("readableAddChunk",l);const N=a._readableState;let se;if(N.objectMode||(typeof l=="string"?(E=E||N.defaultEncoding,N.encoding!==E&&(R&&N.encoding?l=T.from(l,E).toString(N.encoding):(l=T.from(l,E),E=""))):l instanceof T?E="":y._isUint8Array(l)?(l=y._uint8ArrayToBuffer(l),E=""):l!=null&&(se=new ee("chunk",["string","Buffer","Uint8Array"],l))),se)K(a,se);else if(l===null)N.reading=!1,_n(a,N);else if(N.objectMode||l&&l.length>0)if(R)if(N.endEmitted)K(a,new te);else{if(N.destroyed||N.errored)return!1;Ae(a,N,l,!0)}else if(N.ended)K(a,new B);else{if(N.destroyed||N.errored)return!1;N.reading=!1,N.decoder&&!E?(l=N.decoder.write(l),N.objectMode||l.length!==0?Ae(a,N,l,!1):Pe(a,N)):Ae(a,N,l,!1)}else R||(N.reading=!1,Pe(a,N));return!N.ended&&(N.length<N.highWaterMark||N.length===0)}function Ae(a,l,E,R){l.flowing&&l.length===0&&!l.sync&&a.listenerCount("data")>0?(l.multiAwaitDrain?l.awaitDrainWriters.clear():l.awaitDrainWriters=null,l.dataEmitted=!0,a.emit("data",E)):(l.length+=l.objectMode?1:E.length,R?l.buffer.unshift(E):l.buffer.push(E),l.needReadable&&Je(a)),Pe(a,l)}S.prototype.isPaused=function(){const a=this._readableState;return a[W]===!0||a.flowing===!1},S.prototype.setEncoding=function(a){const l=new L(a);this._readableState.decoder=l,this._readableState.encoding=this._readableState.decoder.encoding;const E=this._readableState.buffer;let R="";for(const N of E)R+=l.write(N);return E.clear(),R!==""&&E.push(R),this._readableState.length=R.length,this};const dt=1073741824;function ht(a){if(a>dt)throw new _("size","<= 1GiB",a);return a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++,a}function $e(a,l){return a<=0||l.length===0&&l.ended?0:l.objectMode?1:r(a)?l.flowing&&l.length?l.buffer.first().length:l.length:a<=l.length?a:l.ended?l.length:0}S.prototype.read=function(a){m("read",a),a===void 0?a=NaN:n(a)||(a=i(a,10));const l=this._readableState,E=a;if(a>l.highWaterMark&&(l.highWaterMark=ht(a)),a!==0&&(l.emittedReadable=!1),a===0&&l.needReadable&&((l.highWaterMark!==0?l.length>=l.highWaterMark:l.length>0)||l.ended))return m("read: emitReadable",l.length,l.ended),l.length===0&&l.ended?me(this):Je(this),null;if(a=$e(a,l),a===0&&l.ended)return l.length===0&&me(this),null;let R=l.needReadable;if(m("need readable",R),(l.length===0||l.length-a<l.highWaterMark)&&(R=!0,m("length less than watermark",R)),l.ended||l.reading||l.destroyed||l.errored||!l.constructed)R=!1,m("reading, ended or constructing",R);else if(R){m("do read"),l.reading=!0,l.sync=!0,l.length===0&&(l.needReadable=!0);try{this._read(l.highWaterMark)}catch(se){K(this,se)}l.sync=!1,l.reading||(a=$e(E,l))}let N;return a>0?N=V(a,l):N=null,N===null?(l.needReadable=l.length<=l.highWaterMark,a=0):(l.length-=a,l.multiAwaitDrain?l.awaitDrainWriters.clear():l.awaitDrainWriters=null),l.length===0&&(l.ended||(l.needReadable=!0),E!==a&&l.ended&&me(this)),N!==null&&!l.errorEmitted&&!l.closeEmitted&&(l.dataEmitted=!0,this.emit("data",N)),N};function _n(a,l){if(m("onEofChunk"),!l.ended){if(l.decoder){const E=l.decoder.end();E&&E.length&&(l.buffer.push(E),l.length+=l.objectMode?1:E.length)}l.ended=!0,l.sync?Je(a):(l.needReadable=!1,l.emittedReadable=!0,ze(a))}}function Je(a){const l=a._readableState;m("emitReadable",l.needReadable,l.emittedReadable),l.needReadable=!1,l.emittedReadable||(m("emitReadable",l.flowing),l.emittedReadable=!0,t.nextTick(ze,a))}function ze(a){const l=a._readableState;m("emitReadable_",l.destroyed,l.length,l.ended),!l.destroyed&&!l.errored&&(l.length||l.ended)&&(a.emit("readable"),l.emittedReadable=!1),l.needReadable=!l.flowing&&!l.ended&&l.length<=l.highWaterMark,O(a)}function Pe(a,l){!l.readingMore&&l.constructed&&(l.readingMore=!0,t.nextTick(Sn,a,l))}function Sn(a,l){for(;!l.reading&&!l.ended&&(l.length<l.highWaterMark||l.flowing&&l.length===0);){const E=l.length;if(m("maybeReadMore read 0"),a.read(0),E===l.length)break}l.readingMore=!1}S.prototype._read=function(a){throw new G("_read()")},S.prototype.pipe=function(a,l){const E=this,R=this._readableState;R.pipes.length===1&&(R.multiAwaitDrain||(R.multiAwaitDrain=!0,R.awaitDrainWriters=new f(R.awaitDrainWriters?[R.awaitDrainWriters]:[]))),R.pipes.push(a),m("pipe count=%d opts=%j",R.pipes.length,l);const se=(!l||l.end!==!1)&&a!==t.stdout&&a!==t.stderr?$r:bt;R.endEmitted?t.nextTick(se):E.once("end",se),a.on("unpipe",fe);function fe(Ue,Ne){m("onunpipe"),Ue===E&&Ne&&Ne.hasUnpiped===!1&&(Ne.hasUnpiped=!0,uo())}function $r(){m("onend"),a.end()}let Be,Br=!1;function uo(){m("cleanup"),a.removeListener("close",Rn),a.removeListener("finish",vn),Be&&a.removeListener("drain",Be),a.removeListener("error",En),a.removeListener("unpipe",fe),E.removeListener("end",$r),E.removeListener("end",bt),E.removeListener("data",Fr),Br=!0,Be&&R.awaitDrainWriters&&(!a._writableState||a._writableState.needDrain)&&Be()}function Ur(){Br||(R.pipes.length===1&&R.pipes[0]===a?(m("false write response, pause",0),R.awaitDrainWriters=a,R.multiAwaitDrain=!1):R.pipes.length>1&&R.pipes.includes(a)&&(m("false write response, pause",R.awaitDrainWriters.size),R.awaitDrainWriters.add(a)),E.pause()),Be||(Be=pt(E,a),a.on("drain",Be))}E.on("data",Fr);function Fr(Ue){m("ondata");const Ne=a.write(Ue);m("dest.write",Ne),Ne===!1&&Ur()}function En(Ue){if(m("onerror",Ue),bt(),a.removeListener("error",En),a.listenerCount("error")===0){const Ne=a._writableState||a._readableState;Ne&&!Ne.errorEmitted?K(a,Ue):a.emit("error",Ue)}}g(a,"error",En);function Rn(){a.removeListener("finish",vn),bt()}a.once("close",Rn);function vn(){m("onfinish"),a.removeListener("close",Rn),bt()}a.once("finish",vn);function bt(){m("unpipe"),E.unpipe(a)}return a.emit("pipe",E),a.writableNeedDrain===!0?R.flowing&&Ur():R.flowing||(m("pipe resume"),E.resume()),a};function pt(a,l){return function(){const R=a._readableState;R.awaitDrainWriters===l?(m("pipeOnDrain",1),R.awaitDrainWriters=null):R.multiAwaitDrain&&(m("pipeOnDrain",R.awaitDrainWriters.size),R.awaitDrainWriters.delete(l)),(!R.awaitDrainWriters||R.awaitDrainWriters.size===0)&&a.listenerCount("data")&&a.resume()}}S.prototype.unpipe=function(a){const l=this._readableState,E={hasUnpiped:!1};if(l.pipes.length===0)return this;if(!a){const N=l.pipes;l.pipes=[],this.pause();for(let se=0;se<N.length;se++)N[se].emit("unpipe",this,{hasUnpiped:!1});return this}const R=e(l.pipes,a);return R===-1?this:(l.pipes.splice(R,1),l.pipes.length===0&&this.pause(),a.emit("unpipe",this,E),this)},S.prototype.on=function(a,l){const E=y.prototype.on.call(this,a,l),R=this._readableState;return a==="data"?(R.readableListening=this.listenerCount("readable")>0,R.flowing!==!1&&this.resume()):a==="readable"&&!R.endEmitted&&!R.readableListening&&(R.readableListening=R.needReadable=!0,R.flowing=!1,R.emittedReadable=!1,m("on readable",R.length,R.reading),R.length?Je(this):R.reading||t.nextTick(d,this)),E},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(a,l){const E=y.prototype.removeListener.call(this,a,l);return a==="readable"&&t.nextTick(gt,this),E},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(a){const l=y.prototype.removeAllListeners.apply(this,arguments);return(a==="readable"||a===void 0)&&t.nextTick(gt,this),l};function gt(a){const l=a._readableState;l.readableListening=a.listenerCount("readable")>0,l.resumeScheduled&&l[W]===!1?l.flowing=!0:a.listenerCount("data")>0?a.resume():l.readableListening||(l.flowing=null)}function d(a){m("readable nexttick read 0"),a.read(0)}S.prototype.resume=function(){const a=this._readableState;return a.flowing||(m("resume"),a.flowing=!a.readableListening,h(this,a)),a[W]=!1,this};function h(a,l){l.resumeScheduled||(l.resumeScheduled=!0,t.nextTick(b,a,l))}function b(a,l){m("resume",l.reading),l.reading||a.read(0),l.resumeScheduled=!1,a.emit("resume"),O(a),l.flowing&&!l.reading&&a.read(0)}S.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[W]=!0,this};function O(a){const l=a._readableState;for(m("flow",l.flowing);l.flowing&&a.read()!==null;);}S.prototype.wrap=function(a){let l=!1;a.on("data",R=>{!this.push(R)&&a.pause&&(l=!0,a.pause())}),a.on("end",()=>{this.push(null)}),a.on("error",R=>{K(this,R)}),a.on("close",()=>{this.destroy()}),a.on("destroy",()=>{this.destroy()}),this._read=()=>{l&&a.resume&&(l=!1,a.resume())};const E=o(a);for(let R=1;R<E.length;R++){const N=E[R];this[N]===void 0&&typeof a[N]=="function"&&(this[N]=a[N].bind(a))}return this},S.prototype[p]=function(){return k(this)},S.prototype.iterator=function(a){return a!==void 0&&F(a,"options"),k(this,a)};function k(a,l){typeof a.read!="function"&&(a=S.wrap(a,{objectMode:!0}));const E=H(a,l);return E.stream=a,E}async function*H(a,l){let E=ne;function R(fe){this===a?(E(),E=ne):E=fe}a.on("readable",R);let N;const se=C(a,{writable:!1},fe=>{N=fe?Y(N,fe):null,E(),E=ne});try{for(;;){const fe=a.destroyed?null:a.read();if(fe!==null)yield fe;else{if(N)throw N;if(N===null)return;await new u(R)}}}catch(fe){throw N=Y(N,fe),N}finally{(N||(l==null?void 0:l.destroyOnReturn)!==!1)&&(N===void 0||a._readableState.autoDestroy)?j.destroyer(a,null):(a.off("readable",R),se())}}s(S.prototype,{readable:{__proto__:null,get(){const a=this._readableState;return!!a&&a.readable!==!1&&!a.destroyed&&!a.errorEmitted&&!a.endEmitted},set(a){this._readableState&&(this._readableState.readable=!!a)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(a){this._readableState&&(this._readableState.flowing=a)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(a){this._readableState&&(this._readableState.destroyed=a)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),s(ye.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[W]!==!1},set(a){this[W]=!!a}}}),S._fromList=V;function V(a,l){if(l.length===0)return null;let E;return l.objectMode?E=l.buffer.shift():!a||a>=l.length?(l.decoder?E=l.buffer.join(""):l.buffer.length===1?E=l.buffer.first():E=l.buffer.concat(l.length),l.buffer.clear()):E=l.buffer.consume(a,l.decoder),E}function me(a){const l=a._readableState;m("endReadable",l.endEmitted),l.endEmitted||(l.ended=!0,t.nextTick(Xe,l,a))}function Xe(a,l){if(m("endReadableNT",a.endEmitted,a.length),!a.errored&&!a.closeEmitted&&!a.endEmitted&&a.length===0){if(a.endEmitted=!0,l.emit("end"),l.writable&&l.allowHalfOpen===!1)t.nextTick(yt,l);else if(a.autoDestroy){const E=l._writableState;(!E||E.autoDestroy&&(E.finished||E.writable===!1))&&l.destroy()}}}function yt(a){a.writable&&!a.writableEnded&&!a.destroyed&&a.end()}S.from=function(a,l){return z(S,a,l)};let Te;function Dr(){return Te===void 0&&(Te={}),Te}return S.fromWeb=function(a,l){return Dr().newStreamReadableFromReadableStream(a,l)},S.toWeb=function(a,l){return Dr().newReadableStreamFromStreamReadable(a,l)},S.wrap=function(a,l){var E,R;return new S({objectMode:(E=(R=a.readableObjectMode)!==null&&R!==void 0?R:a.objectMode)!==null&&E!==void 0?E:!0,...l,destroy(N,se){j.destroyer(a,N),se(N)}}).wrap(a)},Un}var Fn,ki;function Xs(){if(ki)return Fn;ki=1;const t=Ve,{ArrayPrototypeSlice:e,Error:n,FunctionPrototypeSymbolHasInstance:r,ObjectDefineProperty:i,ObjectDefineProperties:s,ObjectSetPrototypeOf:o,StringPrototypeToLowerCase:c,Symbol:u,SymbolHasInstance:f}=Q;Fn=L,L.WritableState=F;const{EventEmitter:p}=Ot,w=Or.Stream,{Buffer:v}=He,y=ft,{addAbortSignal:g}=bn,{getHighWaterMark:T,getDefaultHighWaterMark:M}=kr,{ERR_INVALID_ARG_TYPE:C,ERR_METHOD_NOT_IMPLEMENTED:m,ERR_MULTIPLE_CALLBACK:D,ERR_STREAM_CANNOT_PIPE:j,ERR_STREAM_DESTROYED:x,ERR_STREAM_ALREADY_FINISHED:Z,ERR_STREAM_NULL_VALUES:Y,ERR_STREAM_WRITE_AFTER_END:ee,ERR_UNKNOWN_ENCODING:G}=ue.codes,{errorOrDestroy:_}=y;o(L.prototype,w.prototype),o(L,w);function B(){}const te=u("kOnFinished");function F(d,h,b){typeof b!="boolean"&&(b=h instanceof Ce()),this.objectMode=!!(d&&d.objectMode),b&&(this.objectMode=this.objectMode||!!(d&&d.writableObjectMode)),this.highWaterMark=d?T(this,d,"writableHighWaterMark",b):M(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const O=!!(d&&d.decodeStrings===!1);this.decodeStrings=!O,this.defaultEncoding=d&&d.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=S.bind(void 0,h),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,W(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!d||d.emitClose!==!1,this.autoDestroy=!d||d.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[te]=[]}function W(d){d.buffered=[],d.bufferedIndex=0,d.allBuffers=!0,d.allNoop=!0}F.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},i(F.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function L(d){const h=this instanceof Ce();if(!h&&!r(L,this))return new L(d);this._writableState=new F(d,this,h),d&&(typeof d.write=="function"&&(this._write=d.write),typeof d.writev=="function"&&(this._writev=d.writev),typeof d.destroy=="function"&&(this._destroy=d.destroy),typeof d.final=="function"&&(this._final=d.final),typeof d.construct=="function"&&(this._construct=d.construct),d.signal&&g(d.signal,this)),w.call(this,d),y.construct(this,()=>{const b=this._writableState;b.writing||ht(this,b),ze(this,b)})}i(L,f,{__proto__:null,value:function(d){return r(this,d)?!0:this!==L?!1:d&&d._writableState instanceof F}}),L.prototype.pipe=function(){_(this,new j)};function z(d,h,b,O){const k=d._writableState;if(typeof b=="function")O=b,b=k.defaultEncoding;else{if(!b)b=k.defaultEncoding;else if(b!=="buffer"&&!v.isEncoding(b))throw new G(b);typeof O!="function"&&(O=B)}if(h===null)throw new Y;if(!k.objectMode)if(typeof h=="string")k.decodeStrings!==!1&&(h=v.from(h,b),b="buffer");else if(h instanceof v)b="buffer";else if(w._isUint8Array(h))h=w._uint8ArrayToBuffer(h),b="buffer";else throw new C("chunk",["string","Buffer","Uint8Array"],h);let H;return k.ending?H=new ee:k.destroyed&&(H=new x("write")),H?(t.nextTick(O,H),_(d,H,!0),H):(k.pendingcb++,ne(d,k,h,b,O))}L.prototype.write=function(d,h,b){return z(this,d,h,b)===!0},L.prototype.cork=function(){this._writableState.corked++},L.prototype.uncork=function(){const d=this._writableState;d.corked&&(d.corked--,d.writing||ht(this,d))},L.prototype.setDefaultEncoding=function(h){if(typeof h=="string"&&(h=c(h)),!v.isEncoding(h))throw new G(h);return this._writableState.defaultEncoding=h,this};function ne(d,h,b,O,k){const H=h.objectMode?1:b.length;h.length+=H;const V=h.length<h.highWaterMark;return V||(h.needDrain=!0),h.writing||h.corked||h.errored||!h.constructed?(h.buffered.push({chunk:b,encoding:O,callback:k}),h.allBuffers&&O!=="buffer"&&(h.allBuffers=!1),h.allNoop&&k!==B&&(h.allNoop=!1)):(h.writelen=H,h.writecb=k,h.writing=!0,h.sync=!0,d._write(b,O,h.onwrite),h.sync=!1),V&&!h.errored&&!h.destroyed}function K(d,h,b,O,k,H,V){h.writelen=O,h.writecb=V,h.writing=!0,h.sync=!0,h.destroyed?h.onwrite(new x("write")):b?d._writev(k,h.onwrite):d._write(k,H,h.onwrite),h.sync=!1}function ye(d,h,b,O){--h.pendingcb,O(b),dt(h),_(d,b)}function S(d,h){const b=d._writableState,O=b.sync,k=b.writecb;if(typeof k!="function"){_(d,new D);return}b.writing=!1,b.writecb=null,b.length-=b.writelen,b.writelen=0,h?(h.stack,b.errored||(b.errored=h),d._readableState&&!d._readableState.errored&&(d._readableState.errored=h),O?t.nextTick(ye,d,b,h,k):ye(d,b,h,k)):(b.buffered.length>b.bufferedIndex&&ht(d,b),O?b.afterWriteTickInfo!==null&&b.afterWriteTickInfo.cb===k?b.afterWriteTickInfo.count++:(b.afterWriteTickInfo={count:1,cb:k,stream:d,state:b},t.nextTick(ce,b.afterWriteTickInfo)):Ae(d,b,1,k))}function ce({stream:d,state:h,count:b,cb:O}){return h.afterWriteTickInfo=null,Ae(d,h,b,O)}function Ae(d,h,b,O){for(!h.ending&&!d.destroyed&&h.length===0&&h.needDrain&&(h.needDrain=!1,d.emit("drain"));b-- >0;)h.pendingcb--,O();h.destroyed&&dt(h),ze(d,h)}function dt(d){if(d.writing)return;for(let k=d.bufferedIndex;k<d.buffered.length;++k){var h;const{chunk:H,callback:V}=d.buffered[k],me=d.objectMode?1:H.length;d.length-=me,V((h=d.errored)!==null&&h!==void 0?h:new x("write"))}const b=d[te].splice(0);for(let k=0;k<b.length;k++){var O;b[k]((O=d.errored)!==null&&O!==void 0?O:new x("end"))}W(d)}function ht(d,h){if(h.corked||h.bufferProcessing||h.destroyed||!h.constructed)return;const{buffered:b,bufferedIndex:O,objectMode:k}=h,H=b.length-O;if(!H)return;let V=O;if(h.bufferProcessing=!0,H>1&&d._writev){h.pendingcb-=H-1;const me=h.allNoop?B:yt=>{for(let Te=V;Te<b.length;++Te)b[Te].callback(yt)},Xe=h.allNoop&&V===0?b:e(b,V);Xe.allBuffers=h.allBuffers,K(d,h,!0,h.length,Xe,"",me),W(h)}else{do{const{chunk:me,encoding:Xe,callback:yt}=b[V];b[V++]=null;const Te=k?1:me.length;K(d,h,!1,Te,me,Xe,yt)}while(V<b.length&&!h.writing);V===b.length?W(h):V>256?(b.splice(0,V),h.bufferedIndex=0):h.bufferedIndex=V}h.bufferProcessing=!1}L.prototype._write=function(d,h,b){if(this._writev)this._writev([{chunk:d,encoding:h}],b);else throw new m("_write()")},L.prototype._writev=null,L.prototype.end=function(d,h,b){const O=this._writableState;typeof d=="function"?(b=d,d=null,h=null):typeof h=="function"&&(b=h,h=null);let k;if(d!=null){const H=z(this,d,h);H instanceof n&&(k=H)}return O.corked&&(O.corked=1,this.uncork()),k||(!O.errored&&!O.ending?(O.ending=!0,ze(this,O,!0),O.ended=!0):O.finished?k=new Z("end"):O.destroyed&&(k=new x("end"))),typeof b=="function"&&(k||O.finished?t.nextTick(b,k):O[te].push(b)),this};function $e(d){return d.ending&&!d.destroyed&&d.constructed&&d.length===0&&!d.errored&&d.buffered.length===0&&!d.finished&&!d.writing&&!d.errorEmitted&&!d.closeEmitted}function _n(d,h){let b=!1;function O(k){if(b){_(d,k??D());return}if(b=!0,h.pendingcb--,k){const H=h[te].splice(0);for(let V=0;V<H.length;V++)H[V](k);_(d,k,h.sync)}else $e(h)&&(h.prefinished=!0,d.emit("prefinish"),h.pendingcb++,t.nextTick(Pe,d,h))}h.sync=!0,h.pendingcb++;try{d._final(O)}catch(k){O(k)}h.sync=!1}function Je(d,h){!h.prefinished&&!h.finalCalled&&(typeof d._final=="function"&&!h.destroyed?(h.finalCalled=!0,_n(d,h)):(h.prefinished=!0,d.emit("prefinish")))}function ze(d,h,b){$e(h)&&(Je(d,h),h.pendingcb===0&&(b?(h.pendingcb++,t.nextTick((O,k)=>{$e(k)?Pe(O,k):k.pendingcb--},d,h)):$e(h)&&(h.pendingcb++,Pe(d,h))))}function Pe(d,h){h.pendingcb--,h.finished=!0;const b=h[te].splice(0);for(let O=0;O<b.length;O++)b[O]();if(d.emit("finish"),h.autoDestroy){const O=d._readableState;(!O||O.autoDestroy&&(O.endEmitted||O.readable===!1))&&d.destroy()}}s(L.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(d){this._writableState&&(this._writableState.destroyed=d)}},writable:{__proto__:null,get(){const d=this._writableState;return!!d&&d.writable!==!1&&!d.destroyed&&!d.errored&&!d.ending&&!d.ended},set(d){this._writableState&&(this._writableState.writable=!!d)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const d=this._writableState;return d?!d.destroyed&&!d.ending&&d.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Sn=y.destroy;L.prototype.destroy=function(d,h){const b=this._writableState;return!b.destroyed&&(b.bufferedIndex<b.buffered.length||b[te].length)&&t.nextTick(dt,b),Sn.call(this,d,h),this},L.prototype._undestroy=y.undestroy,L.prototype._destroy=function(d,h){h(d)},L.prototype[p.captureRejectionSymbol]=function(d){this.destroy(d)};let pt;function gt(){return pt===void 0&&(pt={}),pt}return L.fromWeb=function(d,h){return gt().newStreamWritableFromWritableStream(d,h)},L.toWeb=function(d){return gt().newWritableStreamFromStreamWritable(d)},Fn}var Wn,Ii;function au(){if(Ii)return Wn;Ii=1;const t=Ve,e=He,{isReadable:n,isWritable:r,isIterable:i,isNodeStream:s,isReadableNodeStream:o,isWritableNodeStream:c,isDuplexNodeStream:u}=Ie,f=De,{AbortError:p,codes:{ERR_INVALID_ARG_TYPE:w,ERR_INVALID_RETURN_VALUE:v}}=ue,{destroyer:y}=ft,g=Ce(),T=mn(),{createDeferredPromise:M}=ke,C=zs,m=globalThis.Blob||e.Blob,D=typeof m<"u"?function(_){return _ instanceof m}:function(_){return!1},j=globalThis.AbortController||gr().AbortController,{FunctionPrototypeCall:x}=Q;class Z extends g{constructor(_){super(_),(_==null?void 0:_.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(_==null?void 0:_.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}Wn=function G(_,B){if(u(_))return _;if(o(_))return ee({readable:_});if(c(_))return ee({writable:_});if(s(_))return ee({writable:!1,readable:!1});if(typeof _=="function"){const{value:F,write:W,final:L,destroy:z}=Y(_);if(i(F))return C(Z,F,{objectMode:!0,write:W,final:L,destroy:z});const ne=F==null?void 0:F.then;if(typeof ne=="function"){let K;const ye=x(ne,F,S=>{if(S!=null)throw new v("nully","body",S)},S=>{y(K,S)});return K=new Z({objectMode:!0,readable:!1,write:W,final(S){L(async()=>{try{await ye,t.nextTick(S,null)}catch(ce){t.nextTick(S,ce)}})},destroy:z})}throw new v("Iterable, AsyncIterable or AsyncFunction",B,F)}if(D(_))return G(_.arrayBuffer());if(i(_))return C(Z,_,{objectMode:!0,writable:!1});if(typeof(_==null?void 0:_.writable)=="object"||typeof(_==null?void 0:_.readable)=="object"){const F=_!=null&&_.readable?o(_==null?void 0:_.readable)?_==null?void 0:_.readable:G(_.readable):void 0,W=_!=null&&_.writable?c(_==null?void 0:_.writable)?_==null?void 0:_.writable:G(_.writable):void 0;return ee({readable:F,writable:W})}const te=_==null?void 0:_.then;if(typeof te=="function"){let F;return x(te,_,W=>{W!=null&&F.push(W),F.push(null)},W=>{y(F,W)}),F=new Z({objectMode:!0,writable:!1,read(){}})}throw new w(B,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],_)};function Y(G){let{promise:_,resolve:B}=M();const te=new j,F=te.signal;return{value:G(async function*(){for(;;){const L=_;_=null;const{chunk:z,done:ne,cb:K}=await L;if(t.nextTick(K),ne)return;if(F.aborted)throw new p(void 0,{cause:F.reason});({promise:_,resolve:B}=M()),yield z}}(),{signal:F}),write(L,z,ne){const K=B;B=null,K({chunk:L,done:!1,cb:ne})},final(L){const z=B;B=null,z({done:!0,cb:L})},destroy(L,z){te.abort(),z(L)}}}function ee(G){const _=G.readable&&typeof G.readable.read!="function"?T.wrap(G.readable):G.readable,B=G.writable;let te=!!n(_),F=!!r(B),W,L,z,ne,K;function ye(S){const ce=ne;ne=null,ce?ce(S):S&&K.destroy(S)}return K=new Z({readableObjectMode:!!(_!=null&&_.readableObjectMode),writableObjectMode:!!(B!=null&&B.writableObjectMode),readable:te,writable:F}),F&&(f(B,S=>{F=!1,S&&y(_,S),ye(S)}),K._write=function(S,ce,Ae){B.write(S,ce)?Ae():W=Ae},K._final=function(S){B.end(),L=S},B.on("drain",function(){if(W){const S=W;W=null,S()}}),B.on("finish",function(){if(L){const S=L;L=null,S()}})),te&&(f(_,S=>{te=!1,S&&y(_,S),ye(S)}),_.on("readable",function(){if(z){const S=z;z=null,S()}}),_.on("end",function(){K.push(null)}),K._read=function(){for(;;){const S=_.read();if(S===null){z=K._read;return}if(!K.push(S))return}}),K._destroy=function(S,ce){!S&&ne!==null&&(S=new p),z=null,W=null,L=null,ne===null?ce(S):(ne=ce,y(B,S),y(_,S))},K}return Wn}var Kn,Pi;function Ce(){if(Pi)return Kn;Pi=1;const{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:n,ObjectSetPrototypeOf:r}=Q;Kn=o;const i=mn(),s=Xs();r(o.prototype,i.prototype),r(o,i);{const p=n(s.prototype);for(let w=0;w<p.length;w++){const v=p[w];o.prototype[v]||(o.prototype[v]=s.prototype[v])}}function o(p){if(!(this instanceof o))return new o(p);i.call(this,p),s.call(this,p),p?(this.allowHalfOpen=p.allowHalfOpen!==!1,p.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),p.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(o.prototype,{writable:{__proto__:null,...e(s.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(s.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(s.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(s.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(s.prototype,"writableLength")},writableFinished:{__proto__:null,...e(s.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(s.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(s.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(s.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(p){this._readableState&&this._writableState&&(this._readableState.destroyed=p,this._writableState.destroyed=p)}}});let c;function u(){return c===void 0&&(c={}),c}o.fromWeb=function(p,w){return u().newStreamDuplexFromReadableWritablePair(p,w)},o.toWeb=function(p){return u().newReadableWritablePairFromDuplex(p)};let f;return o.from=function(p){return f||(f=au()),f(p,"body")},Kn}const{ObjectSetPrototypeOf:Qs,Symbol:lu}=Q;var Zs=Oe;const{ERR_METHOD_NOT_IMPLEMENTED:cu}=ue.codes,Ir=Ce(),{getHighWaterMark:uu}=kr;Qs(Oe.prototype,Ir.prototype);Qs(Oe,Ir);const vt=lu("kCallback");function Oe(t){if(!(this instanceof Oe))return new Oe(t);const e=t?uu(this,t,"readableHighWaterMark",!0):null;e===0&&(t={...t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:t.writableHighWaterMark||0}),Ir.call(this,t),this._readableState.sync=!1,this[vt]=null,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",fu)}function hr(t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,n)=>{if(e){t?t(e):this.destroy(e);return}n!=null&&this.push(n),this.push(null),t&&t()}):(this.push(null),t&&t())}function fu(){this._final!==hr&&hr.call(this)}Oe.prototype._final=hr;Oe.prototype._transform=function(t,e,n){throw new cu("_transform()")};Oe.prototype._write=function(t,e,n){const r=this._readableState,i=this._writableState,s=r.length;this._transform(t,e,(o,c)=>{if(o){n(o);return}c!=null&&this.push(c),i.ended||s===r.length||r.length<r.highWaterMark?n():this[vt]=n})};Oe.prototype._read=function(){if(this[vt]){const t=this[vt];this[vt]=null,t()}};const{ObjectSetPrototypeOf:eo}=Q;var to=ot;const Pr=Zs;eo(ot.prototype,Pr.prototype);eo(ot,Pr);function ot(t){if(!(this instanceof ot))return new ot(t);Pr.call(this,t)}ot.prototype._transform=function(t,e,n){n(null,t)};const St=Ve,{ArrayIsArray:du,Promise:hu,SymbolAsyncIterator:pu}=Q,Zt=De,{once:gu}=ke,yu=ft,xi=Ce(),{aggregateTwoErrors:bu,codes:{ERR_INVALID_ARG_TYPE:pr,ERR_INVALID_RETURN_VALUE:jn,ERR_MISSING_ARGS:mu,ERR_STREAM_DESTROYED:wu,ERR_STREAM_PREMATURE_CLOSE:_u},AbortError:Su}=ue,{validateFunction:Eu,validateAbortSignal:Ru}=un,{isIterable:We,isReadable:qn,isReadableNodeStream:Vt,isNodeStream:Li,isTransformStream:Ze,isWebStream:vu,isReadableStream:Hn,isReadableEnded:Au}=Ie,Tu=globalThis.AbortController||gr().AbortController;let Vn,Gn;function Mi(t,e,n){let r=!1;t.on("close",()=>{r=!0});const i=Zt(t,{readable:e,writable:n},s=>{r=!s});return{destroy:s=>{r||(r=!0,yu.destroyer(t,s||new wu("pipe")))},cleanup:i}}function Nu(t){return Eu(t[t.length-1],"streams[stream.length - 1]"),t.pop()}function Yn(t){if(We(t))return t;if(Vt(t))return Cu(t);throw new pr("val",["Readable","Iterable","AsyncIterable"],t)}async function*Cu(t){Gn||(Gn=mn()),yield*Gn.prototype[pu].call(t)}async function Ut(t,e,n,{end:r}){let i,s=null;const o=f=>{if(f&&(i=f),s){const p=s;s=null,p()}},c=()=>new hu((f,p)=>{i?p(i):s=()=>{i?p(i):f()}});e.on("drain",o);const u=Zt(e,{readable:!1},o);try{e.writableNeedDrain&&await c();for await(const f of t)e.write(f)||await c();r&&e.end(),await c(),n()}catch(f){n(i!==f?bu(i,f):f)}finally{u(),e.off("drain",o)}}async function Jn(t,e,n,{end:r}){Ze(e)&&(e=e.writable);const i=e.getWriter();try{for await(const s of t)await i.ready,i.write(s).catch(()=>{});await i.ready,r&&await i.close(),n()}catch(s){try{await i.abort(s),n(s)}catch(o){n(o)}}}function Ou(...t){return no(t,gu(Nu(t)))}function no(t,e,n){if(t.length===1&&du(t[0])&&(t=t[0]),t.length<2)throw new mu("streams");const r=new Tu,i=r.signal,s=n==null?void 0:n.signal,o=[];Ru(s,"options.signal");function c(){y(new Su)}s==null||s.addEventListener("abort",c);let u,f;const p=[];let w=0;function v(C){y(C,--w===0)}function y(C,m){if(C&&(!u||u.code==="ERR_STREAM_PREMATURE_CLOSE")&&(u=C),!(!u&&!m)){for(;p.length;)p.shift()(u);s==null||s.removeEventListener("abort",c),r.abort(),m&&(u||o.forEach(D=>D()),St.nextTick(e,u,f))}}let g;for(let C=0;C<t.length;C++){const m=t[C],D=C<t.length-1,j=C>0,x=D||(n==null?void 0:n.end)!==!1,Z=C===t.length-1;if(Li(m)){let Y=function(ee){ee&&ee.name!=="AbortError"&&ee.code!=="ERR_STREAM_PREMATURE_CLOSE"&&v(ee)};if(x){const{destroy:ee,cleanup:G}=Mi(m,D,j);p.push(ee),qn(m)&&Z&&o.push(G)}m.on("error",Y),qn(m)&&Z&&o.push(()=>{m.removeListener("error",Y)})}if(C===0)if(typeof m=="function"){if(g=m({signal:i}),!We(g))throw new jn("Iterable, AsyncIterable or Stream","source",g)}else We(m)||Vt(m)||Ze(m)?g=m:g=xi.from(m);else if(typeof m=="function"){if(Ze(g)){var T;g=Yn((T=g)===null||T===void 0?void 0:T.readable)}else g=Yn(g);if(g=m(g,{signal:i}),D){if(!We(g,!0))throw new jn("AsyncIterable",`transform[${C-1}]`,g)}else{var M;Vn||(Vn=to);const Y=new Vn({objectMode:!0}),ee=(M=g)===null||M===void 0?void 0:M.then;if(typeof ee=="function")w++,ee.call(g,B=>{f=B,B!=null&&Y.write(B),x&&Y.end(),St.nextTick(v)},B=>{Y.destroy(B),St.nextTick(v,B)});else if(We(g,!0))w++,Ut(g,Y,v,{end:x});else if(Hn(g)||Ze(g)){const B=g.readable||g;w++,Ut(B,Y,v,{end:x})}else throw new jn("AsyncIterable or Promise","destination",g);g=Y;const{destroy:G,cleanup:_}=Mi(g,!1,!0);p.push(G),Z&&o.push(_)}}else if(Li(m)){if(Vt(g)){w+=2;const Y=ku(g,m,v,{end:x});qn(m)&&Z&&o.push(Y)}else if(Ze(g)||Hn(g)){const Y=g.readable||g;w++,Ut(Y,m,v,{end:x})}else if(We(g))w++,Ut(g,m,v,{end:x});else throw new pr("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],g);g=m}else if(vu(m)){if(Vt(g))w++,Jn(Yn(g),m,v,{end:x});else if(Hn(g)||We(g))w++,Jn(g,m,v,{end:x});else if(Ze(g))w++,Jn(g.readable,m,v,{end:x});else throw new pr("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],g);g=m}else g=xi.from(m)}return(i!=null&&i.aborted||s!=null&&s.aborted)&&St.nextTick(c),g}function ku(t,e,n,{end:r}){let i=!1;if(e.on("close",()=>{i||n(new _u)}),t.pipe(e,{end:!1}),r){let s=function(){i=!0,e.end()};Au(t)?St.nextTick(s):t.once("end",s)}else n();return Zt(t,{readable:!0,writable:!1},s=>{const o=t._readableState;s&&s.code==="ERR_STREAM_PREMATURE_CLOSE"&&o&&o.ended&&!o.errored&&!o.errorEmitted?t.once("end",n).once("error",n):n(s)}),Zt(e,{readable:!1,writable:!0},n)}var xr={pipelineImpl:no,pipeline:Ou};const{pipeline:Iu}=xr,Ft=Ce(),{destroyer:Pu}=ft,{isNodeStream:Wt,isReadable:Di,isWritable:$i,isWebStream:zn,isTransformStream:Fe,isWritableStream:Bi,isReadableStream:Ui}=Ie,{AbortError:xu,codes:{ERR_INVALID_ARG_VALUE:Fi,ERR_MISSING_ARGS:Lu}}=ue,Mu=De;var ro=function(...e){if(e.length===0)throw new Lu("streams");if(e.length===1)return Ft.from(e[0]);const n=[...e];if(typeof e[0]=="function"&&(e[0]=Ft.from(e[0])),typeof e[e.length-1]=="function"){const y=e.length-1;e[y]=Ft.from(e[y])}for(let y=0;y<e.length;++y)if(!(!Wt(e[y])&&!zn(e[y]))){if(y<e.length-1&&!(Di(e[y])||Ui(e[y])||Fe(e[y])))throw new Fi(`streams[${y}]`,n[y],"must be readable");if(y>0&&!($i(e[y])||Bi(e[y])||Fe(e[y])))throw new Fi(`streams[${y}]`,n[y],"must be writable")}let r,i,s,o,c;function u(y){const g=o;o=null,g?g(y):y?c.destroy(y):!v&&!w&&c.destroy()}const f=e[0],p=Iu(e,u),w=!!($i(f)||Bi(f)||Fe(f)),v=!!(Di(p)||Ui(p)||Fe(p));if(c=new Ft({writableObjectMode:!!(f!=null&&f.writableObjectMode),readableObjectMode:!!(p!=null&&p.writableObjectMode),writable:w,readable:v}),w){if(Wt(f))c._write=function(g,T,M){f.write(g,T)?M():r=M},c._final=function(g){f.end(),i=g},f.on("drain",function(){if(r){const g=r;r=null,g()}});else if(zn(f)){const T=(Fe(f)?f.writable:f).getWriter();c._write=async function(M,C,m){try{await T.ready,T.write(M).catch(()=>{}),m()}catch(D){m(D)}},c._final=async function(M){try{await T.ready,T.close().catch(()=>{}),i=M}catch(C){M(C)}}}const y=Fe(p)?p.readable:p;Mu(y,()=>{if(i){const g=i;i=null,g()}})}if(v){if(Wt(p))p.on("readable",function(){if(s){const y=s;s=null,y()}}),p.on("end",function(){c.push(null)}),c._read=function(){for(;;){const y=p.read();if(y===null){s=c._read;return}if(!c.push(y))return}};else if(zn(p)){const g=(Fe(p)?p.readable:p).getReader();c._read=async function(){for(;;)try{const{value:T,done:M}=await g.read();if(!c.push(T))return;if(M){c.push(null);return}}catch{return}}}}return c._destroy=function(y,g){!y&&o!==null&&(y=new xu),s=null,r=null,i=null,o===null?g(y):(o=g,Wt(p)&&Pu(p,y))},c};const io=globalThis.AbortController||gr().AbortController,{codes:{ERR_INVALID_ARG_VALUE:Du,ERR_INVALID_ARG_TYPE:kt,ERR_MISSING_ARGS:$u,ERR_OUT_OF_RANGE:Bu},AbortError:Re}=ue,{validateAbortSignal:Ge,validateInteger:Uu,validateObject:Ye}=un,Fu=Q.Symbol("kWeak"),{finished:Wu}=De,Ku=ro,{addAbortSignalNoValidate:ju}=bn,{isWritable:qu,isNodeStream:Hu}=Ie,{ArrayPrototypePush:Vu,MathFloor:Gu,Number:Yu,NumberIsNaN:Ju,Promise:Wi,PromiseReject:Ki,PromisePrototypeThen:zu,Symbol:so}=Q,en=so("kEmpty"),ji=so("kEof");function Xu(t,e){if(e!=null&&Ye(e,"options"),(e==null?void 0:e.signal)!=null&&Ge(e.signal,"options.signal"),Hu(t)&&!qu(t))throw new Du("stream",t,"must be writable");const n=Ku(this,t);return e!=null&&e.signal&&ju(e.signal,n),n}function wn(t,e){if(typeof t!="function")throw new kt("fn",["Function","AsyncFunction"],t);e!=null&&Ye(e,"options"),(e==null?void 0:e.signal)!=null&&Ge(e.signal,"options.signal");let n=1;return(e==null?void 0:e.concurrency)!=null&&(n=Gu(e.concurrency)),Uu(n,"concurrency",1),(async function*(){var i,s;const o=new io,c=this,u=[],f=o.signal,p={signal:f},w=()=>o.abort();e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted&&w(),e==null||(s=e.signal)===null||s===void 0||s.addEventListener("abort",w);let v,y,g=!1;function T(){g=!0}async function M(){try{for await(let D of c){var C;if(g)return;if(f.aborted)throw new Re;try{D=t(D,p)}catch(j){D=Ki(j)}D!==en&&(typeof((C=D)===null||C===void 0?void 0:C.catch)=="function"&&D.catch(T),u.push(D),v&&(v(),v=null),!g&&u.length&&u.length>=n&&await new Wi(j=>{y=j}))}u.push(ji)}catch(D){const j=Ki(D);zu(j,void 0,T),u.push(j)}finally{var m;g=!0,v&&(v(),v=null),e==null||(m=e.signal)===null||m===void 0||m.removeEventListener("abort",w)}}M();try{for(;;){for(;u.length>0;){const C=await u[0];if(C===ji)return;if(f.aborted)throw new Re;C!==en&&(yield C),u.shift(),y&&(y(),y=null)}await new Wi(C=>{v=C})}}finally{o.abort(),g=!0,y&&(y(),y=null)}}).call(this)}function Qu(t=void 0){return t!=null&&Ye(t,"options"),(t==null?void 0:t.signal)!=null&&Ge(t.signal,"options.signal"),(async function*(){let n=0;for await(const i of this){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new Re({cause:t.signal.reason});yield[n++,i]}}).call(this)}async function oo(t,e=void 0){for await(const n of Lr.call(this,t,e))return!0;return!1}async function Zu(t,e=void 0){if(typeof t!="function")throw new kt("fn",["Function","AsyncFunction"],t);return!await oo.call(this,async(...n)=>!await t(...n),e)}async function ef(t,e){for await(const n of Lr.call(this,t,e))return n}async function tf(t,e){if(typeof t!="function")throw new kt("fn",["Function","AsyncFunction"],t);async function n(r,i){return await t(r,i),en}for await(const r of wn.call(this,n,e));}function Lr(t,e){if(typeof t!="function")throw new kt("fn",["Function","AsyncFunction"],t);async function n(r,i){return await t(r,i)?r:en}return wn.call(this,n,e)}class nf extends $u{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function rf(t,e,n){var r;if(typeof t!="function")throw new kt("reducer",["Function","AsyncFunction"],t);n!=null&&Ye(n,"options"),(n==null?void 0:n.signal)!=null&&Ge(n.signal,"options.signal");let i=arguments.length>1;if(n!=null&&(r=n.signal)!==null&&r!==void 0&&r.aborted){const f=new Re(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await Wu(this.destroy(f)),f}const s=new io,o=s.signal;if(n!=null&&n.signal){const f={once:!0,[Fu]:this};n.signal.addEventListener("abort",()=>s.abort(),f)}let c=!1;try{for await(const f of this){var u;if(c=!0,n!=null&&(u=n.signal)!==null&&u!==void 0&&u.aborted)throw new Re;i?e=await t(e,f,{signal:o}):(e=f,i=!0)}if(!c&&!i)throw new nf}finally{s.abort()}return e}async function sf(t){t!=null&&Ye(t,"options"),(t==null?void 0:t.signal)!=null&&Ge(t.signal,"options.signal");const e=[];for await(const r of this){var n;if(t!=null&&(n=t.signal)!==null&&n!==void 0&&n.aborted)throw new Re(void 0,{cause:t.signal.reason});Vu(e,r)}return e}function of(t,e){const n=wn.call(this,t,e);return(async function*(){for await(const i of n)yield*i}).call(this)}function ao(t){if(t=Yu(t),Ju(t))return 0;if(t<0)throw new Bu("number",">= 0",t);return t}function af(t,e=void 0){return e!=null&&Ye(e,"options"),(e==null?void 0:e.signal)!=null&&Ge(e.signal,"options.signal"),t=ao(t),(async function*(){var r;if(e!=null&&(r=e.signal)!==null&&r!==void 0&&r.aborted)throw new Re;for await(const s of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Re;t--<=0&&(yield s)}}).call(this)}function lf(t,e=void 0){return e!=null&&Ye(e,"options"),(e==null?void 0:e.signal)!=null&&Ge(e.signal,"options.signal"),t=ao(t),(async function*(){var r;if(e!=null&&(r=e.signal)!==null&&r!==void 0&&r.aborted)throw new Re;for await(const s of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Re;if(t-- >0)yield s;else return}}).call(this)}Rr.streamReturningOperators={asIndexedPairs:Qu,drop:af,filter:Lr,flatMap:of,map:wn,take:lf,compose:Xu};Rr.promiseReturningOperators={every:Zu,forEach:tf,reduce:rf,toArray:sf,some:oo,find:ef};var Xn,qi;function lo(){if(qi)return Xn;qi=1;const{ArrayPrototypePop:t,Promise:e}=Q,{isIterable:n,isNodeStream:r,isWebStream:i}=Ie,{pipelineImpl:s}=xr,{finished:o}=De;co();function c(...u){return new e((f,p)=>{let w,v;const y=u[u.length-1];if(y&&typeof y=="object"&&!r(y)&&!n(y)&&!i(y)){const g=t(u);w=g.signal,v=g.end}s(u,(g,T)=>{g?p(g):f(T)},{signal:w,end:v})})}return Xn={finished:o,pipeline:c},Xn}var Hi;function co(){if(Hi)return Mn.exports;Hi=1;const{Buffer:t}=He,{ObjectDefineProperty:e,ObjectKeys:n,ReflectApply:r}=Q,{promisify:{custom:i}}=ke,{streamReturningOperators:s,promiseReturningOperators:o}=Rr,{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=ue,u=ro,{pipeline:f}=xr,{destroyer:p}=ft,w=De,v=lo(),y=Ie,g=Mn.exports=Or.Stream;g.isDisturbed=y.isDisturbed,g.isErrored=y.isErrored,g.isReadable=y.isReadable,g.Readable=mn();for(const M of n(s)){let m=function(...D){if(new.target)throw c();return g.Readable.from(r(C,this,D))};const C=s[M];e(m,"name",{__proto__:null,value:C.name}),e(m,"length",{__proto__:null,value:C.length}),e(g.Readable.prototype,M,{__proto__:null,value:m,enumerable:!1,configurable:!0,writable:!0})}for(const M of n(o)){let m=function(...D){if(new.target)throw c();return r(C,this,D)};const C=o[M];e(m,"name",{__proto__:null,value:C.name}),e(m,"length",{__proto__:null,value:C.length}),e(g.Readable.prototype,M,{__proto__:null,value:m,enumerable:!1,configurable:!0,writable:!0})}g.Writable=Xs(),g.Duplex=Ce(),g.Transform=Zs,g.PassThrough=to,g.pipeline=f;const{addAbortSignal:T}=bn;return g.addAbortSignal=T,g.finished=w,g.destroy=p,g.compose=u,e(g,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return v}}),e(f,i,{__proto__:null,enumerable:!0,get(){return v.pipeline}}),e(w,i,{__proto__:null,enumerable:!0,get(){return v.finished}}),g.Stream=g,g._isUint8Array=function(C){return C instanceof Uint8Array},g._uint8ArrayToBuffer=function(C){return t.from(C.buffer,C.byteOffset,C.byteLength)},Mn.exports}(function(t){const e=co(),n=lo(),r=e.Readable.destroy;t.exports=e.Readable,t.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,t.exports._isUint8Array=e._isUint8Array,t.exports.isDisturbed=e.isDisturbed,t.exports.isErrored=e.isErrored,t.exports.isReadable=e.isReadable,t.exports.Readable=e.Readable,t.exports.Writable=e.Writable,t.exports.Duplex=e.Duplex,t.exports.Transform=e.Transform,t.exports.PassThrough=e.PassThrough,t.exports.addAbortSignal=e.addAbortSignal,t.exports.finished=e.finished,t.exports.destroy=e.destroy,t.exports.destroy=r,t.exports.pipeline=e.pipeline,t.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return n}}),t.exports.Stream=e.Stream,t.exports.default=t.exports})(sl);function Vi(t,e,n){try{Reflect.apply(t,e,n)}catch(r){setTimeout(()=>{throw r})}}function cf(t){const e=t.length,n=new Array(e);for(let r=0;r<e;r+=1)n[r]=t[r];return n}class uf extends Ot.EventEmitter{emit(e){let n=e==="error";const r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(n){let u;if(s.length>0&&([u]=s),u instanceof Error)throw u;const f=new Error(`Unhandled error.${u?` (${u.message})`:""}`);throw f.context=u,f}const c=r[e];if(c===void 0)return!1;if(typeof c=="function")Vi(c,this,s);else{const u=c.length,f=cf(c);for(let p=0;p<u;p+=1)Vi(f[p],this,s)}return!0}}const ff=at.getLogger("http-helpers");ff.setLevel(Nt.levels.INFO);class df extends Error{}df.prototype.name="InvalidTokenError";const pe={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},hf={EIP155:"eip155",SOLANA:"solana",XRPL:"xrpl",MULTICHAIN:"multichain"},pf=t=>{if(t===pe.EIP155)return 1;if(t===pe.SOLANA)return 1;throw new Error(`Chain namespace ${t} is not supported`)},gf=t=>{const e=pe.EIP155;return t===1?{chainNamespace:e,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/eth",displayName:"Ethereum Mainnet",blockExplorer:"https://etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:t===5?{chainNamespace:e,chainId:"0x5",rpcTarget:"https://rpc.ankr.com/eth_goerli",displayName:"Goerli Testnet",blockExplorer:"https://goerli.etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:t===11155111?{chainNamespace:e,chainId:"0xaa36a7",rpcTarget:"https://rpc.ankr.com/eth_sepolia",displayName:"Sepolia Testnet",blockExplorer:"https://sepolia.etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:t===137?{chainNamespace:e,chainId:"0x89",rpcTarget:"https://rpc.ankr.com/polygon",displayName:"Polygon Mainnet",blockExplorer:"https://polygonscan.com",ticker:"MATIC",tickerName:"Polygon"}:t===80001?{chainNamespace:e,chainId:"0x13881",rpcTarget:"https://rpc.ankr.com/polygon_mumbai",displayName:"Polygon Mumbai Testnet",blockExplorer:"https://mumbai.polygonscan.com/",ticker:"MATIC",tickerName:"Polygon",decimals:18}:t===56?{chainNamespace:e,chainId:"0x38",rpcTarget:"https://rpc.ankr.com/bsc",displayName:"Binance SmartChain Mainnet",blockExplorer:"https://bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:t===97?{chainNamespace:e,chainId:"0x61",rpcTarget:"https://rpc.ankr.com/bsc_testnet_chapel",displayName:"Binance SmartChain Testnet",blockExplorer:"https://testnet.bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:t===25?{chainNamespace:e,chainId:"0x19",rpcTarget:"https://rpc.cronos.org",displayName:"Cronos Mainnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos"}:t===338?{chainNamespace:e,chainId:"0x152",rpcTarget:"https://rpc-t3.cronos.org/",displayName:"Cronos Testnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos",decimals:18}:t===8217?{chainNamespace:e,chainId:"0x2019",rpcTarget:"https://public-node-api.klaytnapi.com/v1/cypress",displayName:"Klaytn Mainnet",blockExplorer:"https://scope.klaytn.com",ticker:"KLAY",tickerName:"Klaytn",decimals:18}:null},yf=t=>{const e=pe.SOLANA;return t===1?{chainNamespace:e,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/solana",displayName:"Solana Mainnet",blockExplorer:"https://explorer.solana.com",ticker:"SOL",tickerName:"Solana",decimals:9}:t===2?{chainNamespace:e,chainId:"0x2",rpcTarget:"https://api.testnet.solana.com",displayName:"Solana Testnet",blockExplorer:"https://explorer.solana.com?cluster=testnet",ticker:"SOL",tickerName:"Solana",decimals:9}:t===3?{chainNamespace:e,chainId:"0x3",rpcTarget:"https://api.devnet.solana.com",displayName:"Solana Devnet",blockExplorer:"https://explorer.solana.com?cluster=devnet",ticker:"SOL",tickerName:"Solana",decimals:9}:null},bf=(t,e)=>{if(t===pe.OTHER)return null;const n=e?typeof e=="number"?e:parseInt(e,16):pf(t);return t===pe.EIP155?gf(n):t===pe.SOLANA?yf(n):null};class It extends Yi{constructor(e,n){super(n),I(this,"code",void 0),I(this,"message",void 0),this.code=e,this.message=n||"",Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class U extends It{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new U(e,`${U.messages[e]}, ${n}`)}static notFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5001,e)}static notInstalled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5002,e)}static notReady(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5003,e)}static windowBlocked(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5004,e)}static windowClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5005,e)}static incompatibleChainNameSpace(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5006,e)}static duplicateAdapterError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5007,e)}static invalidProviderConfigError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5008,e)}static providerNotReadyError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5009,e)}static rpcConnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5010,e)}static invalidParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5011,e)}static invalidNetwork(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5013,e)}}I(U,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class q extends It{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new q(e,`${q.messages[e]}. ${n}`)}static connectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5111,e)}static disconnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5112,e)}static notConnectedError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5113,e)}static popupClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5114,e)}static mfaEnabled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5115,e)}static chainConfigNotAdded(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5116,e)}static unsupportedOperation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5117,e)}static coreKitKeyNotFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5118,e)}static userNotLoggedIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return q.fromCode(5119,e)}}I(q,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class he extends It{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new he(e,`${he.messages[e]}, ${n}`)}static chainIDNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5201,e)}static operationNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5202,e)}static chainNamespaceNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5203,e)}}I(he,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});class Mr extends It{constructor(e,n){super(e,n),Object.defineProperty(this,"name",{value:"WalletProviderError"})}static fromCode(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new he(e,`${Mr.messages[e]}, ${n}`)}static invalidRequestArgs(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5301,e)}static invalidRequestMethod(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5302,e)}static invalidRequestParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return he.fromCode(5303,e)}}I(Mr,"messages",{5e3:"Custom",5301:"Expected a single, non-array, object argument.",5302:"'args.method' must be a non-empty string.",5303:"'args.params' must be an object or array if provided."});const tn={OPENLOGIN:"openlogin",WALLET_CONNECT_V2:"wallet-connect-v2"},Et=P({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLFLARE:"solflare",SLOPE:"slope"},tn),Gt=P({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},tn),Rt=P(P({},Gt),Et);tn.OPENLOGIN+"",tn.WALLET_CONNECT_V2+"",Et.TORUS_SOLANA+"",Et.PHANTOM+"",Et.SOLFLARE+"",Et.SLOPE+"",Gt.TORUS_EVM+"",Gt.METAMASK+"",Gt.COINBASE+"";const mf={EXTERNAL:"external",IN_APP:"in_app"},J={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},et=P(P({},J),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});class wf extends uf{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),I(this,"adapterData",{}),I(this,"sessionTime",86400),I(this,"clientId",void 0),I(this,"web3AuthNetwork",it.MAINNET),I(this,"rehydrated",!1),I(this,"chainConfig",null),I(this,"knownChainConfigs",{}),I(this,"adapterNamespace",void 0),I(this,"currentChainNamespace",void 0),I(this,"type",void 0),I(this,"name",void 0),I(this,"status",void 0),this.setAdapterSettings(e)}get chainConfigProxy(){return this.chainConfig?P({},this.chainConfig):null}get connnected(){return this.status===J.CONNECTED}setAdapterSettings(e){if(this.status===J.READY)return;e!=null&&e.sessionTime&&(this.sessionTime=e.sessionTime),e!=null&&e.clientId&&(this.clientId=e.clientId),e!=null&&e.web3AuthNetwork&&(this.web3AuthNetwork=e.web3AuthNetwork);const n=e.chainConfig;if(n){if(!n.chainNamespace)throw U.notReady("ChainNamespace is required while setting chainConfig");this.currentChainNamespace=n.chainNamespace;const r=bf(n.chainNamespace,n.chainId),i=P(P({},r||{}),n);this.chainConfig=i,this.addChainConfig(i)}}checkConnectionRequirements(){if(!(this.name===Rt.WALLET_CONNECT_V2&&this.status===J.CONNECTING)){if(this.status===J.CONNECTING)throw U.notReady("Already connecting");if(this.status===J.CONNECTED)throw q.connectionError("Already connected");if(this.status!==J.READY)throw q.connectionError("Wallet adapter is not ready yet, Please wait for init function to resolve before calling connect/connectTo function")}}checkInitializationRequirements(){if(!this.clientId)throw U.invalidParams("Please initialize Web3Auth with a valid clientId in constructor");if(!this.chainConfig||!this.chainConfig.rpcTarget&&this.chainConfig.chainNamespace!==pe.OTHER)throw U.invalidParams("rpcTarget is required in chainConfig");if(!this.chainConfig.chainId&&this.chainConfig.chainNamespace!==pe.OTHER)throw U.invalidParams("chainID is required in chainConfig");if(this.status!==J.NOT_READY){if(this.status===J.CONNECTED)throw U.notReady("Already connected");if(this.status===J.READY)throw U.notReady("Adapter is already initialized")}}checkDisconnectionRequirements(){if(this.status!==J.CONNECTED)throw q.disconnectionError("Not connected with wallet")}checkAddChainRequirements(e){if(!(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)&&!this.provider)throw q.notConnectedError("Not connected with wallet.");if(this.currentChainNamespace!==e.chainNamespace)throw he.chainNamespaceNotAllowed("This adapter doesn't support this chainNamespace")}checkSwitchChainRequirements(e){let{chainId:n}=e;if(!(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)&&!this.provider)throw q.notConnectedError("Not connected with wallet.");if(!this.knownChainConfigs[n])throw q.chainConfigNotAdded("Invalid chainId")}updateAdapterData(e){this.adapterData=e,this.emit(et.ADAPTER_DATA_UPDATED,{adapterName:this.name,data:e})}addChainConfig(e){const n=this.knownChainConfigs[e.chainId];this.knownChainConfigs[e.chainId]=P(P({},n||{}),e)}getChainConfig(e){return this.knownChainConfigs[e]||null}}var wt=at.getLogger("web3auth-logger");const _f=()=>({adapterSettings:{network:it.SAPPHIRE_MAINNET,clientId:"",uxMode:Ke.POPUP},loginSettings:{},privateKeyProvider:void 0});class kf extends wf{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),I(this,"name",Rt.OPENLOGIN),I(this,"adapterNamespace",hf.MULTICHAIN),I(this,"type",mf.IN_APP),I(this,"openloginInstance",null),I(this,"status",J.NOT_READY),I(this,"currentChainNamespace",pe.EIP155),I(this,"privateKeyProvider",null),I(this,"openloginOptions",void 0),I(this,"loginSettings",{loginProvider:""}),this.setAdapterSettings(P(P({},e.adapterSettings),{},{chainConfig:e.chainConfig,clientId:e.clientId||"",sessionTime:e.sessionTime,web3AuthNetwork:e.web3AuthNetwork,useCoreKitKey:e.useCoreKitKey,privateKeyProvider:e.privateKeyProvider})),this.loginSettings=e.loginSettings||{loginProvider:""},this.privateKeyProvider=e.privateKeyProvider||null}get chainConfigProxy(){return this.chainConfig?P({},this.chainConfig):null}get provider(){return this.status!==J.NOT_READY&&this.privateKeyProvider?this.privateKeyProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){if(super.checkInitializationRequirements(),!this.clientId)throw U.invalidParams("clientId is required before openlogin's initialization");if(!this.openloginOptions)throw U.invalidParams("openloginOptions is required before openlogin's initialization");const n=this.openloginOptions.uxMode===Ke.REDIRECT;if(this.openloginOptions=P(P({},this.openloginOptions),{},{replaceUrlOnRedirect:n}),this.openloginInstance=new il(P(P({},this.openloginOptions),{},{clientId:this.clientId,network:this.openloginOptions.network||this.web3AuthNetwork||it.SAPPHIRE_MAINNET})),wt.debug("initializing openlogin adapter init"),await this.openloginInstance.init(),!this.chainConfig)throw U.invalidParams("chainConfig is required before initialization");this.status=J.READY,this.emit(et.READY,Rt.OPENLOGIN);try{wt.debug("initializing openlogin adapter"),this._getFinalPrivKey()&&(e.autoConnect||n)&&(this.rehydrated=!0,await this.connect())}catch(r){wt.error("Failed to connect with cached openlogin provider",r),this.emit("ERRORED",r)}}async connect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{loginProvider:""};super.checkConnectionRequirements(),this.status=J.CONNECTING,this.emit(et.CONNECTING,P(P({},e),{},{adapter:Rt.OPENLOGIN}));try{return await this.connectWithProvider(e),this.provider}catch(n){throw wt.error("Failed to connect with openlogin provider",n),this.status=J.READY,this.emit(et.ERRORED,n),n!=null&&n.message.includes("user closed popup")?q.popupClosed():n instanceof It?n:q.connectionError("Failed to login with openlogin")}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(this.status!==J.CONNECTED)throw q.notConnectedError("Not connected with wallet");if(!this.openloginInstance)throw U.notReady("openloginInstance is not ready");await this.openloginInstance.logout(),e.cleanup?(this.status=J.NOT_READY,this.openloginInstance=null,this.privateKeyProvider=null):this.status=J.READY,this.rehydrated=!1,this.emit(et.DISCONNECTED)}async authenticateUser(){if(this.status!==J.CONNECTED)throw q.notConnectedError("Not connected with wallet, Please login/connect first");return{idToken:(await this.getUserInfo()).idToken}}async getUserInfo(){if(this.status!==J.CONNECTED)throw q.notConnectedError("Not connected with wallet");if(!this.openloginInstance)throw U.notReady("openloginInstance is not ready");return this.openloginInstance.getUserInfo()}setAdapterSettings(e){super.setAdapterSettings(e);const n=_f();wt.info("setting adapter settings",e),this.openloginOptions=P(P(P({},n.adapterSettings),this.openloginOptions),e),e.web3AuthNetwork&&(this.openloginOptions.network=e.web3AuthNetwork),e.useCoreKitKey!==void 0&&(this.openloginOptions.useCoreKitKey=e.useCoreKitKey),e.privateKeyProvider&&(this.privateKeyProvider=e.privateKeyProvider)}async addChain(e){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(e,r),(n=this.privateKeyProvider)===null||n===void 0||n.addChain(e),this.addChainConfig(e)}async switchChain(e){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(e,r),await((n=this.privateKeyProvider)===null||n===void 0?void 0:n.switchChain(e)),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}_getFinalPrivKey(){var e;if(!this.openloginInstance)return"";let n=this.openloginInstance.privKey;if((e=this.openloginOptions)!==null&&e!==void 0&&e.useCoreKitKey){if(this.openloginInstance.privKey&&!this.openloginInstance.coreKitKey)throw q.coreKitKeyNotFound();n=this.openloginInstance.coreKitKey}return n}_getFinalEd25519PrivKey(){var e;if(!this.openloginInstance)return"";let n=this.openloginInstance.ed25519PrivKey;if((e=this.openloginOptions)!==null&&e!==void 0&&e.useCoreKitKey){if(this.openloginInstance.ed25519PrivKey&&!this.openloginInstance.coreKitEd25519Key)throw q.coreKitKeyNotFound();n=this.openloginInstance.coreKitEd25519Key}return n}async connectWithProvider(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{loginProvider:""};if(!this.privateKeyProvider)throw U.invalidParams("PrivateKey Provider is required before initialization");if(!this.openloginInstance)throw U.notReady("openloginInstance is not ready");if(!this._getFinalPrivKey()||(e=n.extraLoginOptions)!==null&&e!==void 0&&e.id_token){var i;if(this.loginSettings.curve||(this.loginSettings.curve=this.currentChainNamespace===pe.SOLANA?ni.ED25519:ni.SECP256K1),!n.loginProvider&&!this.loginSettings.loginProvider)throw U.invalidParams("loginProvider is required for login");await this.openloginInstance.login(lt(this.loginSettings,n,{extraLoginOptions:P(P({},n.extraLoginOptions||{}),{},{login_hint:n.login_hint||((i=n.extraLoginOptions)===null||i===void 0?void 0:i.login_hint)})}))}let s=this._getFinalPrivKey();s&&(this.currentChainNamespace===pe.SOLANA&&(s=this._getFinalEd25519PrivKey()),await this.privateKeyProvider.setupProvider(s),this.status=J.CONNECTED,this.emit(et.CONNECTED,{adapter:Rt.OPENLOGIN,reconnected:this.rehydrated}))}}export{we as BUILD_ENV,ys as BrowserStorage,Af as LANGUAGES,ri as LOGIN_PROVIDER,Nf as MFA_FACTOR,vf as MFA_LEVELS,Ra as MemoryStore,Pn as OPENLOGIN_ACTIONS,it as OPENLOGIN_NETWORK,kf as OpenloginAdapter,ni as SUPPORTED_KEY_CURVES,Tf as THEME_MODES,Gi as TORUS_LEGACY_NETWORK,po as TORUS_SAPPHIRE_NETWORK,Ke as UX_MODE,Ef as base64toJSON,sn as base64url,_f as getOpenloginDefaultOptions,ei as jsonToBase64,In as safeatob,Ea as safebtoa,ti as storageAvailable,Rf as storeKey};
